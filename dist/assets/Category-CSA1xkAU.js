import{r as u,a as ft,j as e,B as o,S as Me,C as H,T as l,Z as Ue,A as be,d as v,q as P,m as O,g as I,M as j,c as M,a6 as _e,a7 as ae,b as ve,l as yt,a8 as Be,a9 as Le,D as jt,w as bt,y as G,X as Ce,Y as we,a3 as se,o as ne,k as oe,aa as vt,G as C,_ as He,$ as Ge,a0 as Ve,ab as Je,a1 as Ye}from"./index-C-AtCVLN.js";import{C as Ie}from"./CloudUpload-Di5NvzSY.js";import{S as Ct}from"./Search-B53zclG-.js";import{E as wt}from"./FileDownload-Cc87oadK.js";import{E as It}from"./TableView-JqA55pCO.js";import{C as St}from"./Description-BLKU7EdF.js";import{A as At,a as kt,F as Tt}from"./KeyboardArrowUp-CKjAVEYs.js";import{T as qe}from"./Tag-00mEMXsM.js";import{I as Dt}from"./Image-CulmO32N.js";const U="https://api.bookmyevent.ae/api",ie="static_transport_123456789012345678901234",Se={_id:ie,title:"Transport",name:"Transport"};function _t(){const[S,Rt]=u.useState(0),[F,Ke]=u.useState(""),[V,le]=u.useState(null),[Ae,de]=u.useState(null),[$,ke]=u.useState([]),[z,ce]=u.useState(!0),[k,_]=u.useState(null),[T,ue]=u.useState("all"),[Xe,Ze]=u.useState({}),[x,q]=u.useState({name:"",description:"",parentCategory:"",module:ie,displayOrder:0,isActive:!0,isFeatured:!1,metaTitle:"",metaDescription:""}),[y,Qe]=u.useState([]),[f,w]=u.useState(!0),[B,b]=u.useState(null),[xe,Te]=u.useState({open:!1,message:"",severity:"success"}),[K,X]=u.useState({open:!1,categoryId:null,categoryName:""}),[De,Re]=u.useState(null),et=!!De,m=ft(),J=u.useRef(null),ge=u.useRef(null),[D,L]=u.useState({open:!1,categoryId:null,loading:!1}),[p,he]=u.useState({name:"",description:"",parentCategory:"",module:"",displayOrder:0,isActive:!0,isFeatured:!1,metaTitle:"",metaDescription:""}),[Ee,Pe]=u.useState(null),[pe,Z]=u.useState(null),[Et,me]=u.useState(null),A=[{key:"default",label:"Default"},{key:"english",label:"English(EN)"},{key:"arabic",label:"Arabic - العربية(AR)"}],R=()=>localStorage.getItem("token")||sessionStorage.getItem("token"),tt=()=>{const t=localStorage.getItem("user")||sessionStorage.getItem("user");if(!t)return null;try{return JSON.parse(t).role}catch{return null}},fe=()=>{const t=localStorage.getItem("user")||sessionStorage.getItem("user");if(!t)return null;try{return JSON.parse(t)._id}catch{return null}},ye=u.useCallback(async()=>{const t=R();if(!t){_("You are not authenticated. Please log in."),ce(!1);return}ce(!0),_(null);try{const r=await fetch(`${U}/modules`,{headers:{Authorization:`Bearer ${t}`,Accept:"application/json"}});if(r.status===401){_("Session expired. Please log in again."),m("/login");return}if(!r.ok){const d=await r.text();throw new Error(`HTTP error! status: ${r.status}: ${d}`)}const a=await r.json();let n=[];Array.isArray(a)?n=a:Array.isArray(a.modules)?n=a.modules:a.data&&Array.isArray(a.data.modules)?n=a.data.modules:a.data&&Array.isArray(a.data)&&(n=a.data);const s=n.find(d=>(d.title||d.name||"").toLowerCase().includes("transport")),c=s?n:[Se,...n];ke(c);const h=s||Se;q(d=>({...d,module:h._id})),ue(h._id)}catch(r){console.error("fetchModules error:",r),_(r.message),g("Failed to fetch modules – using static Transport","warning"),ke([Se]),q(a=>({...a,module:ie})),ue(ie)}finally{ce(!1)}},[m]),W=u.useCallback(async()=>{const t=R();if(!t){b("You are not authenticated. Please log in."),w(!1);return}w(!0),b(null);try{const r=`${U}/categories?search=${encodeURIComponent(F)}`,a=await fetch(r,{headers:{Authorization:`Bearer ${t}`,Accept:"application/json"}});if(a.status===401){b("Session expired. Please log in again."),m("/login");return}if(a.status===403){b("Access denied. You don't have permission to view categories."),m("/dashboard");return}if(!a.ok){const i=await a.text();throw new Error(`HTTP error! status: ${a.status}: ${i}`)}const n=await a.json();let s=[];Array.isArray(n)?s=n:Array.isArray(n.categories)?s=n.categories:n.data&&Array.isArray(n.data.categories)?s=n.data.categories:n.data&&Array.isArray(n.data)&&(s=n.data);const c=s.map(i=>{let E="";return i.image&&(E=`https://api.bookmyevent.ae${i.image.startsWith("/")?i.image:`/${i.image}`}`),{id:i._id,names:{default:i.title||"",english:i.title||"",arabic:i.title||""},status:i.isActive!==void 0?i.isActive:!0,image:E,module:i.module||null,parentCategory:i.parentCategory?._id||i.parentCategory||null,raw:i,description:i.description||"",displayOrder:i.displayOrder||0,isFeatured:i.isFeatured||!1,subcategories:[]}}),h=c.filter(i=>!i.parentCategory),d=c.filter(i=>i.parentCategory);h.forEach(i=>{i.subcategories=d.filter(E=>E.parentCategory===i.id)}),Qe(c)}catch(r){console.error("fetchCategories error:",r),b(r.message),g(`Failed to fetch categories: ${r.message}`,"error")}finally{w(!1)}},[F,m]);u.useEffect(()=>{const t=tt();if(!R()){b("You are not authenticated. Please log in."),w(!1);return}if(!["admin","manager","superadmin"].includes(t)){b("Access denied. Admin, Manager, or Superadmin role required."),w(!1),m("/dashboard");return}ye(),W()},[ye,W,m]);const Q=(t,r)=>{q(a=>({...a,[t]:r}))},rt=t=>{const r=t.target.files[0];if(!r)return;if(!r.type.startsWith("image/")){g("Please select a valid image file (JPEG, PNG, GIF, WebP, SVG)","error");return}if(r.size>5*1024*1024){g("File size should be less than 5MB","error");return}le(r);const a=new FileReader;a.onload=n=>de(n.target.result),a.readAsDataURL(r)},Fe=()=>{q(t=>({...t,name:"",description:"",parentCategory:"",module:t.module||($.length>0?$[0]._id:""),displayOrder:0,isActive:!0,isFeatured:!1,metaTitle:"",metaDescription:""})),le(null),de(null),J.current&&(J.current.value="")},at=async()=>{const t=R();if(!t){b("You are not authenticated. Please log in."),m("/login");return}if(!x.name.trim()){g("Please enter a category title in Default","error");return}if(!x.module||!/^[0-9a-fA-F]{24}$/.test(x.module)){g("Please select a valid module","error");return}if(!V){g("Please upload an image","error");return}w(!0);try{const r=new FormData;r.append("title",x.name.trim()),r.append("module",x.module),x.description.trim()&&r.append("description",x.description.trim()),x.parentCategory&&r.append("parentCategory",x.parentCategory),r.append("displayOrder",x.displayOrder),r.append("isActive",x.isActive),r.append("isFeatured",x.isFeatured),x.metaTitle.trim()&&r.append("metaTitle",x.metaTitle.trim()),x.metaDescription.trim()&&r.append("metaDescription",x.metaDescription.trim()),r.append("createdBy",fe()),r.append("image",V);const a=await fetch(`${U}/categories`,{method:"POST",headers:{Authorization:`Bearer ${t}`},body:r});if(!a.ok){let c="Failed to add category";const h=a.status;try{const d=await a.text();let i;try{i=JSON.parse(d),c=i.error||c}catch{c=d||c}if(h===401){b("Session expired. Please log in again."),m("/login");return}if(h===403){b("Access denied. You don't have permission to create categories."),m("/dashboard");return}h===502&&(c="Server error: Unable to connect to the backend service. Please try again later.")}catch{c="Failed to parse server response. Please try again."}throw new Error(c)}const n=await a.json(),s=n.data?.category||n.category||n;g(`Category "${s.title||s.name}" added successfully!`,"success"),Fe(),W()}catch(r){console.error("Add error:",r);const a=r.message.includes("Failed to fetch")?"Network error: Unable to reach the server. Please check your connection.":r.message||"Failed to add category";g(a,"error")}finally{w(!1)}},st=async t=>{const r=R();if(!r){m("/login");return}L(a=>({...a,open:!0,loading:!0,categoryId:t}));try{const a=await fetch(`${U}/categories/${t}`,{headers:{Authorization:`Bearer ${r}`}});if(!a.ok)throw new Error("Failed to fetch category details");const n=await a.json(),s=n.data||n;if(he({name:s.title||"",description:s.description||"",parentCategory:s.parentCategory?._id||s.parentCategory||"",module:s.module?._id||s.module||"",displayOrder:s.displayOrder||0,isActive:s.isActive!==void 0?s.isActive:!0,isFeatured:s.isFeatured!==void 0?s.isFeatured:!1,metaTitle:s.metaTitle||"",metaDescription:s.metaDescription||""}),s.image){let c="";s.image.startsWith("http")?c=s.image:c=`https://api.bookmyevent.ae${s.image.startsWith("/")?s.image:`/${s.image}`}`,me(c),Z(c)}else me(null),Z(null)}catch(a){console.error("Fetch category error:",a),g(`Failed to load category: ${a.message}`,"error"),L(n=>({...n,open:!1}))}finally{L(a=>({...a,loading:!1}))}},ee=()=>{L({open:!1,categoryId:null,loading:!1}),he({name:"",description:"",parentCategory:"",module:"",displayOrder:0,isActive:!0,isFeatured:!1,metaTitle:"",metaDescription:""}),Pe(null),Z(null),me(null),ge.current&&(ge.current.value="")},N=(t,r)=>{he(a=>{const n={...a,[t]:r};return t==="module"&&(n.parentCategory=""),n})},$e=t=>{const r=t.target.files[0];if(!r)return;if(!r.type.startsWith("image/")){g("Please select a valid image file","error");return}Pe(r);const a=new FileReader;a.onload=n=>Z(n.target.result),a.readAsDataURL(r)},nt=async()=>{const t=R();if(t){if(!p.name.trim()){g("Please enter a category title","error");return}L(r=>({...r,loading:!0}));try{const r=new FormData;r.append("title",p.name.trim()),r.append("module",p.module),r.append("description",p.description),r.append("parentCategory",p.parentCategory||""),r.append("displayOrder",p.displayOrder),r.append("isActive",p.isActive),r.append("isFeatured",p.isFeatured),r.append("metaTitle",p.metaTitle),r.append("metaDescription",p.metaDescription),r.append("updatedBy",fe()),Ee&&r.append("image",Ee);const a=await fetch(`${U}/categories/${D.categoryId}`,{method:"PUT",headers:{Authorization:`Bearer ${t}`},body:r});if(!a.ok){const n=await a.json();throw new Error(n.error||"Failed to update category")}g("Category updated successfully!","success"),ee(),W()}catch(r){console.error("Update error:",r),g(r.message,"error")}finally{L(r=>({...r,loading:!1}))}}},ze=t=>st(t),We=t=>{const r=y.find(a=>a.id===t);X({open:!0,categoryId:t,categoryName:r?.names?.default||""})},ot=async()=>{const t=R();if(!t){m("/login");return}w(!0);try{const r=await fetch(`${U}/categories/${K.categoryId}`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`}});if(!r.ok){const a=await r.text();let n={error:a};try{n=JSON.parse(a)}catch{}throw new Error(n.error||`HTTP ${r.status}`)}g(`Category "${K.categoryName}" deleted!`,"success"),X({open:!1,categoryId:null,categoryName:""}),W()}catch(r){g(`Delete failed: ${r.message}`,"error")}finally{w(!1)}},Ne=async t=>{const r=R();if(!r){m("/login");return}const a=y.find(c=>c.id===t);if(!a)return;const n=a.status?`/categories/${t}/block`:`/categories/${t}/reactivate`,s=a.status?"blocked":"reactivated";w(!0);try{const c=await fetch(`${U}${n}`,{method:"PATCH",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"},body:JSON.stringify({updatedBy:fe()})});if(!c.ok){const h=await c.text();let d={error:h};try{d=JSON.parse(h)}catch{}throw new Error(d.error||`HTTP ${c.status}`)}g(`Category "${a.names.default}" ${s}`,"info"),W()}catch(c){g(`Status change failed: ${c.message}`,"error")}finally{w(!1)}},g=(t,r="success")=>{Te({open:!0,message:t,severity:r})},Oe=()=>Te(t=>({...t,open:!1})),it=()=>m("/login"),lt=()=>m("/dashboard"),dt=()=>{ye(),W()},Y=()=>A[S].key,ct=()=>{if(T==="all")return"All";const t=$.find(r=>r._id===T);return t?.title||t?.name||"Categories"},ut=t=>{Ze(r=>({...r,[t]:!r[t]}))},xt=()=>y.filter(t=>!t.parentCategory),gt=t=>y.filter(r=>r.parentCategory===t),te=y.filter(t=>{const r=Y(),a=t.names[r].toLowerCase().includes(F.toLowerCase());if(T==="all")return a;const n=t.module?._id===T||t.parentCategory&&y.find(s=>s.id===t.parentCategory)?.module?._id===T;return a&&n}),ht=t=>Re(t.currentTarget),je=()=>Re(null),pt=()=>{const t=Y(),r=["SI","ID",`Name (${t})`,"Module","Parent","Status"],a=te.map((d,i)=>{const E=d.parentCategory&&y.find(re=>re.id===d.parentCategory)?.names.default||"—";return[i+1,d.id,d.names[t],d.module?.title||(d.parentCategory?"—":"N/A"),E,d.status?"Active":"Inactive"]});let n=r.join(",")+`
`+a.map(d=>d.map(i=>`"${i}"`).join(",")).join(`
`);const s=new Blob([n],{type:"text/csv;charset=utf-8;"}),c=URL.createObjectURL(s),h=document.createElement("a");h.href=c,h.download=`categories_${t}_${new Date().toISOString().split("T")[0]}.csv`,h.click(),URL.revokeObjectURL(c),je(),g("CSV downloaded","success")},mt=()=>{const t=Y(),r=["SI","ID",`Name (${t})`,"Module","Parent","Status"],a=te.map((d,i)=>{const E=d.parentCategory&&y.find(re=>re.id===d.parentCategory)?.names.default||"—";return[i+1,d.id,d.names[t],d.module?.title||(d.parentCategory?"—":"N/A"),E,d.status?"Active":"Inactive"]});let n=r.join("	")+`
`+a.map(d=>d.join("	")).join(`
`);const s=new Blob([n],{type:"application/vnd.ms-excel;charset=utf-8;"}),c=URL.createObjectURL(s),h=document.createElement("a");h.href=c,h.download=`categories_${t}_${new Date().toISOString().split("T")[0]}.xls`,h.click(),URL.revokeObjectURL(c),je(),g("Excel downloaded","success")};return f&&y.length===0&&z?e.jsx(o,{sx:{p:2,display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px"},children:e.jsxs(Me,{alignItems:"center",spacing:2,children:[e.jsx(H,{}),e.jsx(l,{children:"Loading categories and modules..."})]})}):e.jsxs(o,{sx:{width:"100%",minHeight:"100vh",backgroundColor:"#f5f5f5",p:{xs:2,sm:3}},children:[e.jsx(Ue,{open:!!B||!!k,autoHideDuration:null,onClose:()=>{b(null),_(null)},children:e.jsx(be,{severity:"error",onClose:()=>{b(null),_(null)},action:e.jsxs(Me,{direction:"row",spacing:1,children:[(B?.includes("not authenticated")||k?.includes("not authenticated"))&&e.jsx(v,{color:"inherit",size:"small",onClick:it,children:"Login"}),(B?.includes("Access denied")||k?.includes("Access denied"))&&e.jsx(v,{color:"inherit",size:"small",onClick:lt,children:"Dashboard"}),!(B?.includes("not authenticated")||B?.includes("Access denied"))&&!(k?.includes("not authenticated")||k?.includes("Access denied"))&&e.jsx(v,{color:"inherit",size:"small",onClick:dt,children:"Retry"})]}),children:B||k})}),e.jsx(o,{sx:{display:"flex",justifyContent:"center",mb:4},children:e.jsx(P,{sx:{width:"100%",maxWidth:"1400px",boxShadow:3,borderRadius:3},children:e.jsxs(O,{sx:{p:{xs:2,sm:4}},children:[e.jsxs(l,{variant:"subtitle1",sx:{mb:1,fontWeight:500},children:["Title (",A[S].label,") ",e.jsx("span",{style:{color:"#f44336"},children:"*"})]}),e.jsx(I,{fullWidth:!0,value:A[S].key==="default"?x.name:"",onChange:t=>A[S].key==="default"&&Q("name",t.target.value),placeholder:`Enter title in ${A[S].label}`,variant:"outlined",disabled:A[S].key!=="default",sx:{mb:4,"& .MuiOutlinedInput-root":{direction:A[S].key==="arabic"?"rtl":"ltr"}}}),e.jsx(l,{variant:"subtitle1",sx:{mb:1,fontWeight:500},children:"Parent Category"}),e.jsxs(I,{select:!0,fullWidth:!0,value:x.parentCategory,onChange:t=>Q("parentCategory",t.target.value),SelectProps:{displayEmpty:!0,renderValue:t=>t?y.find(a=>a.id===t)?.names.default||t:e.jsx("em",{children:"None"})},variant:"outlined",sx:{mb:4},children:[e.jsx(j,{value:"",children:e.jsx("em",{children:"None"})}),y.filter(t=>!t.parentCategory&&t.module?._id===x.module).map(t=>e.jsx(j,{value:t.id,children:t.names.default},t.id))]}),e.jsxs(l,{variant:"subtitle1",sx:{mb:1,fontWeight:500},children:["Module ",e.jsx("span",{style:{color:"#f44336"},children:"*"})]}),e.jsxs(I,{select:!0,fullWidth:!0,value:x.module,onChange:t=>{const r=t.target.value;Q("module",r),Q("parentCategory","")},variant:"outlined",disabled:z||!!k,sx:{mb:4},children:[z&&e.jsx(j,{value:"",children:"Loading..."}),k&&e.jsx(j,{value:"",children:"Error loading"}),$.length===0&&!z&&e.jsx(j,{value:"",children:"No modules"}),$.map(t=>e.jsx(j,{value:t._id,children:t.title||t.name||"Unnamed"},t._id))]}),e.jsxs(l,{variant:"subtitle1",sx:{mb:1,fontWeight:500},children:["Image ",e.jsx("span",{style:{color:"#f44336"},children:"*"})," ",e.jsx("span",{style:{color:"#e91e63",fontSize:"0.875rem"},children:"(Ratio 3:2)"})]}),e.jsxs(o,{sx:{display:"flex",gap:3,mb:4,flexDirection:{xs:"column",sm:"row"}},children:[e.jsxs(o,{children:[e.jsx("input",{id:"img-input",type:"file",accept:"image/*",onChange:rt,ref:J,style:{display:"none"}}),e.jsx("label",{htmlFor:"img-input",children:e.jsxs(v,{component:"span",variant:"outlined",sx:{width:{xs:"100%",sm:240},height:{xs:100,sm:140},border:"2px dashed #e0e0e0",borderRadius:2,display:"flex",flexDirection:"column",gap:1,color:"text.secondary",textTransform:"none","&:hover":{borderColor:"#2196f3",backgroundColor:"#e3f2fd",border:"2px dashed #2196f3"}},children:[e.jsx(Ie,{sx:{fontSize:40,color:"#bdbdbd"}}),e.jsx(l,{variant:"body2",color:"text.secondary",children:V?"Change Image":"Upload Image"})]})})]}),Ae&&e.jsxs(o,{sx:{position:"relative"},children:[e.jsxs(o,{sx:{width:{xs:"100%",sm:240},height:{xs:160,sm:140},border:"2px solid #e0e0e0",borderRadius:2,overflow:"hidden"},children:[e.jsx("img",{src:Ae,alt:"preview",style:{width:"100%",height:"100%",objectFit:"cover"}}),e.jsx(M,{size:"small",onClick:()=>{de(null),le(null),J.current&&(J.current.value="")},sx:{position:"absolute",top:8,right:8,backgroundColor:"rgba(0,0,0,0.5)",color:"white","&:hover":{backgroundColor:"rgba(0,0,0,0.7)"}},children:e.jsx(_e,{fontSize:"small"})})]}),e.jsx(l,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:V?.name})]})]}),e.jsxs(o,{sx:{display:"flex",flexWrap:"wrap",justifyContent:{xs:"center",sm:"flex-end"},gap:2},children:[e.jsx(v,{variant:"outlined",onClick:Fe,disabled:f||z,sx:{px:4,py:1.5,textTransform:"none",borderColor:"#e0e0e0",color:"#666","&:hover":{borderColor:"#bdbdbd",backgroundColor:"#f5f5f5"}},children:"Reset"}),e.jsx(v,{variant:"contained",onClick:at,disabled:!x.name.trim()||!x.module||!/^[0-9a-fA-F]{24}$/.test(x.module)||!V||f||z,sx:{px:4,py:1.5,backgroundColor:"#00695c",textTransform:"none","&:hover":{backgroundColor:"#004d40"},"&:disabled":{backgroundColor:"#e0e0e0",color:"#999"}},children:f?e.jsx(H,{size:20,color:"inherit"}):"Add"})]})]})})}),e.jsx(o,{sx:{display:"flex",justifyContent:"center"},children:e.jsx(P,{sx:{width:"100%",maxWidth:"1400px",boxShadow:3,borderRadius:3},children:e.jsxs(O,{sx:{p:{xs:2,sm:3}},children:[e.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",flexWrap:"wrap",gap:2,mb:3},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(ae,{sx:{color:"#1976d2",fontSize:28}}),e.jsxs(o,{children:[e.jsxs(l,{variant:"h5",fontWeight:700,color:"#2c3e50",children:[ct()," Categories"]}),e.jsx(l,{variant:"body2",color:"text.secondary",children:"Parent categories and their subcategories"})]})]}),e.jsxs(o,{sx:{display:"flex",flexWrap:"wrap",gap:2,alignItems:"center"},children:[e.jsx(I,{size:"small",placeholder:`Search in ${A[S].label}`,value:F,onChange:t=>Ke(t.target.value),sx:{minWidth:{xs:"100%",sm:250,md:300},"& .MuiOutlinedInput-root":{direction:A[S].key==="arabic"?"rtl":"ltr",borderRadius:2}},InputProps:{startAdornment:e.jsx(ve,{position:"start",children:e.jsx(Ct,{sx:{color:"#bdbdbd"}})})},disabled:f}),e.jsxs(I,{select:!0,size:"small",value:T,onChange:t=>ue(t.target.value),sx:{minWidth:{xs:"100%",sm:200},borderRadius:2},disabled:f||z,children:[e.jsx(j,{value:"all",children:"All Modules"}),$.map(t=>e.jsx(j,{value:t._id,children:t.title||t.name||"Unnamed"},t._id))]}),e.jsx(v,{variant:"contained",startIcon:e.jsx(wt,{}),onClick:ht,sx:{textTransform:"none",borderRadius:2,px:3,backgroundColor:"#1976d2","&:hover":{backgroundColor:"#1565c0"}},disabled:f||te.length===0,children:"Export"}),e.jsxs(yt,{anchorEl:De,open:et,onClose:je,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},sx:{"& .MuiPaper-root":{minWidth:180,boxShadow:"0 4px 20px rgba(0,0,0,0.1)",borderRadius:2,mt:1}},children:[e.jsxs(j,{onClick:mt,sx:{py:1.5,px:2},children:[e.jsx(Be,{children:e.jsx(It,{sx:{color:"#1976d2"}})}),e.jsx(Le,{primary:"Export to Excel",primaryTypographyProps:{fontWeight:500}})]}),e.jsx(jt,{}),e.jsxs(j,{onClick:pt,sx:{py:1.5,px:2},children:[e.jsx(Be,{children:e.jsx(St,{sx:{color:"#2e7d32"}})}),e.jsx(Le,{primary:"Export to CSV",primaryTypographyProps:{fontWeight:500}})]})]})]})]}),f&&y.length>0&&e.jsx(o,{display:"flex",justifyContent:"center",p:2,children:e.jsx(H,{size:24})}),e.jsx(o,{sx:{mt:3},children:te.length>0?xt().filter(t=>T==="all"?!0:t.module?._id===T).map((t,r)=>{const a=gt(t.id),n=Xe[t.id]||!1;return e.jsxs(P,{sx:{mb:2,border:"1px solid #e0e0e0",borderRadius:2},children:[e.jsx(bt,{sx:{bgcolor:"#f8f9fa",borderBottom:"1px solid #e0e0e0","& .MuiCardHeader-action":{m:0}},avatar:e.jsx(oe,{src:t.image,sx:{width:56,height:56,bgcolor:t.image?"transparent":"#e3f2fd",border:"2px solid #fff",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:!t.image&&e.jsx(ae,{sx:{color:"#1976d2"}})}),title:e.jsxs(o,{children:[e.jsx(l,{variant:"h6",fontWeight:600,color:"#2c3e50",children:t.names[Y()]}),e.jsxs(l,{variant:"body2",color:"text.secondary",children:[t.module?.title||"No Module"," • Display Order: ",t.displayOrder]})]}),subheader:e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:2,mt:.5},children:[e.jsx(ne,{label:t.status?"Active":"Inactive",size:"small",color:t.status?"success":"error",variant:"outlined"}),e.jsx(ne,{icon:e.jsx(qe,{}),label:`${a.length} subcategories`,size:"small",variant:"outlined"}),t.isFeatured&&e.jsx(ne,{label:"Featured",size:"small",color:"warning",variant:"outlined"})]}),action:e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(G,{title:n?"Collapse":"Expand",children:e.jsx(M,{onClick:()=>ut(t.id),children:n?e.jsx(At,{}):e.jsx(kt,{})})}),e.jsx(G,{title:"Edit",children:e.jsx(M,{onClick:()=>ze(t.id),sx:{color:"#1976d2"},children:e.jsx(Ce,{})})}),e.jsx(G,{title:"Delete",children:e.jsx(M,{onClick:()=>We(t.id),sx:{color:"#d32f2f"},children:e.jsx(we,{})})}),e.jsx(G,{title:"Toggle Status",children:e.jsx(se,{checked:t.status,onChange:()=>Ne(t.id),size:"small"})})]})}),e.jsx(vt,{in:n,children:e.jsx(o,{sx:{p:2,bgcolor:"#fafafa"},children:a.length>0?e.jsx(C,{container:!0,spacing:2,children:a.map((s,c)=>e.jsx(C,{item:!0,xs:12,sm:6,md:4,children:e.jsx(P,{variant:"outlined",sx:{borderRadius:2},children:e.jsx(O,{sx:{p:2},children:e.jsxs(o,{sx:{display:"flex",alignItems:"flex-start",gap:2},children:[e.jsx(oe,{src:s.image,variant:"rounded",sx:{width:60,height:60,bgcolor:s.image?"transparent":"#e8f5e9"},children:!s.image&&e.jsx(qe,{})}),e.jsxs(o,{sx:{flex:1},children:[e.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsx(l,{variant:"subtitle1",fontWeight:500,children:s.names[Y()]}),e.jsxs(o,{sx:{display:"flex",gap:.5},children:[e.jsx(G,{title:"Edit",children:e.jsx(M,{size:"small",onClick:()=>ze(s.id),sx:{color:"#1976d2"},children:e.jsx(Ce,{fontSize:"small"})})}),e.jsx(G,{title:"Delete",children:e.jsx(M,{size:"small",onClick:()=>We(s.id),sx:{color:"#d32f2f"},children:e.jsx(we,{fontSize:"small"})})})]})]}),e.jsx(l,{variant:"body2",color:"text.secondary",sx:{mb:1},children:s.description||"No description"}),e.jsxs(o,{sx:{display:"flex",gap:1,alignItems:"center"},children:[e.jsx(se,{checked:s.status,onChange:()=>Ne(s.id),size:"small"}),e.jsx(l,{variant:"caption",children:s.status?"Active":"Inactive"}),s.isFeatured&&e.jsx(ne,{label:"Featured",size:"small",color:"warning",sx:{height:20}})]})]})]})})})},s.id))}):e.jsx(o,{sx:{textAlign:"center",py:4},children:e.jsx(l,{variant:"body2",color:"text.secondary",children:"No subcategories available. Add subcategories to this parent category."})})})})]},t.id)}):e.jsxs(o,{sx:{textAlign:"center",py:6},children:[e.jsx(ae,{sx:{fontSize:60,color:"#e0e0e0",mb:2}}),e.jsx(l,{variant:"h6",color:"textSecondary",gutterBottom:!0,children:f?"Loading categories...":F?`No results for "${F}"`:"No categories available"}),e.jsx(l,{variant:"body2",color:"textSecondary",children:!f&&!F&&"Create your first category using the form above"})]})})]})})}),e.jsxs(He,{open:D.open,onClose:ee,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:3,boxShadow:"0 8px 40px rgba(0,0,0,0.12)",background:"linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%)"}},children:[e.jsxs(Ge,{sx:{m:0,p:3,display:"flex",alignItems:"center",justifyContent:"space-between",borderBottom:"1px solid #e0e0e0",bgcolor:"white"},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(oe,{sx:{bgcolor:"#1976d2",width:40,height:40},children:e.jsx(Ce,{})}),e.jsxs(o,{children:[e.jsx(l,{variant:"h5",fontWeight:700,color:"#2c3e50",children:"Edit Category"}),e.jsx(l,{variant:"body2",color:"text.secondary",children:"Update category details and settings"})]})]}),e.jsx(M,{onClick:ee,sx:{color:"#666","&:hover":{bgcolor:"#f5f5f5"}},children:e.jsx(_e,{})})]}),e.jsx(Ve,{sx:{p:4},children:D.loading?e.jsxs(o,{sx:{display:"flex",flexDirection:"column",alignItems:"center",py:8,gap:2},children:[e.jsx(H,{size:48,thickness:4}),e.jsx(l,{variant:"body1",color:"textSecondary",fontWeight:500,children:"Fetching category details..."})]}):e.jsx(o,{sx:{mt:2},children:e.jsxs(C,{container:!0,spacing:4,children:[e.jsxs(C,{item:!0,xs:12,md:6,children:[e.jsx(P,{variant:"outlined",sx:{mb:3,borderRadius:2},children:e.jsxs(O,{children:[e.jsx(l,{variant:"h6",gutterBottom:!0,fontWeight:600,color:"#2c3e50",children:e.jsxs(o,{component:"span",sx:{display:"inline-flex",alignItems:"center",gap:1},children:[e.jsx(Je,{fontSize:"small"}),"Basic Information"]})}),e.jsx(I,{fullWidth:!0,label:"Category Title",value:p.name,onChange:t=>N("name",t.target.value),placeholder:"e.g. Premium Venues",size:"medium",variant:"outlined",sx:{mb:3},InputProps:{startAdornment:e.jsx(ve,{position:"start",children:e.jsx(ae,{color:"action"})})}}),e.jsx(I,{fullWidth:!0,label:"Description",multiline:!0,rows:3,value:p.description,onChange:t=>N("description",t.target.value),placeholder:"Provide a brief description of this category...",size:"medium"})]})}),e.jsx(P,{variant:"outlined",sx:{borderRadius:2},children:e.jsxs(O,{children:[e.jsx(l,{variant:"h6",gutterBottom:!0,fontWeight:600,color:"#2c3e50",children:e.jsxs(o,{component:"span",sx:{display:"inline-flex",alignItems:"center",gap:1},children:[e.jsx(Dt,{fontSize:"small"}),"Category Image"]})}),e.jsxs(o,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:2},children:[e.jsxs(o,{sx:{width:"100%",height:200,border:"2px dashed #e0e0e0",borderRadius:2,overflow:"hidden",backgroundColor:"#fafafa",display:"flex",alignItems:"center",justifyContent:"center",position:"relative","&:hover":{borderColor:"#1976d2",bgcolor:"#f0f7ff"}},children:[pe?e.jsx("img",{src:pe,alt:"Preview",style:{width:"100%",height:"100%",objectFit:"cover"}}):e.jsxs(o,{sx:{textAlign:"center",p:3},children:[e.jsx(Ie,{sx:{fontSize:48,color:"#bdbdbd",mb:1}}),e.jsx(l,{variant:"body2",color:"text.secondary",children:"Click to upload or drag and drop"}),e.jsx(l,{variant:"caption",color:"text.secondary",children:"SVG, PNG, JPG or GIF (max. 5MB)"})]}),e.jsx("input",{type:"file",id:"edit-img-input",style:{position:"absolute",width:"100%",height:"100%",opacity:0,cursor:"pointer"},accept:"image/*",onChange:$e,ref:ge})]}),e.jsxs(v,{component:"label",variant:"outlined",startIcon:e.jsx(Ie,{}),sx:{textTransform:"none",borderRadius:2},children:[pe?"Replace Image":"Choose Image",e.jsx("input",{type:"file",hidden:!0,accept:"image/*",onChange:$e})]}),e.jsx(l,{variant:"caption",color:"text.secondary",align:"center",children:"Recommended: 600×400px (3:2 ratio) • Max 5MB"})]})]})})]}),e.jsxs(C,{item:!0,xs:12,md:6,children:[e.jsx(P,{variant:"outlined",sx:{mb:3,borderRadius:2},children:e.jsxs(O,{children:[e.jsx(l,{variant:"h6",gutterBottom:!0,fontWeight:600,color:"#2c3e50",children:e.jsxs(o,{component:"span",sx:{display:"inline-flex",alignItems:"center",gap:1},children:[e.jsx(Tt,{fontSize:"small"}),"Associations"]})}),e.jsxs(C,{container:!0,spacing:2,children:[e.jsx(C,{item:!0,xs:12,children:e.jsx(I,{select:!0,fullWidth:!0,label:"Module",size:"medium",value:p.module,onChange:t=>N("module",t.target.value),sx:{mb:2},children:$.map(t=>e.jsx(j,{value:t._id,children:t.title||t.name},t._id))})}),e.jsx(C,{item:!0,xs:12,children:e.jsxs(I,{select:!0,fullWidth:!0,label:"Parent Category",size:"medium",value:p.parentCategory,onChange:t=>N("parentCategory",t.target.value),children:[e.jsx(j,{value:"",children:e.jsx("em",{children:"None (Root Category)"})}),y.filter(t=>!t.parentCategory&&t.module?._id===p.module&&t.id!==D.categoryId).map(t=>e.jsx(j,{value:t.id,children:t.names.default},t.id))]})})]})]})}),e.jsx(P,{variant:"outlined",sx:{mb:3,borderRadius:2},children:e.jsxs(O,{children:[e.jsx(l,{variant:"h6",gutterBottom:!0,fontWeight:600,color:"#2c3e50",children:e.jsxs(o,{component:"span",sx:{display:"inline-flex",alignItems:"center",gap:1},children:[e.jsx(Je,{fontSize:"small"}),"Settings"]})}),e.jsxs(C,{container:!0,spacing:2,children:[e.jsx(C,{item:!0,xs:12,children:e.jsx(I,{fullWidth:!0,label:"Display Order",type:"number",size:"medium",value:p.displayOrder,onChange:t=>N("displayOrder",parseInt(t.target.value)||0),InputProps:{startAdornment:e.jsx(ve,{position:"start",children:e.jsx(l,{color:"text.secondary",children:"#"})})}})}),e.jsx(C,{item:!0,xs:12,children:e.jsxs(o,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",p:1},children:[e.jsxs(o,{children:[e.jsx(l,{variant:"body1",fontWeight:500,children:"Active Status"}),e.jsx(l,{variant:"caption",color:"text.secondary",children:"Show/Hide category from listings"})]}),e.jsx(se,{checked:p.isActive,onChange:t=>N("isActive",t.target.checked),color:"primary",size:"medium"})]})}),e.jsx(C,{item:!0,xs:12,children:e.jsxs(o,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",p:1},children:[e.jsxs(o,{children:[e.jsx(l,{variant:"body1",fontWeight:500,children:"Featured"}),e.jsx(l,{variant:"caption",color:"text.secondary",children:"Highlight as featured category"})]}),e.jsx(se,{checked:p.isFeatured,onChange:t=>N("isFeatured",t.target.checked),color:"warning",size:"medium"})]})})]})]})})]})]})})}),e.jsxs(Ye,{sx:{p:3,borderTop:"1px solid #e0e0e0",bgcolor:"white"},children:[e.jsx(v,{onClick:ee,variant:"outlined",sx:{textTransform:"none",px:4,borderRadius:2,borderColor:"#ddd",color:"#666","&:hover":{borderColor:"#999",bgcolor:"#f5f5f5"}},disabled:D.loading,children:"Cancel"}),e.jsx(v,{onClick:nt,variant:"contained",color:"primary",sx:{textTransform:"none",px:5,borderRadius:2,bgcolor:"#1976d2",fontWeight:600,boxShadow:"0 4px 12px rgba(25, 118, 210, 0.3)","&:hover":{bgcolor:"#1565c0",boxShadow:"0 6px 16px rgba(25, 118, 210, 0.4)"}},disabled:D.loading||!p.name.trim(),startIcon:D.loading?e.jsx(H,{size:20,color:"inherit"}):null,children:D.loading?"Saving...":"Save Changes"})]})]}),e.jsxs(He,{open:K.open,onClose:()=>X({open:!1,categoryId:null,categoryName:""}),maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:3}},children:[e.jsx(Ge,{sx:{fontWeight:600,borderBottom:"1px solid #e0e0e0",pb:2},children:e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(oe,{sx:{bgcolor:"#ffebee",color:"#d32f2f",width:40,height:40},children:e.jsx(we,{})}),e.jsxs(o,{children:[e.jsx(l,{variant:"h6",color:"#d32f2f",children:"Confirm Delete"}),e.jsx(l,{variant:"body2",color:"text.secondary",children:"This action cannot be undone"})]})]})}),e.jsxs(Ve,{sx:{p:3},children:[e.jsx(be,{severity:"warning",sx:{mb:2,borderRadius:2},children:"Warning: Deleting a category will also remove all associated subcategories and references."}),e.jsxs(l,{children:["Are you sure you want to delete ",e.jsxs("strong",{children:['"',K.categoryName,'"']}),"?"]})]}),e.jsxs(Ye,{sx:{p:3,gap:2},children:[e.jsx(v,{onClick:()=>X({open:!1,categoryId:null,categoryName:""}),variant:"outlined",sx:{textTransform:"none",px:4,borderRadius:2},disabled:f,children:"Cancel"}),e.jsx(v,{onClick:ot,variant:"contained",color:"error",sx:{textTransform:"none",px:4,borderRadius:2,bgcolor:"#d32f2f","&:hover":{bgcolor:"#c62828"}},disabled:f,startIcon:f?e.jsx(H,{size:20,color:"inherit"}):null,children:f?"Deleting...":"Delete Category"})]})]}),e.jsx(Ue,{open:xe.open,autoHideDuration:4e3,onClose:Oe,anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(be,{onClose:Oe,severity:xe.severity,variant:"filled",sx:{width:"100%",borderRadius:2,boxShadow:"0 4px 12px rgba(0,0,0,0.15)"},children:xe.message})})]})}export{_t as default};
