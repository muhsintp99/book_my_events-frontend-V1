import{a9 as K,a as J,r as j,j as e,B as v,C as _,T as y,K as Q,G as r,g as l,F as W,I as T,H as M,M as N,a3 as w,a8 as $,o as F,O,d as B,Z as X,A as Y}from"./index-Bv9CUdV4.js";import{F as k}from"./FormControlLabel-B4kLMrdC.js";import{C as L}from"./Checkbox-DR-pBy9q.js";const z="https://api.bookmyevent.ae/api",R=`${z}/venues`,ee=`${z}/zones`,te=`${z}/categories`,ne=()=>{try{return localStorage.getItem("token")||sessionStorage.getItem("token")}catch{return null}},A=(m="GET",g=null)=>{const x=ne(),u={method:m,headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include",mode:"cors"};return x&&(u.headers.Authorization=`Bearer ${x}`),g&&(u.body=JSON.stringify(g)),u},D=async(m,g,x=2)=>{for(let u=0;u<=x;u++)try{const h=new AbortController,f=setTimeout(()=>h.abort(),1e4),c=await fetch(m,{...g,signal:h.signal});if(clearTimeout(f),!c.ok){const E=await c.text(),C=c.status===401?"Unauthorized":c.status===403?"Forbidden":c.status===404?"Not Found":`HTTP ${c.status}: ${E}`;throw new Error(C)}return await c.json()}catch(h){if(u===x)throw h;await new Promise(f=>setTimeout(f,1e3))}},ie=()=>{const{id:m}=K(),g=J(),[x,u]=j.useState(!0),[h,f]=j.useState(!1),[c,E]=j.useState([]),[C,U]=j.useState([]),[S,H]=j.useState({open:!1,message:"",severity:"success"}),[a,d]=j.useState({venueName:"",venueAddress:"",venueState:"",venuePostalCode:"",venueCountry:"",zone:"",ownerManagerName:"",ownerManagerPhone:"",ownerManagerEmail:"",maxGuestsSeated:"",maxGuestsStanding:"",parkingCapacity:"",foodCateringAvailability:!1,alcoholPermitted:!1,isActive:!0,isTopPick:!1,categories:[],amenities:[],openingHours:"",closingHours:"",pricingSchedule:{monday:{morning:{perDay:""},evening:{perDay:""}},tuesday:{morning:{perDay:""},evening:{perDay:""}},wednesday:{morning:{perDay:""},evening:{perDay:""}},thursday:{morning:{perDay:""},evening:{perDay:""}},friday:{morning:{perDay:""},evening:{perDay:""}},saturday:{morning:{perDay:""},evening:{perDay:""}},sunday:{morning:{perDay:""},evening:{perDay:""}}}});j.useEffect(()=>{(async()=>{try{const[n,i,p]=await Promise.all([D(`${R}/${m}`,A()),D(ee,A()),D(te,A())]),s=n.data;d({venueName:s.venueName||"",venueAddress:s.venueAddress||"",venueState:s.venueState||"",venuePostalCode:s.venuePostalCode||"",venueCountry:s.venueCountry||"",zone:s.zone?._id||s.zone||"",ownerManagerName:s.ownerManagerName||"",ownerManagerPhone:s.ownerManagerPhone||s.contactPhone||"",ownerManagerEmail:s.ownerManagerEmail||s.contactEmail||"",maxGuestsSeated:s.maxGuestsSeated||"",maxGuestsStanding:s.maxGuestsStanding||"",parkingCapacity:s.parkingCapacity||"",foodCateringAvailability:s.foodCateringAvailability||!1,alcoholPermitted:s.alcoholPermitted||!1,isActive:s.isActive??!0,isTopPick:s.isTopPick||!1,categories:(s.categories||[]).map(P=>P._id||P),amenities:s.amenities||[],openingHours:s.openingHours||"",closingHours:s.closingHours||"",pricingSchedule:s.pricingSchedule||a.pricingSchedule}),E(i.data||[]),U(p.data||[])}catch(n){b(`Failed to load data: ${n.message}`,"error")}finally{u(!1)}})()},[m]);const b=(t,n="success")=>{H({open:!0,message:t,severity:n})},I=()=>{H({...S,open:!1})},o=t=>{const{name:n,value:i,checked:p,type:s}=t.target;d(P=>({...P,[n]:s==="checkbox"?p:i}))},G=(t,n,i,p)=>{d(s=>({...s,pricingSchedule:{...s.pricingSchedule,[t]:{...s.pricingSchedule[t],[n]:{...s.pricingSchedule[t][n],[i]:p}}}}))},V=t=>{const n=t.target.value;d(i=>({...i,amenities:typeof n=="string"?n.split(","):n}))},Z=t=>{const n=t.target.value;d(i=>({...i,categories:typeof n=="string"?n.split(","):n}))},q=async t=>{if(t.preventDefault(),!a.venueName||!a.zone){b("Venue name and zone are required","warning");return}f(!0);try{const n={...a,contactPhone:a.ownerManagerPhone,contactEmail:a.ownerManagerEmail},i=await D(`${R}/${m}`,A("PUT",n));if(!i.success)throw new Error(i.message||"Update failed");b("Venue updated successfully!","success"),setTimeout(()=>{g("/venues",{state:{updatedVenue:{...i.data,_id:m}},replace:!0})},1e3)}catch(n){b(`Update failed: ${n.message}`,"error")}finally{f(!1)}};return x?e.jsxs(v,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh",children:[e.jsx(_,{}),e.jsx(y,{ml:2,children:"Loading venue..."})]}):e.jsxs(v,{p:3,maxWidth:"lg",mx:"auto",children:[e.jsxs(Q,{elevation:3,sx:{p:4},children:[e.jsx(y,{variant:"h5",gutterBottom:!0,color:"primary",children:"Edit Venue"}),e.jsx("form",{onSubmit:q,children:e.jsxs(r,{container:!0,spacing:3,children:[e.jsx(r,{item:!0,xs:12,md:6,children:e.jsx(l,{fullWidth:!0,label:"Venue Name",name:"venueName",value:a.venueName,onChange:o,required:!0})}),e.jsx(r,{item:!0,xs:12,md:6,children:e.jsxs(W,{fullWidth:!0,required:!0,children:[e.jsx(T,{children:"Zone"}),e.jsx(M,{name:"zone",value:a.zone,onChange:o,children:c.map(t=>e.jsx(N,{value:t._id,children:t.name},t._id))})]})}),e.jsx(r,{item:!0,xs:12,children:e.jsx(l,{fullWidth:!0,label:"Address",name:"venueAddress",value:a.venueAddress,onChange:o,multiline:!0,rows:2})}),e.jsx(r,{item:!0,xs:12,md:4,children:e.jsx(l,{fullWidth:!0,label:"State",name:"venueState",value:a.venueState,onChange:o})}),e.jsx(r,{item:!0,xs:12,md:4,children:e.jsx(l,{fullWidth:!0,label:"Postal Code",name:"venuePostalCode",value:a.venuePostalCode,onChange:o})}),e.jsx(r,{item:!0,xs:12,md:4,children:e.jsx(l,{fullWidth:!0,label:"Country",name:"venueCountry",value:a.venueCountry,onChange:o})}),e.jsx(r,{item:!0,xs:12,children:e.jsx(y,{variant:"subtitle1",gutterBottom:!0,children:"Contact Person"})}),e.jsx(r,{item:!0,xs:12,md:4,children:e.jsx(l,{fullWidth:!0,label:"Name",name:"ownerManagerName",value:a.ownerManagerName,onChange:o})}),e.jsx(r,{item:!0,xs:12,md:4,children:e.jsx(l,{fullWidth:!0,label:"Phone",name:"ownerManagerPhone",value:a.ownerManagerPhone,onChange:o})}),e.jsx(r,{item:!0,xs:12,md:4,children:e.jsx(l,{fullWidth:!0,label:"Email",name:"ownerManagerEmail",value:a.ownerManagerEmail,onChange:o})}),e.jsx(r,{item:!0,xs:12,children:e.jsx(y,{variant:"subtitle1",gutterBottom:!0,children:"Capacity & Parking"})}),e.jsx(r,{item:!0,xs:12,md:3,children:e.jsx(l,{fullWidth:!0,label:"Seated",name:"maxGuestsSeated",type:"number",value:a.maxGuestsSeated,onChange:o})}),e.jsx(r,{item:!0,xs:12,md:3,children:e.jsx(l,{fullWidth:!0,label:"Standing",name:"maxGuestsStanding",type:"number",value:a.maxGuestsStanding,onChange:o})}),e.jsx(r,{item:!0,xs:12,md:3,children:e.jsx(l,{fullWidth:!0,label:"Parking",name:"parkingCapacity",value:a.parkingCapacity,onChange:o})}),e.jsx(r,{item:!0,xs:12,md:3,children:e.jsxs(v,{display:"flex",gap:2,flexWrap:"wrap",children:[e.jsx(k,{control:e.jsx(w,{checked:a.foodCateringAvailability,onChange:t=>d(n=>({...n,foodCateringAvailability:t.target.checked}))}),label:"Catering"}),e.jsx(k,{control:e.jsx(w,{checked:a.alcoholPermitted,onChange:t=>d(n=>({...n,alcoholPermitted:t.target.checked}))}),label:"Alcohol"})]})}),e.jsx(r,{item:!0,xs:12,md:6,children:e.jsxs(W,{fullWidth:!0,children:[e.jsx(T,{children:"Categories"}),e.jsx(M,{multiple:!0,value:a.categories,onChange:Z,input:e.jsx(O,{label:"Categories"}),renderValue:t=>e.jsx(v,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:t.map(n=>{const i=C.find(p=>p._id===n);return e.jsx(F,{label:i?.title||n,size:"small"},n)})}),children:C.map(t=>e.jsxs(N,{value:t._id,children:[e.jsx(L,{checked:a.categories.includes(t._id)}),e.jsx($,{primary:t.title})]},t._id))})]})}),e.jsx(r,{item:!0,xs:12,md:6,children:e.jsxs(W,{fullWidth:!0,children:[e.jsx(T,{children:"Amenities"}),e.jsx(M,{multiple:!0,value:a.amenities,onChange:V,input:e.jsx(O,{label:"Amenities"}),renderValue:t=>e.jsx(v,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:t.map(n=>e.jsx(F,{label:n,size:"small"},n))}),children:["WiFi","Projector","Sound System","Stage","Kitchen","Air Conditioning","Outdoor Space"].map(t=>e.jsxs(N,{value:t,children:[e.jsx(L,{checked:a.amenities.includes(t)}),e.jsx($,{primary:t})]},t))})]})}),e.jsx(r,{item:!0,xs:12,md:6,children:e.jsx(l,{fullWidth:!0,label:"Opening Hours",name:"openingHours",value:a.openingHours,onChange:o,placeholder:"09:00"})}),e.jsx(r,{item:!0,xs:12,md:6,children:e.jsx(l,{fullWidth:!0,label:"Closing Hours",name:"closingHours",value:a.closingHours,onChange:o,placeholder:"22:00"})}),e.jsx(r,{item:!0,xs:12,children:e.jsxs(v,{display:"flex",gap:3,children:[e.jsx(k,{control:e.jsx(w,{checked:a.isActive,onChange:t=>d(n=>({...n,isActive:t.target.checked}))}),label:"Active"}),e.jsx(k,{control:e.jsx(w,{checked:a.isTopPick,onChange:t=>d(n=>({...n,isTopPick:t.target.checked}))}),label:"Top Pick"})]})}),e.jsxs(r,{item:!0,xs:12,children:[e.jsx(y,{variant:"subtitle1",gutterBottom:!0,children:"Pricing Schedule (Per Day)"}),e.jsx(r,{container:!0,spacing:2,children:Object.keys(a.pricingSchedule).map(t=>e.jsxs(r,{item:!0,xs:12,children:[e.jsx(y,{variant:"body2",fontWeight:"medium",textTransform:"capitalize",children:t}),e.jsxs(r,{container:!0,spacing:1,children:[e.jsx(r,{item:!0,xs:6,children:e.jsx(l,{fullWidth:!0,size:"small",label:"Morning",type:"number",value:a.pricingSchedule[t].morning.perDay,onChange:n=>G(t,"morning","perDay",n.target.value),InputProps:{startAdornment:"AED"}})}),e.jsx(r,{item:!0,xs:6,children:e.jsx(l,{fullWidth:!0,size:"small",label:"Evening",type:"number",value:a.pricingSchedule[t].evening.perDay,onChange:n=>G(t,"evening","perDay",n.target.value),InputProps:{startAdornment:"AED"}})})]})]},t))})]}),e.jsx(r,{item:!0,xs:12,children:e.jsxs(v,{display:"flex",gap:2,mt:3,children:[e.jsx(B,{variant:"contained",color:"primary",type:"submit",disabled:h,startIcon:h?e.jsx(_,{size:20}):null,children:h?"Saving...":"Save Changes"}),e.jsx(B,{variant:"outlined",onClick:()=>g("/venues"),children:"Cancel"})]})})]})})]}),e.jsx(X,{open:S.open,autoHideDuration:5e3,onClose:I,anchorOrigin:{vertical:"top",horizontal:"center"},children:e.jsx(Y,{onClose:I,severity:S.severity,variant:"filled",children:S.message})})]})};export{ie as default};
