import{h as le,j as e,r as x,J as ye,K as ke,B as d,G as i,S as Q,o as p,g as v,b as Pe,C as Y,T as o,N as Te,Q as Ce,U as Z,V as h,W as Se,a3 as q,c as k,aX as Ae,X as ee,Y as we,_ as E,$ as V,a6 as te,a4 as se,a2 as f,a0 as N,aT as Ie,a1 as L,d as b,aV as Be,Z as We,A as De}from"./index-CXSvRfrP.js";import{S as _e}from"./Search-CWf_i7h6.js";import{L as $e}from"./LocationOn-CDNTtImb.js";import{C as ie}from"./CheckCircle-D1WeS_Uo.js";import{F as ae}from"./FormControlLabel-CdvNTG3X.js";import{C as re}from"./Checkbox-BtgMy4Ce.js";import{A as Ee}from"./Add-3Lf9n06z.js";const Ve=le([e.jsx("path",{d:"m21 5-9-4-9 4v6c0 5.55 3.84 10.74 9 12 2.3-.56 4.33-1.9 5.88-3.71l-3.12-3.12c-1.94 1.29-4.58 1.07-6.29-.64-1.95-1.95-1.95-5.12 0-7.07s5.12-1.95 7.07 0c1.71 1.71 1.92 4.35.64 6.29l2.9 2.9C20.29 15.69 21 13.38 21 11z"},"0"),e.jsx("circle",{cx:"12",cy:"12",r:"3"},"1")]),Ne=le(e.jsx("path",{d:"M19 13H5v-2h14z"})),Ue=()=>{const[W,y]=x.useState([]),[D,z]=x.useState([]),[F,oe]=x.useState(""),[ne,w]=x.useState(!1),[I,R]=x.useState(null),[ce,P]=x.useState(!1),[n,de]=x.useState(null),[he,T]=x.useState(!1),[r,u]=x.useState(null),[xe,G]=x.useState(!0),[_,O]=x.useState(!1),[B,j]=x.useState({open:!1,message:"",severity:"success"}),[m,H]=x.useState(0),U="https://api.bookmyevent.ae/api",C=`${U}/photography-packages`,ge=()=>localStorage.getItem("token")||sessionStorage.getItem("token"),S=(t="GET",a=null)=>{const s=ge(),l={method:t,headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include"};return s&&(l.headers.Authorization=`Bearer ${s}`),a&&(l.body=JSON.stringify(a)),l},A=async(t,a,s=2)=>{for(let l=0;l<=s;l++)try{const c=new AbortController,g=setTimeout(()=>c.abort(),1e4),$=await fetch(t,{...a,signal:c.signal});if(clearTimeout(g),!$.ok)throw new Error(`HTTP ${$.status}`);return await $.json()}catch(c){if(l===s)throw c;await new Promise(g=>setTimeout(g,1e3))}},X=t=>t?t.startsWith("http")?t:`https://api.bookmyevent.ae${t}`:"",J=async()=>{try{G(!0);const t=await A(C,S());if(t?.data&&Array.isArray(t.data)){const a=t.data.map((s,l)=>({id:l+1,_id:s._id,photographyId:s.photographyId,packageTitle:s.packageTitle||"Untitled",description:s.description||"",categories:s.categories||[],categoryNames:(s.categories||[]).map(c=>c.title).join(", ")||"—",price:s.price??0,providerName:`${s.provider?.firstName||""} ${s.provider?.lastName||""}`.trim()||"—",basicAddons:s.basicAddons||[],includedServices:s.includedServices||[],travelToVenue:s.travelToVenue??!1,advanceBookingAmount:s.advanceBookingAmount||"",cancellationPolicy:s.cancellationPolicy||"",gallery:s.gallery||[],isTopPick:s.isTopPick??!1,isActive:s.isActive??!1}));z(a),y(a)}}catch(t){j({open:!0,message:`Error loading packages: ${t.message}`,severity:"error"})}finally{G(!1)}};x.useEffect(()=>{J()},[]);const ue=async t=>{const s=!W.find(l=>l._id===t).isTopPick;y(l=>l.map(c=>c._id===t?{...c,isTopPick:s}:c));try{await A(`${C}/${t}/toggle-top-pick`,S("PATCH")),j({open:!0,message:s?"Added to Top Picks":"Removed from Top Picks",severity:"success"})}catch{y(c=>c.map(g=>g._id===t?{...g,isTopPick:!s}:g)),j({open:!0,message:"Failed to update Top Pick",severity:"error"})}},je=async t=>{const s=!W.find(l=>l._id===t).isActive;y(l=>l.map(c=>c._id===t?{...c,isActive:s}:c));try{await A(`${C}/${t}/toggle-active`,S("PATCH")),j({open:!0,message:s?"Package Activated":"Package Deactivated",severity:"success"})}catch{y(c=>c.map(g=>g._id===t?{...g,isActive:!s}:g)),j({open:!0,message:"Failed to update status",severity:"error"})}},me=t=>{de(t),P(!0)},M=t=>{u({...t}),H(0),T(!0)},pe=t=>{R(t),w(!0)},ve=async()=>{try{await A(`${C}/${I._id}`,S("DELETE")),y(t=>t.filter(a=>a._id!==I._id)),z(t=>t.filter(a=>a._id!==I._id)),j({open:!0,message:"Package deleted successfully",severity:"success"})}catch{j({open:!0,message:"Delete failed",severity:"error"})}finally{w(!1),R(null)}},fe=async()=>{if(r){O(!0);try{const t={packageTitle:r.packageTitle,description:r.description,price:Number(r.price),basicAddons:r.basicAddons,includedServices:r.includedServices,travelToVenue:r.travelToVenue,advanceBookingAmount:r.advanceBookingAmount,cancellationPolicy:r.cancellationPolicy};await A(`${C}/${r._id}`,S("PATCH",t)),await J(),T(!1),j({open:!0,message:"Package updated successfully!",severity:"success"})}catch(t){j({open:!0,message:"Update failed: "+t.message,severity:"error"})}finally{O(!1)}}},be=W.filter(t=>`${t.packageTitle} ${t.providerName} ${t.categoryNames}`.toLowerCase().includes(F.toLowerCase())),K={drone_video:"Drone Video",pre_wedding:"Pre-Wedding",candid_photography:"Candid Photography",traditional_photography:"Traditional Photography",video_editing:"Video Editing",photo_album:"Photo Album",led_wall:"LED Wall",crane_shoot:"Crane Shoot"};return e.jsxs(ye,{component:ke,sx:{maxWidth:"100%",overflowX:"auto"},children:[e.jsx(d,{sx:{p:2,bgcolor:"#f8fafc",borderBottom:"1px solid #e2e8f0"},children:e.jsxs(i,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(i,{item:!0,xs:12,md:8,children:e.jsxs(Q,{direction:"row",spacing:2,flexWrap:"wrap",children:[e.jsx(p,{label:`Total: ${D.length}`,color:"primary"}),e.jsx(p,{label:`Active: ${D.filter(t=>t.isActive).length}`,color:"success"}),e.jsx(p,{label:`Top Pick: ${D.filter(t=>t.isTopPick).length}`,color:"secondary"})]})}),e.jsx(i,{item:!0,xs:12,md:4,children:e.jsx(v,{fullWidth:!0,size:"small",placeholder:"Search packages...",value:F,onChange:t=>oe(t.target.value),InputProps:{startAdornment:e.jsx(Pe,{position:"start",children:e.jsx(_e,{})})}})})]})}),xe?e.jsxs(d,{sx:{p:8,textAlign:"center"},children:[e.jsx(Y,{}),e.jsx(o,{sx:{mt:2},children:"Loading packages..."})]}):e.jsxs(Te,{stickyHeader:!0,children:[e.jsx(Ce,{children:e.jsxs(Z,{sx:{bgcolor:"#f1f5f9"},children:[e.jsx(h,{children:"#"}),e.jsx(h,{children:"Package"}),e.jsx(h,{children:"Price"}),e.jsx(h,{children:"Provider"}),e.jsx(h,{children:"Add-ons"}),e.jsx(h,{children:"Top"}),e.jsx(h,{children:"Status"}),e.jsx(h,{children:"Actions"})]})}),e.jsx(Se,{children:be.map(t=>e.jsxs(Z,{hover:!0,children:[e.jsx(h,{children:t.id}),e.jsxs(h,{children:[e.jsx(o,{fontWeight:"medium",children:t.packageTitle}),e.jsx(o,{variant:"caption",color:"textSecondary",children:t.categoryNames})]}),e.jsxs(h,{children:["₹",t.price.toLocaleString()]}),e.jsx(h,{children:t.providerName}),e.jsx(h,{children:t.basicAddons.length}),e.jsx(h,{children:e.jsx(q,{size:"small",checked:t.isTopPick,onChange:()=>ue(t._id)})}),e.jsx(h,{children:e.jsx(q,{size:"small",checked:t.isActive,onChange:()=>je(t._id)})}),e.jsxs(h,{children:[e.jsx(k,{size:"small",onClick:()=>me(t),children:e.jsx(Ae,{})}),e.jsx(k,{size:"small",color:"primary",onClick:()=>M(t),children:e.jsx(ee,{})}),e.jsx(k,{size:"small",color:"error",onClick:()=>pe(t),children:e.jsx(we,{})})]})]},t._id))})]}),e.jsxs(E,{open:ce,onClose:()=>P(!1),maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:3,overflow:"hidden",boxShadow:"0 20px 60px rgba(0,0,0,0.2)"}},children:[e.jsx(V,{sx:{bgcolor:"#e91e63",color:"white",p:3},children:e.jsxs(d,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(d,{children:[e.jsx(o,{variant:"h5",fontWeight:"bold",children:n?.packageTitle||"Package Details"}),e.jsxs(o,{variant:"body2",sx:{opacity:.9,mt:.5},children:["ID: ",n?.photographyId||"—"]})]}),e.jsx(k,{onClick:()=>P(!1),sx:{color:"white"},children:e.jsx(te,{})})]})}),n?.gallery?.length>0&&e.jsx(d,{sx:{height:320,bgcolor:"#000"},children:e.jsx("img",{src:X(n.gallery[0]),alt:"Package cover",style:{width:"100%",height:"100%",objectFit:"cover"},onError:t=>t.target.src="https://via.placeholder.com/800x400?text=No+Image"})}),e.jsxs(se,{value:m,onChange:(t,a)=>handkerchiefTabValue(a),centered:!0,sx:{bgcolor:"#f8f9fa"},children:[e.jsx(f,{label:"Basic Information"}),e.jsx(f,{label:"Pricing & Policies"}),e.jsx(f,{label:"Features & Gallery"})]}),e.jsx(N,{sx:{p:4,bgcolor:"#fafafa"},children:n&&e.jsxs(e.Fragment,{children:[m===0&&e.jsxs(i,{container:!0,spacing:3,children:[e.jsxs(i,{item:!0,xs:12,children:[e.jsx(o,{variant:"h6",gutterBottom:!0,children:"Description"}),e.jsx(o,{children:n.description||"No description provided"})]}),e.jsxs(i,{item:!0,xs:12,sm:6,children:[e.jsx(o,{variant:"subtitle2",color:"textSecondary",children:"Categories"}),e.jsx(d,{sx:{mt:1,display:"flex",gap:1,flexWrap:"wrap"},children:n.categories.map(t=>e.jsx(p,{label:t.title,size:"small",color:"primary"},t._id))})]}),e.jsxs(i,{item:!0,xs:12,sm:6,children:[e.jsx(o,{variant:"subtitle2",color:"textSecondary",children:"Provider"}),e.jsx(o,{fontWeight:"bold",children:n.providerName})]}),n.basicAddons.length>0&&e.jsxs(i,{item:!0,xs:12,children:[e.jsx(o,{variant:"subtitle2",color:"textSecondary",children:"Add-ons"}),e.jsx(d,{sx:{mt:1,display:"flex",gap:1,flexWrap:"wrap"},children:n.basicAddons.map(t=>e.jsx(p,{label:K[t]||t,color:"secondary",variant:"outlined",size:"small"},t))})]})]}),m===1&&e.jsxs(i,{container:!0,spacing:4,children:[e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsxs(d,{textAlign:"center",p:3,bgcolor:"white",borderRadius:3,boxShadow:1,children:[e.jsx(o,{variant:"h6",color:"success.main",fontWeight:"bold",children:"Base Price"}),e.jsxs(o,{variant:"h4",fontWeight:"bold",color:"primary",children:["₹",n.price.toLocaleString()]})]})}),e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsxs(d,{textAlign:"center",p:3,bgcolor:"white",borderRadius:3,boxShadow:1,children:[e.jsx(o,{variant:"h6",color:"error.main",fontWeight:"bold",children:"Final Price"}),e.jsxs(o,{variant:"h4",fontWeight:"bold",color:"error",children:["₹",n.price.toLocaleString()]}),e.jsx(o,{variant:"caption",color:"textSecondary",children:"(No discounts applied)"})]})}),n.advanceBookingAmount&&e.jsx(i,{item:!0,xs:12,children:e.jsxs(d,{display:"flex",alignItems:"center",gap:2,children:[e.jsx(Ie,{color:"primary"}),e.jsxs(o,{children:[e.jsx("strong",{children:"Advance Booking:"})," ",n.advanceBookingAmount]})]})}),n.cancellationPolicy&&e.jsx(i,{item:!0,xs:12,children:e.jsxs(d,{display:"flex",alignItems:"flex-start",gap:2,mt:2,children:[e.jsx(Ve,{color:"warning"}),e.jsxs(d,{children:[e.jsx(o,{fontWeight:"bold",color:"warning.main",children:"Cancellation Policy"}),e.jsx(o,{variant:"body2",children:n.cancellationPolicy})]})]})})]}),m===2&&e.jsxs(i,{container:!0,spacing:3,children:[e.jsxs(i,{item:!0,xs:12,children:[e.jsx(o,{variant:"h6",gutterBottom:!0,children:"Features"}),e.jsxs(Q,{direction:"row",spacing:2,flexWrap:"wrap",children:[e.jsx(p,{icon:e.jsx($e,{}),label:n.travelToVenue?"Travel Included":"No Travel",color:n.travelToVenue?"success":"default"}),e.jsx(p,{icon:e.jsx(ie,{}),label:n.isTopPick?"Top Pick":"Regular",color:n.isTopPick?"secondary":"default"}),e.jsx(p,{icon:e.jsx(ie,{}),label:n.isActive?"Active":"Inactive",color:n.isActive?"success":"error"})]})]}),n.gallery.length>0&&e.jsxs(i,{item:!0,xs:12,children:[e.jsx(o,{variant:"h6",gutterBottom:!0,children:"Gallery"}),e.jsx(i,{container:!0,spacing:2,children:n.gallery.map((t,a)=>e.jsx(i,{item:!0,children:e.jsx("img",{src:X(t),alt:`Gallery ${a+1}`,style:{width:150,height:150,objectFit:"cover",borderRadius:8,boxShadow:"0 4px 10px rgba(0,0,0,0.1)"},onError:s=>s.target.src="https://via.placeholder.com/150?text=No+Image"})},a))})]}),n.includedServices.length>0&&e.jsxs(i,{item:!0,xs:12,children:[e.jsx(o,{variant:"h6",gutterBottom:!0,sx:{mt:4},children:"Included Services"}),n.includedServices.map((t,a)=>e.jsxs(d,{sx:{mb:3,p:3,bgcolor:"white",borderRadius:2,boxShadow:1},children:[e.jsx(o,{fontWeight:"bold",color:"primary",children:t.title}),e.jsx(d,{sx:{mt:1,display:"flex",flexWrap:"wrap",gap:1},children:t.items.map((s,l)=>e.jsx(p,{label:s,size:"small",color:"info",variant:"outlined"},l))})]},a))]})]})]})}),e.jsxs(L,{sx:{p:3,bgcolor:"#f8f9fa",justifyContent:"space-between"},children:[e.jsx(b,{variant:"outlined",startIcon:e.jsx(ee,{}),onClick:()=>{P(!1),M(n)},children:"Edit Package"}),e.jsx(b,{variant:"contained",color:"error",onClick:()=>P(!1),children:"Close"})]})]}),e.jsxs(E,{open:he,onClose:()=>T(!1),maxWidth:"lg",fullWidth:!0,children:[e.jsx(V,{sx:{bgcolor:"#bb1010ff",color:"white"},children:e.jsxs(d,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(o,{variant:"h6",children:"Edit Photography Package"}),e.jsx(k,{onClick:()=>T(!1),sx:{color:"white"},children:e.jsx(te,{})})]})}),e.jsx(N,{dividers:!0,sx:{bgcolor:"#f9f9f9"},children:r&&e.jsxs(e.Fragment,{children:[e.jsxs(se,{value:m,onChange:(t,a)=>H(a),sx:{mb:3,borderBottom:1,borderColor:"divider"},children:[e.jsx(f,{label:"Basic Info"}),e.jsx(f,{label:"Add-ons & Services"}),e.jsx(f,{label:"Pricing & Policy"}),e.jsx(f,{label:"Gallery"})]}),m===3&&e.jsxs(d,{children:[e.jsx(o,{variant:"h6",gutterBottom:!0,children:"Current Gallery"}),r.gallery.length>0?e.jsx(i,{container:!0,spacing:3,children:r.gallery.map((t,a)=>e.jsx(i,{item:!0,children:e.jsx("img",{src:U+t,alt:`Gallery ${a+1}`,style:{width:200,height:200,objectFit:"cover",borderRadius:12,boxShadow:"0 6px 16px rgba(0,0,0,0.15)"},onError:s=>s.target.src="https://via.placeholder.com/200?text=No+Image"})},a))}):e.jsx(o,{color:"textSecondary",children:"No images uploaded"})]}),m===0&&e.jsxs(i,{container:!0,spacing:3,children:[e.jsx(i,{item:!0,xs:12,md:8,children:e.jsx(v,{fullWidth:!0,label:"Package Title",value:r.packageTitle,onChange:t=>u({...r,packageTitle:t.target.value})})}),e.jsx(i,{item:!0,xs:12,md:4,children:e.jsx(v,{fullWidth:!0,label:"Price (₹)",type:"number",value:r.price,onChange:t=>u({...r,price:t.target.value})})}),e.jsx(i,{item:!0,xs:12,children:e.jsx(v,{fullWidth:!0,multiline:!0,rows:4,label:"Description",value:r.description,onChange:t=>u({...r,description:t.target.value})})})]}),m===1&&e.jsxs(d,{children:[e.jsx(o,{variant:"h6",gutterBottom:!0,children:"Basic Add-ons"}),e.jsx(i,{container:!0,spacing:2,children:Object.entries(K).map(([t,a])=>e.jsx(i,{item:!0,xs:6,md:4,children:e.jsx(ae,{control:e.jsx(re,{checked:r.basicAddons.includes(t),onChange:s=>{const l=s.target.checked;u(c=>({...c,basicAddons:l?[...c.basicAddons,t]:c.basicAddons.filter(g=>g!==t)}))}}),label:a})},t))}),e.jsx(o,{variant:"h6",gutterBottom:!0,sx:{mt:4},children:"Included Services"}),r.includedServices.map((t,a)=>e.jsx(d,{sx:{p:3,mb:3,bgcolor:"white",borderRadius:2,boxShadow:1},children:e.jsxs(i,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(i,{item:!0,xs:10,children:e.jsx(v,{fullWidth:!0,label:"Service Title",value:t.title,onChange:s=>{const l=[...r.includedServices];l[a].title=s.target.value,u({...r,includedServices:l})}})}),e.jsx(i,{item:!0,xs:2,children:e.jsx(k,{color:"error",onClick:()=>u(s=>({...s,includedServices:s.includedServices.filter((l,c)=>c!==a)})),children:e.jsx(Ne,{})})}),e.jsx(i,{item:!0,xs:12,children:e.jsx(v,{fullWidth:!0,multiline:!0,label:"Items (comma separated)",value:t.items.join(", "),onChange:s=>{const l=[...r.includedServices];l[a].items=s.target.value.split(",").map(c=>c.trim()).filter(Boolean),u({...r,includedServices:l})}})})]})},a)),e.jsx(b,{startIcon:e.jsx(Ee,{}),variant:"outlined",onClick:()=>u(t=>({...t,includedServices:[...t.includedServices,{title:"",items:[]}]})),children:"Add Service"})]}),m===2&&e.jsxs(i,{container:!0,spacing:3,children:[e.jsx(i,{item:!0,xs:12,md:6,children:e.jsx(v,{fullWidth:!0,label:"Advance Booking Amount",value:r.advanceBookingAmount,onChange:t=>u({...r,advanceBookingAmount:t.target.value})})}),e.jsx(i,{item:!0,xs:12,md:6,children:e.jsx(ae,{control:e.jsx(re,{checked:r.travelToVenue,onChange:t=>u({...r,travelToVenue:t.target.checked})}),label:"Travel to Venue Included"})}),e.jsx(i,{item:!0,xs:12,children:e.jsx(v,{fullWidth:!0,multiline:!0,rows:4,label:"Cancellation Policy",value:r.cancellationPolicy,onChange:t=>u({...r,cancellationPolicy:t.target.value})})})]})]})}),e.jsxs(L,{sx:{p:3,bgcolor:"#f0f2f5",justifyContent:"flex-end",gap:2},children:[e.jsx(b,{onClick:()=>T(!1),children:"Cancel"}),e.jsx(b,{variant:"contained",color:"primary",startIcon:_?e.jsx(Y,{size:20}):e.jsx(Be,{}),onClick:fe,disabled:_,children:_?"Saving...":"Save Changes"})]})]}),e.jsxs(E,{open:ne,onClose:()=>w(!1),children:[e.jsx(V,{children:"Delete Package?"}),e.jsx(N,{children:e.jsxs(o,{children:["Are you sure you want to delete ",e.jsx("strong",{children:I?.packageTitle}),"?"]})}),e.jsxs(L,{children:[e.jsx(b,{onClick:()=>w(!1),children:"Cancel"}),e.jsx(b,{color:"error",variant:"contained",onClick:ve,children:"Delete"})]})]}),e.jsx(We,{open:B.open,autoHideDuration:4e3,onClose:()=>j({...B,open:!1}),anchorOrigin:{vertical:"top",horizontal:"center"},children:e.jsx(De,{severity:B.severity,variant:"filled",children:B.message})})]})};export{Ue as default};
