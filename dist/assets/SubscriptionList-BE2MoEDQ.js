import{a as P,r as i,j as e,B as l,T as d,d as f,l as D,M as y,N as L,Q as _,U as w,V as r,W as N,a3 as O,c as g,X as R,Y as V}from"./index-Bv9CUdV4.js";import{A as $}from"./Add-DDEAaCyq.js";import{u,w as Q}from"./xlsx-eY9-kAPw.js";import{M as U}from"./MoreVert-DkmN7p9Q.js";const X=()=>{const h=P(),[c,x]=i.useState([]),[j,S]=i.useState(""),[b,o]=i.useState(null),C=!!b;i.useEffect(()=>{m()},[]);const m=async()=>{try{const a=await(await fetch("https://api.bookmyevent.ae/api/subscription/plan")).json();if(a.success){const t=a.plans.map(n=>({id:n._id,name:n.name,module:n.moduleId?.title||"Other",price:`â‚¹${n.price}`,duration:`${n.durationInDays} Days`,subscribers:n.subscriberCount||0,status:n.isActive}));x(t)}}catch(s){console.error("Error:",s)}},E=i.useMemo(()=>c.reduce((s,a)=>(s[a.module]||(s[a.module]=[]),s[a.module].push(a),s),{}),[c]),v=()=>h("/settings/sub/add"),k=s=>h(`/settings/sub/add/${s}`),I=async s=>{if(window.confirm("Are you sure you want to delete this plan?"))try{(await(await fetch(`https://api.bookmyevent.ae/api/subscription/plan/${s}`,{method:"DELETE"})).json()).success&&m()}catch{alert("Error deleting plan")}},T=s=>{x(a=>a.map(t=>t.id===s?{...t,status:!t.status}:t))},p=Object.entries(E).reduce((s,[a,t])=>{const n=t.filter(M=>M.name.toLowerCase().includes(j.toLowerCase()));return n.length&&(s[a]=n),s},{}),A=()=>{const s=[["Module","Package Name","Price","Duration","Subscribers","Status"],...c.map(n=>[n.module,n.name,n.price,n.duration,n.subscribers,n.status?"Active":"Inactive"])],a=new Blob([s.map(n=>n.join(",")).join(`
`)],{type:"text/csv"}),t=document.createElement("a");t.href=URL.createObjectURL(a),t.download="subscriptions.csv",t.click()},B=()=>{const s=u.json_to_sheet(c),a=u.book_new();u.book_append_sheet(a,s,"Subscriptions"),Q(a,"subscriptions.xlsx")};return e.jsxs(l,{sx:{padding:3,backgroundColor:"white"},children:[e.jsx(d,{variant:"h6",mb:3,children:"Subscription Package List"}),e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",mb:3},children:[e.jsx("input",{placeholder:"Search package...",value:j,onChange:s=>S(s.target.value),style:{padding:8,width:230}}),e.jsxs(l,{sx:{display:"flex",gap:2},children:[e.jsx(f,{variant:"contained",startIcon:e.jsx($,{}),onClick:v,children:"Add Subscription Package"}),e.jsx(f,{variant:"outlined",startIcon:e.jsx(U,{}),onClick:s=>o(s.currentTarget),children:"Export"}),e.jsxs(D,{anchorEl:b,open:C,onClose:()=>o(null),children:[e.jsx(y,{onClick:()=>{A(),o(null)},children:"CSV"}),e.jsx(y,{onClick:()=>{B(),o(null)},children:"Excel"})]})]})]}),Object.entries(p).map(([s,a])=>e.jsxs(l,{sx:{mb:5},children:[e.jsx(d,{variant:"h6",sx:{mb:2},children:s}),e.jsxs(L,{children:[e.jsx(_,{children:e.jsxs(w,{children:[e.jsx(r,{children:"SI"}),e.jsx(r,{children:"Package Name"}),e.jsx(r,{children:"Pricing"}),e.jsx(r,{children:"Duration"}),e.jsx(r,{children:"Subscribers"}),e.jsx(r,{children:"Status"}),e.jsx(r,{children:"Actions"})]})}),e.jsx(N,{children:a.map((t,n)=>e.jsxs(w,{children:[e.jsx(r,{children:n+1}),e.jsx(r,{children:t.name}),e.jsx(r,{children:t.price}),e.jsx(r,{children:t.duration}),e.jsx(r,{children:t.subscribers}),e.jsx(r,{children:e.jsx(O,{checked:t.status,onChange:()=>T(t.id)})}),e.jsxs(r,{children:[e.jsx(g,{onClick:()=>k(t.id),children:e.jsx(R,{})}),e.jsx(g,{onClick:()=>I(t.id),children:e.jsx(V,{})})]})]},t.id))})]})]},s)),Object.keys(p).length===0&&e.jsx(d,{align:"center",children:"No packages found"})]})};export{X as default};
