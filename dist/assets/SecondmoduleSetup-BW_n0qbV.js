import{u as re,r as l,j as e,B as p,K as j,T as d,g as G,d as C,C as _,A as H,N as ie,Q as le,U as M,V as s,W as se,k as ce,a3 as de,c as A,l as pe,M as ue,X as he,G as E,a6 as J}from"./index-C-AtCVLN.js";import{C as me,a as xe}from"./ckeditor-B4VA73eF.js";import{S as ge}from"./Search-B53zclG-.js";import{M as be}from"./MoreVert-BLw5UKgV.js";import{C as q}from"./CloudUpload-Di5NvzSY.js";const ke=()=>{const a=re(),[v,K]=l.useState(""),[x,g]=l.useState([]),[F,T]=l.useState(!1),[k,b]=l.useState(null),[r,u]=l.useState({name:"",description:"",appIcon:null,thumbnail:null}),[S,P]=l.useState(!1),[W,c]=l.useState(null),[O,y]=l.useState(!1),[h,I]=l.useState("add"),[B,z]=l.useState(null),[U,N]=l.useState(null),[V,D]=l.useState(null),[f,m]=l.useState({appIcon:null,thumbnail:null});l.useEffect(()=>{(async()=>{T(!0),b(null);try{const o=await fetch("https://api.bookmyevent.ae/api/secondary-modules");if(!o.ok)throw new Error("Failed to fetch secondary modules");const n=await o.json();g(n||[])}catch(o){console.error("Fetch error:",o),b(o.message)}finally{T(!1)}})()},[]);const w=()=>{u({name:"",description:"",appIcon:null,thumbnail:null}),m({appIcon:null,thumbnail:null}),c(null),z(null);const t=document.getElementById("app-icon-upload"),o=document.getElementById("thumbnail-upload");t&&(t.value=""),o&&(o.value="")},Q=()=>{w(),I("add"),y(!0)},X=t=>{I("edit"),z(t),u({name:t.title||"",description:t.description||"",appIcon:null,thumbnail:null}),m({appIcon:t.icon?`https://api.bookmyevent.ae/${t.icon}`:null,thumbnail:t.thumbnail?`https://api.bookmyevent.ae/${t.thumbnail}`:null}),y(!0),R()},Y=t=>{const o=t.target.files[0];if(o){if(!o.type.startsWith("image/")){c("Please upload only image files for app icon");return}if(o.size>2*1024*1024){c("App icon file size should be less than 2MB");return}u({...r,appIcon:o});const n=new FileReader;n.onloadend=()=>{m(i=>({...i,appIcon:n.result}))},n.readAsDataURL(o),c(null)}},Z=t=>{const o=t.target.files[0];if(o){if(!o.type.startsWith("image/")){c("Please upload only image files for thumbnail");return}if(o.size>2*1024*1024){c("Thumbnail file size should be less than 2MB");return}u({...r,thumbnail:o});const n=new FileReader;n.onloadend=()=>{m(i=>({...i,thumbnail:n.result}))},n.readAsDataURL(o),c(null)}},$=t=>{u(i=>({...i,[t]:null})),m(i=>({...i,[t]:null}));const o=t==="appIcon"?"app-icon-upload":"thumbnail-upload",n=document.getElementById(o);n&&(n.value="")},ee=async(t,o)=>{try{if(!(await fetch(`https://api.bookmyevent.ae/api/secondary-modules/${t}/toggle-status`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({isActive:!o})})).ok)throw new Error("Failed to update module status");g(x.map(i=>i._id===t?{...i,isActive:!o}:i))}catch(n){console.error("Status toggle error:",n),b("Failed to update module status")}},te=(t,o)=>{N(t.currentTarget),D(o)},R=()=>{N(null),D(null)},L=x.filter(t=>t.title?.toLowerCase().includes(v.toLowerCase())),oe=t=>t?t.startsWith("http")||t.startsWith("/")?t:`https://api.bookmyevent.ae/${t}`:null,ne=async()=>{if(!r.name.trim()){c("Module name is required");return}P(!0);try{const t=new FormData;t.append("title",r.name.trim()),t.append("description",r.description),r.appIcon&&t.append("icon",r.appIcon),r.thumbnail&&t.append("thumbnail",r.thumbnail);let o;if(h==="add"?o=await fetch("https://api.bookmyevent.ae/api/secondary-modules",{method:"POST",body:t}):o=await fetch(`https://api.bookmyevent.ae/api/secondary-modules/${B._id}`,{method:"PUT",body:t}),!o.ok){const i=await o.json();throw new Error(i.error||`Failed to ${h} module`)}const n=await o.json();g(h==="add"?[...x,n.module]:x.map(i=>i._id===B._id?n.module:i)),w(),y(!1)}catch(t){console.error(`${h} module error:`,t),c(t.message||`Failed to ${h} module`)}finally{P(!1)}},ae=()=>{w(),y(!1),I("add")};return e.jsx(p,{sx:{p:3,backgroundColor:a.palette.grey[100],minHeight:"100vh"},children:O?e.jsxs(j,{sx:{p:3,borderRadius:2,backgroundColor:"white"},elevation:2,children:[e.jsx(d,{variant:"h6",sx:{mb:3,fontWeight:600},children:h==="add"?"Add New Secondary Module":"Edit Secondary Module"}),W&&e.jsx(H,{severity:"error",sx:{mb:3},onClose:()=>c(null),children:W}),e.jsx(G,{fullWidth:!0,label:"Name of Module",placeholder:"Name of Module",value:r.name,onChange:t=>u({...r,name:t.target.value}),required:!0,sx:{mb:3}}),e.jsxs(p,{sx:{mb:3},children:[e.jsx(d,{variant:"subtitle1",sx:{mb:1},children:"Module Description"}),e.jsx(me,{editor:xe,data:r.description,onChange:(t,o)=>{const n=o.getData();u({...r,description:n})}})]}),e.jsxs(E,{container:!0,spacing:3,sx:{mb:3},children:[e.jsx(E,{item:!0,xs:12,md:6,children:e.jsxs(j,{sx:{height:200,border:`2px dashed ${a.palette.grey[300]}`,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer",position:"relative","&:hover":{borderColor:a.palette.primary.main,backgroundColor:a.palette.primary.light+"20"}},onClick:()=>document.getElementById("app-icon-upload").click(),children:[f.appIcon?e.jsxs(p,{sx:{position:"relative",textAlign:"center"},children:[e.jsx("img",{src:f.appIcon,alt:"App Icon Preview",style:{maxWidth:"120px",maxHeight:"120px",objectFit:"contain",marginBottom:"8px"}}),e.jsx(A,{size:"small",sx:{position:"absolute",top:-10,right:-10,backgroundColor:"error.main",color:"white","&:hover":{backgroundColor:"error.dark"}},onClick:t=>{t.stopPropagation(),$("appIcon")},children:e.jsx(J,{fontSize:"small"})}),e.jsx(d,{variant:"caption",display:"block",color:"primary",children:r.appIcon?r.appIcon.name:"Current App Icon"})]}):e.jsxs(e.Fragment,{children:[e.jsx(q,{sx:{fontSize:50,color:a.palette.grey[400],mb:1}}),e.jsx(d,{variant:"body1",fontWeight:500,children:"Upload App Icon"}),e.jsx(d,{variant:"caption",color:"textSecondary",children:"Max 2MB, PNG/JPEG only"})]}),e.jsx("input",{id:"app-icon-upload",type:"file",accept:"image/*",style:{display:"none"},onChange:Y})]})}),e.jsx(E,{item:!0,xs:12,md:6,children:e.jsxs(j,{sx:{height:200,border:`2px dashed ${a.palette.grey[300]}`,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer",position:"relative","&:hover":{borderColor:a.palette.primary.main,backgroundColor:a.palette.primary.light+"20"}},onClick:()=>document.getElementById("thumbnail-upload").click(),children:[f.thumbnail?e.jsxs(p,{sx:{position:"relative",textAlign:"center"},children:[e.jsx("img",{src:f.thumbnail,alt:"Thumbnail Preview",style:{maxWidth:"120px",maxHeight:"120px",objectFit:"contain",marginBottom:"8px"}}),e.jsx(A,{size:"small",sx:{position:"absolute",top:-10,right:-10,backgroundColor:"error.main",color:"white","&:hover":{backgroundColor:"error.dark"}},onClick:t=>{t.stopPropagation(),$("thumbnail")},children:e.jsx(J,{fontSize:"small"})}),e.jsx(d,{variant:"caption",display:"block",color:"primary",children:r.thumbnail?r.thumbnail.name:"Current Thumbnail"})]}):e.jsxs(e.Fragment,{children:[e.jsx(q,{sx:{fontSize:50,color:a.palette.grey[400],mb:1}}),e.jsx(d,{variant:"body1",fontWeight:500,children:"Upload Thumbnail"}),e.jsx(d,{variant:"caption",color:"textSecondary",children:"Max 2MB, PNG/JPEG only"})]}),e.jsx("input",{id:"thumbnail-upload",type:"file",accept:"image/*",style:{display:"none"},onChange:Z})]})})]}),e.jsxs(p,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(C,{variant:"outlined",onClick:ae,sx:{px:4,py:1},disabled:S,children:"Cancel"}),e.jsx(C,{variant:"contained",onClick:ne,disabled:S,sx:{px:4,py:1,backgroundColor:a.palette.primary.main,"&:hover":{backgroundColor:a.palette.primary.dark}},children:S?e.jsx(_,{size:20,color:"inherit"}):h==="add"?"Submit":"Update"})]})]}):e.jsxs(j,{sx:{p:3,borderRadius:2,mb:3,backgroundColor:"white"},elevation:2,children:[e.jsx(d,{variant:"h6",sx:{mb:2,fontWeight:600},children:"Secondary Module Set Up"}),e.jsxs(p,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs(p,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(G,{variant:"outlined",placeholder:"Search Module",value:v,onChange:t=>K(t.target.value),size:"small",sx:{width:250}}),e.jsx(C,{variant:"outlined",sx:{minWidth:40,height:40,backgroundColor:a.palette.grey[400],color:"white","&:hover":{backgroundColor:a.palette.grey[500]}},children:e.jsx(ge,{})})]}),e.jsx(C,{variant:"contained",onClick:Q,sx:{backgroundColor:a.palette.primary.main,"&:hover":{backgroundColor:a.palette.primary.dark}},children:"Add Module"})]}),F&&e.jsx(p,{display:"flex",justifyContent:"center",py:3,children:e.jsx(_,{})}),k&&e.jsx(H,{severity:"error",sx:{mb:2},onClose:()=>b(null),children:k}),!F&&!k&&e.jsxs(ie,{children:[e.jsx(le,{children:e.jsxs(M,{sx:{backgroundColor:a.palette.grey[50]},children:[e.jsx(s,{sx:{fontWeight:600},children:"Sl No"}),e.jsx(s,{sx:{fontWeight:600},children:"Icon"}),e.jsx(s,{sx:{fontWeight:600},children:"Name"}),e.jsx(s,{sx:{fontWeight:600},children:"Status"}),e.jsx(s,{sx:{fontWeight:600},children:"Action"})]})}),e.jsx(se,{children:L.length>0?L.map((t,o)=>e.jsxs(M,{sx:{"&:hover":{backgroundColor:a.palette.grey[50]}},children:[e.jsx(s,{children:o+1}),e.jsx(s,{children:e.jsx(ce,{src:oe(t.icon),alt:t.title,variant:"rounded",sx:{width:40,height:40,bgcolor:a.palette.grey[200]},children:!t.icon&&t.title?.charAt(0).toUpperCase()})}),e.jsx(s,{sx:{fontWeight:500},children:t.title}),e.jsx(s,{children:e.jsx(de,{checked:t.isActive,onChange:()=>ee(t._id,t.isActive),color:"primary"})}),e.jsx(s,{children:e.jsx(A,{size:"small",onClick:n=>te(n,t),sx:{color:"primary.main"},children:e.jsx(be,{})})})]},t._id)):e.jsx(M,{children:e.jsx(s,{colSpan:5,align:"center",sx:{py:3},children:v?"No modules found matching your search.":"No modules available."})})})]}),e.jsx(pe,{anchorEl:U,open:!!U,onClose:R,PaperProps:{elevation:3,sx:{mt:1,minWidth:120}},children:e.jsxs(ue,{onClick:()=>X(V),sx:{py:1},children:[e.jsx(he,{sx:{mr:2,fontSize:20}}),"Edit"]})})]})})};export{ke as default};
