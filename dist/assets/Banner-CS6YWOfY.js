import{r as h,j as e,B as o,g as W,F as A,I as _,H as R,M as u,C as T,d as C,J as q,K as J,N as M,Q as K,U as k,V as l,W as Q,c as F,X as V,Y as X,Z as Y,A as ee}from"./index-Bht4W_XB.js";const j="https://api.bookmyevent.ae/api",y="https://api.bookmyevent.ae";function te(){const[r,f]=h.useState({title:"",zone:"",bannerType:"top_deal",link:"",bannerImage:null}),[I,x]=h.useState(null),[v,$]=h.useState([]),[D,P]=h.useState([]),[i,g]=h.useState(!1),[B,E]=h.useState(!1),[p,z]=h.useState({open:!1,message:"",severity:"success"});h.useEffect(()=>{L(),w()},[]);const L=async()=>{E(!0);try{const s=await fetch(`${j}/zones`,{method:"GET",headers:{"Content-Type":"application/json"}}),t=await s.json();console.log("Zones Response:",t),s.ok&&t.data?P(t.data):c("Failed to fetch zones","error")}catch(s){console.error("Error fetching zones:",s),c("Error fetching zones: "+s.message,"error")}finally{E(!1)}},w=async()=>{g(!0);try{const s=await fetch(`${j}/banners?limit=100`,{method:"GET",headers:{"Content-Type":"application/json"}}),t=await s.json();if(console.log("Banners Response:",t),s.ok){let n=[];t.success&&t.data&&t.data.banners?n=t.data.banners:t.banners?n=t.banners:Array.isArray(t.data)?n=t.data:Array.isArray(t)&&(n=t);const d=n.map(a=>{let m="";if(a.image)if(a.image.startsWith("http://")||a.image.startsWith("https://"))m=a.image;else if(a.image.includes("/Uploads/")){const S=a.image.indexOf("/Uploads/"),O=a.image.substring(S);m=`${y}${O}`}else if(a.image.startsWith("Uploads/"))m=`${y}/${a.image}`;else if(a.image.startsWith("/uploads")||a.image.startsWith("uploads")){const S=a.image.startsWith("/")?a.image:`/${a.image}`;m=`${y}${S}`}else m=`${y}/${a.image}`;return console.log("Banner image processing:",{id:a._id,original:a.image,final:m}),{...a,image:m}});$(d)}else c(t.message||"Failed to fetch banners","error")}catch(s){console.error("Error fetching banners:",s),c("Error fetching banners: "+s.message,"error")}finally{g(!1)}},c=(s,t="success")=>{z({open:!0,message:s,severity:t})},b=s=>{const{name:t,value:n}=s.target;f(d=>({...d,[t]:n}))},N=s=>{const t=s.target.files[0];if(t){const n=new FileReader;n.onloadend=()=>{x(n.result),f(d=>({...d,bannerImage:t}))},n.readAsDataURL(t)}},Z=async s=>{if(s.preventDefault(),!r.title||!r.zone||!r.bannerImage){c("Please fill all required fields","error");return}g(!0);try{const t=new FormData;t.append("title",r.title),t.append("zone",r.zone),t.append("bannerType",r.bannerType),r.link&&t.append("link",r.link),t.append("image",r.bannerImage);const n=await fetch(`${j}/banners`,{method:"POST",body:t}),d=await n.json();console.log("Create Banner Response:",d),n.ok||d.success?(c(d.message||"Banner created successfully","success"),f({title:"",zone:"",bannerType:"top_deal",link:"",bannerImage:null}),x(null),w()):c(d.message||"Failed to create banner","error")}catch(t){console.error("Error creating banner:",t),c("Error creating banner: "+t.message,"error")}finally{g(!1)}},U=()=>{f({title:"",zone:"",bannerType:"top_deal",link:"",bannerImage:null}),x(null)},H=async s=>{if(window.confirm("Are you sure you want to delete this banner?")){g(!0);try{const t=await fetch(`${j}/banners/${s}`,{method:"DELETE",headers:{"Content-Type":"application/json"}}),n=await t.json();console.log("Delete Response:",n),t.ok||n.success?(c(n.message||"Banner deleted successfully","success"),w()):c(n.message||"Failed to delete banner","error")}catch(t){console.error("Error deleting banner:",t),c("Error deleting banner: "+t.message,"error")}finally{g(!1)}}},G=s=>{f({title:s.title,zone:s.zone?._id||s.zone||"",bannerType:s.bannerType||"top_deal",link:s.link||"",bannerImage:null}),s.image&&x(s.image),window.scrollTo({top:0,behavior:"smooth"})};return e.jsxs(o,{sx:{p:4,bgcolor:"#f5f7fa",borderRadius:2,boxShadow:1,minHeight:"100vh"},children:[e.jsx(o,{sx:{mb:4,fontSize:"1.5rem",fontWeight:"bold",color:"#333"},children:"Add New Banner"}),e.jsxs(o,{component:"form",onSubmit:Z,sx:{width:"100%"},children:[e.jsx(W,{fullWidth:!0,name:"title",label:"Banner Title *",value:r.title,onChange:b,required:!0,variant:"outlined",sx:{mb:3,bgcolor:"white"},disabled:i}),e.jsxs(A,{fullWidth:!0,variant:"outlined",sx:{mb:3,bgcolor:"white"},children:[e.jsx(_,{id:"zone-label",children:"Select Zone *"}),e.jsxs(R,{name:"zone",labelId:"zone-label",value:r.zone,onChange:b,label:"Select Zone *",required:!0,disabled:i||B,children:[e.jsx(u,{value:"",children:"--Select Zone--"}),D.map(s=>e.jsx(u,{value:s._id,children:s.name},s._id))]}),B&&e.jsx(o,{sx:{display:"flex",justifyContent:"center",mt:1},children:e.jsx(T,{size:20})})]}),e.jsxs(A,{fullWidth:!0,variant:"outlined",sx:{mb:3,bgcolor:"white"},children:[e.jsx(_,{id:"banner-type-label",children:"Banner Type *"}),e.jsxs(R,{name:"bannerType",labelId:"banner-type-label",value:r.bannerType,onChange:b,label:"Banner Type *",required:!0,disabled:i,children:[e.jsx(u,{value:"top_deal",children:"Top Deal"}),e.jsx(u,{value:"cash_back",children:"Cash Back"}),e.jsx(u,{value:"zone_wise",children:"Zone Wise"})]})]}),e.jsx(W,{fullWidth:!0,name:"link",label:"Banner Link (Optional)",value:r.link,onChange:b,variant:"outlined",sx:{mb:3,bgcolor:"white"},disabled:i,placeholder:"https://example.com"}),e.jsxs(o,{sx:{border:"2px dashed #ccc",borderRadius:1,p:4,textAlign:"center",bgcolor:"#fff",mb:3,cursor:i?"not-allowed":"pointer","&:hover":{borderColor:i?"#ccc":"#999"}},children:[e.jsx("input",{type:"file",accept:"image/*",onChange:N,style:{display:"none"},id:"image-upload",disabled:i}),e.jsx("label",{htmlFor:"image-upload",style:{cursor:i?"not-allowed":"pointer"},children:e.jsx(o,{sx:{color:"#666"},children:I?e.jsxs(o,{sx:{position:"relative"},children:[e.jsx("img",{src:I,alt:"Banner Preview",style:{maxWidth:"100%",maxHeight:"200px",objectFit:"contain"}}),e.jsx(C,{variant:"outlined",size:"small",onClick:s=>{s.preventDefault(),x(null),f(t=>({...t,bannerImage:null}))},sx:{mt:2},disabled:i,children:"Remove Image"})]}):e.jsxs(e.Fragment,{children:[e.jsx(o,{sx:{fontSize:"1rem",mb:1},children:"Click to upload *"}),e.jsx(o,{sx:{color:"#999",fontSize:"0.875rem"},children:"Or drag and drop"}),e.jsx(o,{sx:{color:"#999",fontSize:"0.875rem",mt:1},children:"JPG, JPEG, PNG (Ratio 3:1)"})]})})})]}),e.jsxs(o,{sx:{display:"flex",justifyContent:"center",gap:2,mb:4},children:[e.jsx(C,{variant:"contained",type:"submit",color:"primary",sx:{minWidth:120,height:45},disabled:i,children:i?e.jsx(T,{size:24,color:"inherit"}):"Submit"}),e.jsx(C,{variant:"outlined",onClick:U,color:"primary",sx:{minWidth:120,height:45},disabled:i,children:"Cancel"})]})]}),e.jsxs(o,{sx:{mt:6},children:[e.jsx(o,{sx:{mb:3,fontSize:"1.5rem",fontWeight:"bold",color:"#333"},children:"Existing Banners"}),i&&v.length===0?e.jsx(o,{sx:{display:"flex",justifyContent:"center",p:4},children:e.jsx(T,{})}):e.jsx(q,{component:J,sx:{boxShadow:2},children:e.jsxs(M,{children:[e.jsx(K,{children:e.jsxs(k,{sx:{backgroundColor:"#e0e0e0"},children:[e.jsx(l,{sx:{fontWeight:"bold",fontSize:"0.95rem"},children:"Image"}),e.jsx(l,{sx:{fontWeight:"bold",fontSize:"0.95rem"},children:"Title"}),e.jsx(l,{sx:{fontWeight:"bold",fontSize:"0.95rem"},children:"Zone"}),e.jsx(l,{sx:{fontWeight:"bold",fontSize:"0.95rem"},children:"Type"}),e.jsx(l,{sx:{fontWeight:"bold",fontSize:"0.95rem"},children:"Status"}),e.jsx(l,{sx:{fontWeight:"bold",fontSize:"0.95rem"},children:"Actions"})]})}),e.jsx(Q,{children:v.length===0?e.jsx(k,{children:e.jsx(l,{colSpan:6,sx:{textAlign:"center",py:4,color:"#999"},children:"No banners found. Create your first banner above."})}):v.map(s=>e.jsxs(k,{hover:!0,children:[e.jsx(l,{children:e.jsx(o,{sx:{width:100,height:60,borderRadius:1,overflow:"hidden",border:"1px solid #e0e0e0",display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"#f5f5f5"},children:s.image?e.jsx("img",{src:s.image,alt:s.title,style:{width:"100%",height:"100%",objectFit:"cover"},onError:t=>{console.error("Image load error for:",s.image),t.target.style.display="none";const n=t.target.parentElement;n&&(n.innerHTML='<div style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:#f5f5f5;color:#999;font-size:0.7rem;">No Image</div>')}}):e.jsx(o,{sx:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"#f5f5f5",color:"#999",fontSize:"0.7rem"},children:"No Image"})})}),e.jsx(l,{children:s.title}),e.jsx(l,{children:s.zone?.name||"N/A"}),e.jsx(l,{sx:{textTransform:"capitalize"},children:s.bannerType?.replace("_"," ")||"N/A"}),e.jsx(l,{children:e.jsx(o,{sx:{display:"inline-block",px:2,py:.5,borderRadius:1,bgcolor:s.isActive?"#4caf50":"#f44336",color:"white",fontSize:"0.875rem",fontWeight:"medium"},children:s.isActive?"Active":"Inactive"})}),e.jsxs(l,{children:[e.jsx(F,{color:"primary",onClick:()=>G(s),disabled:i,size:"small",children:e.jsx(V,{})}),e.jsx(F,{color:"error",onClick:()=>H(s._id),disabled:i,size:"small",children:e.jsx(X,{})})]})]},s._id))})]})})]}),e.jsx(Y,{open:p.open,autoHideDuration:6e3,onClose:()=>z({...p,open:!1}),anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(ee,{onClose:()=>z({...p,open:!1}),severity:p.severity,sx:{width:"100%"},variant:"filled",children:p.message})})]})}export{te as default};
