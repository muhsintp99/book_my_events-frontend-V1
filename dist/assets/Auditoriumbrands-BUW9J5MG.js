import{u as se,r as n,j as e,B as c,T,g as B,F as _,I as N,H as W,M as u,d as m,aj as re,y as ne,c as oe,ab as ie,A as U,C as O,N as le,Q as ce,U as I,V as r,W as de,o as G}from"./index-C-AtCVLN.js";import{S as he}from"./Search-B53zclG-.js";import{R as ue}from"./Refresh-ChO-n-jP.js";import{P as ge}from"./Pagination-Bgq3ouI9.js";const fe=()=>{const g=se(),[E,M]=n.useState(""),[x,p]=n.useState([]),[f,b]=n.useState(!0),[A,d]=n.useState(null),[y,h]=n.useState(1),[P,k]=n.useState(1),[Y,$]=n.useState(0),[w,z]=n.useState(10),[v,K]=n.useState("all"),[o,C]=n.useState({name:"",description:"",imageFile:null}),[R,D]=n.useState(!1),[L,F]=n.useState(null),j="http://localhost:5000/api",S=async()=>{try{b(!0),d(null);const t=new URLSearchParams({page:y.toString(),limit:w.toString()});E.trim()&&t.append("search",E.trim()),v!=="all"&&t.append("isActive",v==="active"?"true":"false");const a=await fetch(`${j}/audibrands?${t}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")||""}`}});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const s=await a.json();if(s.success)p(s.data.brands||[]),s.pagination&&(h(s.pagination.currentPage),k(s.pagination.totalPages),$(s.pagination.totalItems),z(s.pagination.itemsPerPage));else throw new Error(s.message||"Failed to fetch brands")}catch(t){console.error("Error fetching brands:",t),d(t.message||"Failed to fetch brands")}finally{b(!1)}},Q=async()=>{try{b(!0),d(null);const t=await fetch(`${j}/audibrands/featured`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")||""}`}});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const a=await t.json();if(a.success)p(a.data.brands||[]),h(1),k(1),$(a.data.brands?.length||0);else throw new Error(a.message||"Failed to fetch featured brands")}catch(t){console.error("Error fetching featured brands:",t),d(t.message||"Failed to fetch featured brands")}finally{b(!1)}},V=async t=>{try{const a=await fetch(`${j}/audibrands/${t}/toggle-status`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")||""}`}});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const s=await a.json();if(s.success)p(l=>l.map(i=>i._id===t?{...i,isActive:s.data.brand.isActive}:i));else throw new Error(s.message||"Failed to toggle brand status")}catch(a){console.error("Error toggling brand status:",a),d(a.message||"Failed to toggle brand status")}},q=async t=>{if(window.confirm("Are you sure you want to delete this brand?"))try{const a=await fetch(`${j}/audibrands/${t}`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")||""}`}});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const s=await a.json();if(s.success)p(l=>l.filter(i=>i._id!==t));else throw new Error(s.message||"Failed to delete brand")}catch(a){console.error("Error deleting brand:",a),d(a.message||"Failed to delete brand")}},J=async()=>{try{D(!0),F(null);const t=new FormData;t.append("name",o.name),t.append("description",o.description),o.imageFile&&t.append("logo",o.imageFile);const a=await fetch(`${j}/audibrands`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")||""}`},body:t});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const s=await a.json();if(s.success)p([s.data.brand,...x]),C({name:"",description:"",imageFile:null}),h(1);else throw new Error(s.message||"Failed to create brand")}catch(t){console.error("Error creating brand:",t),F(t.message||"Failed to create brand")}finally{D(!1)}};n.useEffect(()=>{S()},[y,w]),n.useEffect(()=>{f||S()},[v]);const H=()=>{h(1),S()},X=(t,a)=>{h(a)},Z=t=>{z(t.target.value),h(1)},ee=t=>{K(t.target.value),h(1)},te=()=>{const t=[["Sr","Brand ID","Brand Name","Status","Featured","Created At"].join(","),...x.map((i,ae)=>[ae+1,i._id,`"${i.name}"`,i.isActive?"Active":"Inactive",i.isFeatured?"Yes":"No",new Date(i.createdAt).toLocaleDateString()].join(","))].join(`
`),a=new Blob([t],{type:"text/csv"}),s=window.URL.createObjectURL(a),l=document.createElement("a");l.setAttribute("hidden",""),l.setAttribute("href",s),l.setAttribute("download","brands.csv"),document.body.appendChild(l),l.click(),document.body.removeChild(l)};return e.jsx(c,{sx:{p:3,backgroundColor:g.palette.grey[100],minHeight:"100vh"},children:e.jsxs(c,{sx:{maxWidth:"lg",margin:"auto",backgroundColor:"white",borderRadius:g.shape.borderRadius,boxShadow:g.shadows[1],p:3},children:[e.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs(T,{variant:"h5",component:"h1",children:["Brand List (",Y," total)"]}),e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(B,{variant:"outlined",placeholder:"Search by brand name",value:E,onChange:t=>M(t.target.value),size:"small",onKeyPress:t=>t.key==="Enter"&&H()}),e.jsxs(_,{size:"small",sx:{minWidth:120},children:[e.jsx(N,{children:"Status"}),e.jsxs(W,{value:v,onChange:ee,label:"Status",children:[e.jsx(u,{value:"all",children:"All"}),e.jsx(u,{value:"active",children:"Active"}),e.jsx(u,{value:"inactive",children:"Inactive"})]})]}),e.jsx(m,{variant:"outlined",startIcon:e.jsx(he,{}),onClick:H,children:"Search"}),e.jsx(m,{variant:"outlined",startIcon:e.jsx(re,{}),onClick:te,disabled:x.length===0,children:"Export"}),e.jsx(m,{variant:"outlined",startIcon:e.jsx(ue,{}),onClick:S,disabled:f,children:"Refresh"}),e.jsx(m,{variant:"contained",onClick:Q,disabled:f,children:"Featured Only"}),e.jsx(ne,{title:"Settings",children:e.jsx(oe,{color:"primary",sx:{backgroundColor:"white",border:`1px solid ${g.palette.grey[300]}`},children:e.jsx(ie,{})})})]})]}),e.jsxs(c,{sx:{mb:3,p:2,border:`1px solid ${g.palette.grey[300]}`,borderRadius:g.shape.borderRadius},children:[e.jsx(T,{variant:"h6",gutterBottom:!0,children:"Create Brand"}),L&&e.jsx(U,{severity:"error",sx:{mb:2},onClose:()=>F(null),children:L}),e.jsxs(c,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(B,{label:"Brand Name",value:o.name,onChange:t=>C({...o,name:t.target.value}),size:"small",fullWidth:!0}),e.jsx(B,{label:"Description",value:o.description,onChange:t=>C({...o,description:t.target.value}),size:"small",fullWidth:!0}),e.jsx("input",{type:"file",accept:"image/*",onChange:t=>C({...o,imageFile:t.target.files[0]}),style:{marginTop:"8px"}}),e.jsx(m,{variant:"contained",onClick:J,disabled:R||!o.name.trim()||!o.imageFile,sx:{height:"40px"},children:R?e.jsx(O,{size:24}):"Create"})]})]}),A&&e.jsx(U,{severity:"error",sx:{mb:2},onClose:()=>d(null),children:A}),f?e.jsx(c,{display:"flex",justifyContent:"center",p:4,children:e.jsx(O,{})}):e.jsxs(e.Fragment,{children:[e.jsxs(le,{children:[e.jsx(ce,{children:e.jsxs(I,{children:[e.jsx(r,{children:"Sr"}),e.jsx(r,{children:"Brand ID"}),e.jsx(r,{children:"Brand Image"}),e.jsx(r,{children:"Brand Name"}),e.jsx(r,{children:"Status"}),e.jsx(r,{children:"Featured"}),e.jsx(r,{children:"Created At"}),e.jsx(r,{children:"Actions"})]})}),e.jsx(de,{children:x.length===0?e.jsx(I,{children:e.jsx(r,{colSpan:8,align:"center",children:"No brands found"})}):x.map((t,a)=>e.jsxs(I,{children:[e.jsx(r,{children:(y-1)*w+a+1}),e.jsx(r,{children:t._id}),e.jsx(r,{children:e.jsx("img",{src:t.image,alt:t.name,style:{width:100,height:50,objectFit:"contain"},onError:s=>{s.target.style.display="none"}})}),e.jsx(r,{children:e.jsxs(c,{children:[e.jsx(T,{variant:"body2",fontWeight:"bold",children:t.name}),t.description&&e.jsx(T,{variant:"caption",color:"textSecondary",children:t.description})]})}),e.jsx(r,{children:e.jsx(G,{label:t.isActive?"Active":"Inactive",color:t.isActive?"success":"default",size:"small",onClick:()=>V(t._id),sx:{cursor:"pointer"}})}),e.jsx(r,{children:e.jsx(G,{label:t.isFeatured?"Yes":"No",color:t.isFeatured?"primary":"default",size:"small"})}),e.jsx(r,{children:new Date(t.createdAt).toLocaleDateString()}),e.jsx(r,{children:e.jsx(c,{sx:{display:"flex",gap:1},children:e.jsx(m,{size:"small",variant:"outlined",color:"error",onClick:()=>q(t._id),children:"Delete"})})})]},t._id))})]}),P>1&&e.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mt:3},children:[e.jsxs(_,{size:"small",children:[e.jsx(N,{children:"Items per page"}),e.jsxs(W,{value:w,onChange:Z,label:"Items per page",children:[e.jsx(u,{value:5,children:"5"}),e.jsx(u,{value:10,children:"10"}),e.jsx(u,{value:25,children:"25"}),e.jsx(u,{value:50,children:"50"})]})]}),e.jsx(ge,{count:P,page:y,onChange:X,color:"primary"})]})]})]})})};export{fe as default};
