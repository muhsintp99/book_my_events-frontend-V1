import{u as ae,r as i,j as e,B as d,K as b,T as c,g as L,d as f,C as G,A as H,N as le,Q as ie,U as S,V as p,W as re,k as se,c as E,X as _,l as de,M as ce,G as A,a6 as q}from"./index-CXSvRfrP.js";import{C as pe,a as ue}from"./ckeditor-DcXJnSVr.js";import{S as he}from"./Search-CWf_i7h6.js";import{C as J}from"./CloudUpload-h5d7Dmt3.js";const fe=()=>{const l=ae(),[j,K]=i.useState(""),[y,C]=i.useState([]),[F,P]=i.useState(!1),[v,k]=i.useState(null),[o,u]=i.useState({name:"",description:"",appIcon:null,thumbnail:null}),[I,W]=i.useState(!1),[T,s]=i.useState(null),[O,x]=i.useState(!1),[h,w]=i.useState("add"),[B,z]=i.useState(null),[U,Q]=i.useState(null),[V,X]=i.useState(null),[g,m]=i.useState({appIcon:null,thumbnail:null});i.useEffect(()=>{(async()=>{P(!0),k(null);try{const n=await fetch("https://api.bookmyevent.ae/api/modules");if(!n.ok)throw new Error("Failed to fetch modules");const a=await n.json();C(a)}catch(n){k(n.message)}finally{P(!1)}})()},[]);const M=()=>{u({name:"",description:"",appIcon:null,thumbnail:null}),m({appIcon:null,thumbnail:null}),s(null),z(null);const t=document.getElementById("app-icon-upload"),n=document.getElementById("thumbnail-upload");t&&(t.value=""),n&&(n.value="")},Y=()=>{M(),w("add"),x(!0)},D=t=>{w("edit"),z(t),u({name:t.title||"",description:t.description||"",appIcon:null,thumbnail:null}),m({appIcon:t.icon?`https://api.bookmyevent.ae/${t.icon}`:null,thumbnail:t.thumbnail?`https://api.bookmyevent.ae/${t.thumbnail}`:null}),x(!0),$()},Z=t=>{const n=t.target.files[0];if(n){if(!n.type.startsWith("image/")){s("Please upload only image files for app icon");return}if(n.size>2*1024*1024){s("App icon file size should be less than 2MB");return}u({...o,appIcon:n});const a=new FileReader;a.onloadend=()=>{m(r=>({...r,appIcon:a.result}))},a.readAsDataURL(n),s(null)}},ee=t=>{const n=t.target.files[0];if(n){if(!n.type.startsWith("image/")){s("Please upload only image files for thumbnail");return}if(n.size>2*1024*1024){s("Thumbnail file size should be less than 2MB");return}u({...o,thumbnail:n});const a=new FileReader;a.onloadend=()=>{m(r=>({...r,thumbnail:a.result}))},a.readAsDataURL(n),s(null)}},N=t=>{u(r=>({...r,[t]:null})),m(r=>({...r,[t]:null}));const n=t==="appIcon"?"app-icon-upload":"thumbnail-upload",a=document.getElementById(n);a&&(a.value="")},$=()=>{Q(null),X(null)},R=y.filter(t=>t.title?.toLowerCase().includes(j.toLowerCase())),te=async()=>{if(!o.name.trim()){s("Module name is required");return}W(!0);try{const t=new FormData;t.append("title",o.name.trim()),t.append("description",o.description),o.appIcon&&t.append("icon",o.appIcon),o.thumbnail&&t.append("thumbnail",o.thumbnail);let n;if(h==="add"?n=await fetch("https://api.bookmyevent.ae/api/modules",{method:"POST",body:t}):n=await fetch(`https://api.bookmyevent.ae/api/modules/${B._id}`,{method:"PUT",body:t}),!n.ok){const r=await n.json();throw new Error(r.error||`Failed to ${h} module`)}const a=await n.json();C(h==="add"?[...y,a.module]:y.map(r=>r._id===B._id?a.module:r)),M(),x(!1)}catch(t){console.error(`${h} module error:`,t),s(t.message||`Failed to ${h} module`)}finally{W(!1)}},ne=()=>{M(),x(!1),w("add")},oe=t=>t?t.startsWith("http")||t.startsWith("/")?t:`https://api.bookmyevent.ae/${t}`:null;return e.jsx(d,{sx:{p:3,backgroundColor:l.palette.grey[100],minHeight:"100vh"},children:O?e.jsxs(b,{sx:{p:3,borderRadius:2,backgroundColor:"white"},elevation:2,children:[e.jsx(c,{variant:"h6",sx:{mb:3,fontWeight:600},children:h==="add"?"Add New Module":"Edit Module"}),T&&e.jsx(H,{severity:"error",sx:{mb:3},onClose:()=>s(null),children:T}),e.jsx(L,{fullWidth:!0,label:"Name of Module",placeholder:"Name of Module",value:o.name,onChange:t=>u({...o,name:t.target.value}),required:!0,sx:{mb:3}}),e.jsxs(d,{sx:{mb:3},children:[e.jsx(c,{variant:"subtitle1",sx:{mb:1},children:"Module Description"}),e.jsx(pe,{editor:ue,data:o.description,onChange:(t,n)=>{const a=n.getData();u({...o,description:a})}})]}),e.jsxs(A,{container:!0,spacing:3,sx:{mb:3},children:[e.jsx(A,{item:!0,xs:12,md:6,children:e.jsxs(b,{sx:{height:200,border:`2px dashed ${l.palette.grey[300]}`,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer",position:"relative","&:hover":{borderColor:l.palette.primary.main,backgroundColor:l.palette.primary.light+"20"}},onClick:()=>document.getElementById("app-icon-upload").click(),children:[g.appIcon?e.jsxs(d,{sx:{position:"relative",textAlign:"center"},children:[e.jsx("img",{src:g.appIcon,alt:"App Icon Preview",style:{maxWidth:"120px",maxHeight:"120px",objectFit:"contain",marginBottom:"8px"}}),e.jsx(E,{size:"small",sx:{position:"absolute",top:-10,right:-10,backgroundColor:"error.main",color:"white","&:hover":{backgroundColor:"error.dark"}},onClick:t=>{t.stopPropagation(),N("appIcon")},children:e.jsx(q,{fontSize:"small"})}),e.jsx(c,{variant:"caption",display:"block",color:"primary",children:o.appIcon?o.appIcon.name:"Current App Icon"})]}):e.jsxs(e.Fragment,{children:[e.jsx(J,{sx:{fontSize:50,color:l.palette.grey[400],mb:1}}),e.jsx(c,{variant:"body1",fontWeight:500,children:"Upload App Icon"}),e.jsx(c,{variant:"caption",color:"textSecondary",children:"Max 2MB, PNG/JPEG only"})]}),e.jsx("input",{id:"app-icon-upload",type:"file",accept:"image/*",style:{display:"none"},onChange:Z})]})}),e.jsx(A,{item:!0,xs:12,md:6,children:e.jsxs(b,{sx:{height:200,border:`2px dashed ${l.palette.grey[300]}`,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer",position:"relative","&:hover":{borderColor:l.palette.primary.main,backgroundColor:l.palette.primary.light+"20"}},onClick:()=>document.getElementById("thumbnail-upload").click(),children:[g.thumbnail?e.jsxs(d,{sx:{position:"relative",textAlign:"center"},children:[e.jsx("img",{src:g.thumbnail,alt:"Thumbnail Preview",style:{maxWidth:"120px",maxHeight:"120px",objectFit:"contain",marginBottom:"8px"}}),e.jsx(E,{size:"small",sx:{position:"absolute",top:-10,right:-10,backgroundColor:"error.main",color:"white","&:hover":{backgroundColor:"error.dark"}},onClick:t=>{t.stopPropagation(),N("thumbnail")},children:e.jsx(q,{fontSize:"small"})}),e.jsx(c,{variant:"caption",display:"block",color:"primary",children:o.thumbnail?o.thumbnail.name:"Current Thumbnail"})]}):e.jsxs(e.Fragment,{children:[e.jsx(J,{sx:{fontSize:50,color:l.palette.grey[400],mb:1}}),e.jsx(c,{variant:"body1",fontWeight:500,children:"Upload Thumbnail"}),e.jsx(c,{variant:"caption",color:"textSecondary",children:"Max 2MB, PNG/JPEG only"})]}),e.jsx("input",{id:"thumbnail-upload",type:"file",accept:"image/*",style:{display:"none"},onChange:ee})]})})]}),e.jsxs(d,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(f,{variant:"outlined",onClick:ne,sx:{px:4,py:1},disabled:I,children:"Cancel"}),e.jsx(f,{variant:"contained",onClick:te,disabled:I,sx:{px:4,py:1,backgroundColor:"#EA4C46","&:hover":{backgroundColor:"#d43d37"}},children:I?e.jsx(G,{size:20,color:"inherit"}):h==="add"?"Submit":"Update"})]})]}):e.jsxs(b,{sx:{p:3,borderRadius:2,mb:3,backgroundColor:"white"},elevation:2,children:[e.jsx(c,{variant:"h6",sx:{mb:2,fontWeight:600},children:"Module Set Up"}),e.jsxs(d,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs(d,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(L,{variant:"outlined",placeholder:"Search Module",value:j,onChange:t=>K(t.target.value),size:"small",sx:{width:250}}),e.jsx(f,{variant:"outlined",sx:{minWidth:40,height:40,backgroundColor:l.palette.grey[400],color:"white","&:hover":{backgroundColor:l.palette.grey[500]}},children:e.jsx(he,{})})]}),e.jsx(f,{variant:"contained",onClick:Y,sx:{backgroundColor:"#EA4C46","&:hover":{backgroundColor:"#d43d37"}},children:"Add Module"})]}),F&&e.jsx(d,{display:"flex",justifyContent:"center",py:3,children:e.jsx(G,{})}),v&&e.jsx(H,{severity:"error",sx:{mb:2},onClose:()=>k(null),children:v}),!F&&!v&&e.jsxs(le,{children:[e.jsx(ie,{children:e.jsxs(S,{sx:{backgroundColor:l.palette.grey[50]},children:[e.jsx(p,{sx:{fontWeight:600},children:"Sl No"}),e.jsx(p,{sx:{fontWeight:600},children:"Icon"}),e.jsx(p,{sx:{fontWeight:600},children:"Name"}),e.jsx(p,{sx:{fontWeight:600},children:"Action"})]})}),e.jsx(re,{children:R.length>0?R.map((t,n)=>e.jsxs(S,{sx:{"&:hover":{backgroundColor:l.palette.grey[50]}},children:[e.jsx(p,{children:n+1}),e.jsx(p,{children:e.jsx(se,{src:oe(t.icon),alt:t.title,sx:{width:40,height:40,bgcolor:l.palette.primary.light},children:!t.icon&&t.title?t.title.charAt(0).toUpperCase():"?"})}),e.jsx(p,{sx:{fontWeight:500},children:t.title}),e.jsx(p,{children:e.jsx(d,{sx:{display:"flex",gap:1},children:e.jsx(E,{size:"small",onClick:()=>D(t),sx:{color:"primary.main"},children:e.jsx(_,{})})})})]},t._id)):e.jsx(S,{children:e.jsx(p,{colSpan:4,align:"center",sx:{py:3},children:j?"No modules found matching your search.":"No modules available."})})})]}),e.jsx(de,{anchorEl:U,open:!!U,onClose:$,PaperProps:{elevation:3,sx:{mt:1,minWidth:120}},children:e.jsxs(ce,{onClick:()=>D(V),sx:{py:1},children:[e.jsx(_,{sx:{mr:2,fontSize:20}}),"Edit"]})})]})})};export{fe as default};
