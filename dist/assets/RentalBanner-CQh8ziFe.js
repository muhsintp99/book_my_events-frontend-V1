import{r as h,j as e,B as l,g as B,F as A,I as _,H as R,M as u,C as T,d as C,J as O,K as q,N as J,Q as M,U as k,V as r,W as K,c as F,X as Q,Y as X,Z as Y,A as ee}from"./index-C-AtCVLN.js";const j="https://api.bookmyevent.ae/api",y="https://api.bookmyevent.ae";function te(){const[o,f]=h.useState({title:"",zone:"",bannerType:"top_deal",link:"",bannerImage:null}),[I,x]=h.useState(null),[v,$]=h.useState([]),[D,P]=h.useState([]),[a,g]=h.useState(!1),[E,W]=h.useState(!1),[p,z]=h.useState({open:!1,message:"",severity:"success"});h.useEffect(()=>{L(),w()},[]);const L=async()=>{W(!0);try{const s=await fetch(`${j}/zones`,{method:"GET",headers:{"Content-Type":"application/json"}}),t=await s.json();console.log("Zones Response:",t),s.ok&&t.data?P(t.data):c("Failed to fetch zones","error")}catch(s){console.error("Error fetching zones:",s),c("Error fetching zones: "+s.message,"error")}finally{W(!1)}},w=async()=>{g(!0);try{const s=await fetch(`${j}/vehicle-banners?limit=100`,{method:"GET",headers:{"Content-Type":"application/json"}}),t=await s.json();if(console.log("Vehicle Banners Response:",t),s.ok){let n=[];t.success&&t.data&&t.data.banners?n=t.data.banners:t.banners?n=t.banners:Array.isArray(t.data)?n=t.data:Array.isArray(t)&&(n=t);const d=n.map(i=>{let m="";if(i.image)if(i.image.startsWith("http://")||i.image.startsWith("https://"))m=i.image;else if(i.image.includes("/Uploads/")){const S=i.image.indexOf("/Uploads/"),G=i.image.substring(S);m=`${y}${G}`}else if(i.image.startsWith("Uploads/"))m=`${y}/${i.image}`;else if(i.image.startsWith("/uploads")||i.image.startsWith("uploads")){const S=i.image.startsWith("/")?i.image:`/${i.image}`;m=`${y}${S}`}else m=`${y}/${i.image}`;return console.log("Vehicle Banner image processing:",{id:i._id,original:i.image,final:m}),{...i,image:m}});$(d)}else c(t.message||"Failed to fetch vehicle banners","error")}catch(s){console.error("Error fetching vehicle banners:",s),c("Error fetching vehicle banners: "+s.message,"error")}finally{g(!1)}},c=(s,t="success")=>{z({open:!0,message:s,severity:t})},b=s=>{const{name:t,value:n}=s.target;f(d=>({...d,[t]:n}))},V=s=>{const t=s.target.files[0];if(t){const n=new FileReader;n.onloadend=()=>{x(n.result),f(d=>({...d,bannerImage:t}))},n.readAsDataURL(t)}},N=async s=>{if(s.preventDefault(),!o.title||!o.zone||!o.bannerImage){c("Please fill all required fields","error");return}g(!0);try{const t=new FormData;t.append("title",o.title),t.append("zone",o.zone),t.append("bannerType",o.bannerType),o.link&&t.append("link",o.link),t.append("image",o.bannerImage);const n=await fetch(`${j}/vehicle-banners`,{method:"POST",body:t}),d=await n.json();console.log("Create Vehicle Banner Response:",d),n.ok||d.success?(c(d.message||"Vehicle banner created successfully","success"),f({title:"",zone:"",bannerType:"top_deal",link:"",bannerImage:null}),x(null),w()):c(d.message||"Failed to create vehicle banner","error")}catch(t){console.error("Error creating vehicle banner:",t),c("Error creating vehicle banner: "+t.message,"error")}finally{g(!1)}},Z=()=>{f({title:"",zone:"",bannerType:"top_deal",link:"",bannerImage:null}),x(null)},U=async s=>{if(window.confirm("Are you sure you want to delete this vehicle banner?")){g(!0);try{const t=await fetch(`${j}/vehicle-banners/${s}`,{method:"DELETE",headers:{"Content-Type":"application/json"}}),n=await t.json();console.log("Delete Response:",n),t.ok||n.success?(c(n.message||"Vehicle banner deleted successfully","success"),w()):c(n.message||"Failed to delete vehicle banner","error")}catch(t){console.error("Error deleting vehicle banner:",t),c("Error deleting vehicle banner: "+t.message,"error")}finally{g(!1)}}},H=s=>{f({title:s.title,zone:s.zone?._id||s.zone||"",bannerType:s.bannerType||"top_deal",link:s.link||"",bannerImage:null}),s.image&&x(s.image),window.scrollTo({top:0,behavior:"smooth"})};return e.jsxs(l,{sx:{p:4,bgcolor:"#f5f7fa",borderRadius:2,boxShadow:1,minHeight:"100vh"},children:[e.jsx(l,{sx:{mb:4,fontSize:"1.5rem",fontWeight:"bold",color:"#333"},children:"Add New Vehicle Banner"}),e.jsxs(l,{component:"form",onSubmit:N,sx:{width:"100%"},children:[e.jsx(B,{fullWidth:!0,name:"title",label:"Vehicle Banner Title *",value:o.title,onChange:b,required:!0,variant:"outlined",sx:{mb:3,bgcolor:"white"},disabled:a}),e.jsxs(A,{fullWidth:!0,variant:"outlined",sx:{mb:3,bgcolor:"white"},children:[e.jsx(_,{id:"zone-label",children:"Select Zone *"}),e.jsxs(R,{name:"zone",labelId:"zone-label",value:o.zone,onChange:b,label:"Select Zone *",required:!0,disabled:a||E,children:[e.jsx(u,{value:"",children:"--Select Zone--"}),D.map(s=>e.jsx(u,{value:s._id,children:s.name},s._id))]}),E&&e.jsx(l,{sx:{display:"flex",justifyContent:"center",mt:1},children:e.jsx(T,{size:20})})]}),e.jsxs(A,{fullWidth:!0,variant:"outlined",sx:{mb:3,bgcolor:"white"},children:[e.jsx(_,{id:"banner-type-label",children:"Banner Type *"}),e.jsxs(R,{name:"bannerType",labelId:"banner-type-label",value:o.bannerType,onChange:b,label:"Banner Type *",required:!0,disabled:a,children:[e.jsx(u,{value:"top_deal",children:"Top Deal"}),e.jsx(u,{value:"cash_back",children:"Cash Back"}),e.jsx(u,{value:"zone_wise",children:"Zone Wise"})]})]}),e.jsx(B,{fullWidth:!0,name:"link",label:"Banner Link (Optional)",value:o.link,onChange:b,variant:"outlined",sx:{mb:3,bgcolor:"white"},disabled:a,placeholder:"https://example.com"}),e.jsxs(l,{sx:{border:"2px dashed #ccc",borderRadius:1,p:4,textAlign:"center",bgcolor:"#fff",mb:3,cursor:a?"not-allowed":"pointer","&:hover":{borderColor:a?"#ccc":"#999"}},children:[e.jsx("input",{type:"file",accept:"image/*",onChange:V,style:{display:"none"},id:"image-upload",disabled:a}),e.jsx("label",{htmlFor:"image-upload",style:{cursor:a?"not-allowed":"pointer"},children:e.jsx(l,{sx:{color:"#666"},children:I?e.jsxs(l,{sx:{position:"relative"},children:[e.jsx("img",{src:I,alt:"Vehicle Banner Preview",style:{maxWidth:"100%",maxHeight:"200px",objectFit:"contain"}}),e.jsx(C,{variant:"outlined",size:"small",onClick:s=>{s.preventDefault(),x(null),f(t=>({...t,bannerImage:null}))},sx:{mt:2},disabled:a,children:"Remove Image"})]}):e.jsxs(e.Fragment,{children:[e.jsx(l,{sx:{fontSize:"1rem",mb:1},children:"Click to upload *"}),e.jsx(l,{sx:{color:"#999",fontSize:"0.875rem"},children:"Or drag and drop"}),e.jsx(l,{sx:{color:"#999",fontSize:"0.875rem",mt:1},children:"JPG, JPEG, PNG (Ratio 3:1)"})]})})})]}),e.jsxs(l,{sx:{display:"flex",justifyContent:"center",gap:2,mb:4},children:[e.jsx(C,{variant:"contained",type:"submit",color:"primary",sx:{minWidth:120,height:45},disabled:a,children:a?e.jsx(T,{size:24,color:"inherit"}):"Submit"}),e.jsx(C,{variant:"outlined",onClick:Z,color:"primary",sx:{minWidth:120,height:45},disabled:a,children:"Cancel"})]})]}),e.jsxs(l,{sx:{mt:6},children:[e.jsx(l,{sx:{mb:3,fontSize:"1.5rem",fontWeight:"bold",color:"#333"},children:"Existing Vehicle Banners"}),a&&v.length===0?e.jsx(l,{sx:{display:"flex",justifyContent:"center",p:4},children:e.jsx(T,{})}):e.jsx(O,{component:q,sx:{boxShadow:2},children:e.jsxs(J,{children:[e.jsx(M,{children:e.jsxs(k,{sx:{backgroundColor:"#e0e0e0"},children:[e.jsx(r,{sx:{fontWeight:"bold",fontSize:"0.95rem"},children:"Image"}),e.jsx(r,{sx:{fontWeight:"bold",fontSize:"0.95rem"},children:"Title"}),e.jsx(r,{sx:{fontWeight:"bold",fontSize:"0.95rem"},children:"Zone"}),e.jsx(r,{sx:{fontWeight:"bold",fontSize:"0.95rem"},children:"Type"}),e.jsx(r,{sx:{fontWeight:"bold",fontSize:"0.95rem"},children:"Status"}),e.jsx(r,{sx:{fontWeight:"bold",fontSize:"0.95rem"},children:"Actions"})]})}),e.jsx(K,{children:v.length===0?e.jsx(k,{children:e.jsx(r,{colSpan:6,sx:{textAlign:"center",py:4,color:"#999"},children:"No vehicle banners found. Create your first vehicle banner above."})}):v.map(s=>e.jsxs(k,{hover:!0,children:[e.jsx(r,{children:e.jsx(l,{sx:{width:100,height:60,borderRadius:1,overflow:"hidden",border:"1px solid #e0e0e0",display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"#f5f5f5"},children:s.image?e.jsx("img",{src:s.image,alt:s.title,style:{width:"100%",height:"100%",objectFit:"cover"},onError:t=>{console.error("Image load error for:",s.image),t.target.style.display="none";const n=t.target.parentElement;n&&(n.innerHTML='<div style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:#f5f5f5;color:#999;font-size:0.7rem;">No Image</div>')}}):e.jsx(l,{sx:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"#f5f5f5",color:"#999",fontSize:"0.7rem"},children:"No Image"})})}),e.jsx(r,{children:s.title}),e.jsx(r,{children:s.zone?.name||"N/A"}),e.jsx(r,{sx:{textTransform:"capitalize"},children:s.bannerType?.replace("_"," ")||"N/A"}),e.jsx(r,{children:e.jsx(l,{sx:{display:"inline-block",px:2,py:.5,borderRadius:1,bgcolor:s.isActive?"#4caf50":"#f44336",color:"white",fontSize:"0.875rem",fontWeight:"medium"},children:s.isActive?"Active":"Inactive"})}),e.jsxs(r,{children:[e.jsx(F,{color:"primary",onClick:()=>H(s),disabled:a,size:"small",children:e.jsx(Q,{})}),e.jsx(F,{color:"error",onClick:()=>U(s._id),disabled:a,size:"small",children:e.jsx(X,{})})]})]},s._id))})]})})]}),e.jsx(Y,{open:p.open,autoHideDuration:6e3,onClose:()=>z({...p,open:!1}),anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(ee,{onClose:()=>z({...p,open:!1}),severity:p.severity,sx:{width:"100%"},variant:"filled",children:p.message})})]})}export{te as default};
