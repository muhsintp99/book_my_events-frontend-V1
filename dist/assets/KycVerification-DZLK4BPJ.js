import{h as T,j as e,u as ee,r as l,B as o,K as te,S as d,T as s,d as u,G as j,k as K,q as se,a4 as ae,a2 as b,g as M,N as ie,Q as ne,U as y,V as c,W as re,C as _,y as w,c as D,_ as q,$ as L,a0 as $,n as S,a1 as U,o as oe}from"./index-CgvkLXhQ.js";import{C as R}from"./CheckCircle--bxsXNDA.js";import{T as le,P as Y,C as ce,a as G}from"./TrendingUp-DQUYL0IH.js";import{V as de}from"./Visibility-nGoOtfDL.js";import{S as he}from"./Search-DS6UMqv3.js";import{E as xe}from"./FileDownload-tD0lsIHS.js";import{C as ue}from"./Description-BlVNf_SV.js";import{u as z,w as pe}from"./xlsx-eY9-kAPw.js";const je=T(e.jsx("path",{d:"M4 10h3v7H4zm6.5 0h3v7h-3zM2 19h20v3H2zm15-9h3v7h-3zm-5-9L2 6v2h20V6z"})),me=T(e.jsx("path",{d:"M12 7V3H2v18h20V7zM6 19H4v-2h2zm0-4H4v-2h2zm0-4H4V9h2zm0-4H4V5h2zm4 12H8v-2h2zm0-4H8v-2h2zm0-4H8V9h2zm0-4H8V5h2zm10 12h-8v-2h2v-2h-2v-2h2v-2h-2V9h8zm-2-8h-2v2h2zm0 4h-2v2h2z"})),fe=T(e.jsx("path",{d:"M12 1 3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5zm-2 16-4-4 1.41-1.41L10 14.17l6.59-6.59L18 9z"})),ze=()=>{const x=ee(),[h,O]=l.useState([]),[m,Q]=l.useState(""),[ge,be]=l.useState("all"),[a,f]=l.useState({open:!1,data:null}),[g,p]=l.useState({open:!1,data:null,action:""}),[v,W]=l.useState(""),[J,V]=l.useState(!1),[A,N]=l.useState(!1),[k,X]=l.useState(0),P=()=>localStorage.getItem("token")||sessionStorage.getItem("token")||"";l.useEffect(()=>{F()},[]);const F=async()=>{V(!0);try{const i=await(await fetch("https://api.bookmyevent.ae/api/admin/kyc",{headers:{Authorization:`Bearer ${P()}`}})).json();if(i.success){const n=i.data.filter(r=>r.kycDetails?.status!=="not_submitted");O(n)}}catch(t){console.error("Fetch KYC error:",t)}finally{V(!1)}},I=async(t,i)=>{N(!0);try{const r=await(await fetch("https://api.bookmyevent.ae/api/admin/kyc/status",{method:"PUT",headers:{Authorization:`Bearer ${P()}`,"Content-Type":"application/json"},body:JSON.stringify({userId:t,status:i,rejectionReason:i==="rejected"?v:""})})).json();r.success?(F(),p({open:!1,data:null,action:""}),f({open:!1,data:null}),W("")):alert(r.message||"Failed to update status")}catch(n){console.error("Update status error:",n),alert("Error updating status")}finally{N(!1)}},H=t=>{const i={pending:{label:"Pending",color:"warning",icon:e.jsx(Y,{fontSize:"small"})},verified:{label:"Verified",color:"success",icon:e.jsx(R,{fontSize:"small"})},rejected:{label:"Rejected",color:"error",icon:e.jsx(G,{fontSize:"small"})}},n=i[t]||i.pending;return e.jsx(oe,{label:n.label,color:n.color,size:"small",icon:n.icon,sx:{fontWeight:600,px:1}})},B=l.useMemo(()=>h.filter(t=>{const i=`${t.userId?.firstName||""} ${t.userId?.lastName||""}`.toLowerCase(),n=(t.userId?.email||"").toLowerCase(),r=i.includes(m.toLowerCase())||n.includes(m.toLowerCase()),E=["all","pending","verified","rejected"][k],Z=E==="all"||t.kycDetails?.status===E;return r&&Z}),[h,m,k]),C=l.useMemo(()=>({total:h.length,pending:h.filter(t=>t.kycDetails?.status==="pending").length,verified:h.filter(t=>t.kycDetails?.status==="verified").length}),[h]);return e.jsxs(o,{sx:{p:{xs:2,md:4},background:"#f4f7fe",minHeight:"100vh"},children:[e.jsxs(te,{elevation:0,sx:{p:4,mb:4,borderRadius:4,background:`linear-gradient(45deg, ${x.palette.primary.main}, ${x.palette.primary.dark})`,color:"white"},children:[e.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",flexWrap:"wrap",gap:2},children:[e.jsxs(o,{children:[e.jsxs(d,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(fe,{sx:{fontSize:32}}),e.jsx(s,{variant:"h4",fontWeight:800,letterSpacing:-.5,color:"white",children:"KYC Verification"})]}),e.jsx(s,{variant:"body1",sx:{opacity:.95,color:"white",mt:.5},children:"Review and approve vendor identity documents"})]}),e.jsx(u,{variant:"contained",startIcon:e.jsx(xe,{}),onClick:()=>{const t=h.map(r=>({Vendor:`${r.userId?.firstName} ${r.userId?.lastName}`,Email:r.userId?.email,Phone:r.userId?.phone,Status:r.kycDetails?.status,SubmittedAt:r.kycDetails?.submittedAt})),i=z.json_to_sheet(t),n=z.book_new();z.book_append_sheet(n,i,"KYC Requests"),pe(n,"KYC_Verification_Report.xlsx")},sx:{bgcolor:"white",color:x.palette.primary.main,fontWeight:700,"&:hover":{bgcolor:"#f0f0f0"}},children:"Export Report"})]}),e.jsx(j,{container:!0,spacing:3,sx:{mt:3},children:[{label:"Total Requests",value:C.total,icon:e.jsx(le,{}),color:"#2196f3"},{label:"Pending Verification",value:C.pending,icon:e.jsx(Y,{}),color:"#ff9800"},{label:"Verified Vendors",value:C.verified,icon:e.jsx(R,{}),color:"#4caf50"}].map((t,i)=>e.jsx(j,{item:!0,xs:12,sm:4,children:e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:2,p:2,borderRadius:3,bgcolor:"rgba(255,255,255,0.2)",backdropFilter:"blur(10px)"},children:[e.jsx(K,{sx:{bgcolor:"white",color:t.color,width:56,height:56},children:t.icon}),e.jsxs(o,{children:[e.jsx(s,{variant:"caption",sx:{opacity:.95,color:"white",fontWeight:600},children:t.label}),e.jsx(s,{variant:"h5",fontWeight:700,color:"white",children:t.value})]})]})},i))})]}),e.jsxs(se,{elevation:0,sx:{borderRadius:4,border:"1px solid",borderColor:"divider"},children:[e.jsx(o,{sx:{borderBottom:1,borderColor:"divider",px:2},children:e.jsxs(ae,{value:k,onChange:(t,i)=>X(i),sx:{"& .MuiTab-root":{fontWeight:600,py:2,color:"text.secondary","&.Mui-selected":{color:"primary.main"}}},children:[e.jsx(b,{label:"All Requests"}),e.jsx(b,{label:"Pending"}),e.jsx(b,{label:"Verified"}),e.jsx(b,{label:"Rejected"})]})}),e.jsx(o,{sx:{p:3,display:"flex",gap:2,flexWrap:"wrap",alignItems:"center",bgcolor:"#fafafa"},children:e.jsx(M,{size:"small",placeholder:"Search vendor name or email...",value:m,onChange:t=>Q(t.target.value),InputProps:{startAdornment:e.jsx(he,{sx:{mr:1,color:"text.secondary"}})},sx:{flexGrow:1,maxWidth:400,bgcolor:"white"}})}),e.jsxs(ie,{children:[e.jsx(ne,{sx:{bgcolor:"#f8f9fc"},children:e.jsxs(y,{children:[e.jsx(c,{sx:{fontWeight:700},children:"Vendor"}),e.jsx(c,{sx:{fontWeight:700},children:"Document Type"}),e.jsx(c,{sx:{fontWeight:700},children:"Submitted On"}),e.jsx(c,{sx:{fontWeight:700},children:"Status"}),e.jsx(c,{align:"right",sx:{fontWeight:700},children:"Actions"})]})}),e.jsx(re,{children:J?e.jsx(y,{children:e.jsx(c,{colSpan:5,align:"center",sx:{py:10},children:e.jsx(_,{})})}):B.length===0?e.jsx(y,{children:e.jsx(c,{colSpan:5,align:"center",sx:{py:10},children:e.jsx(s,{color:"text.secondary",variant:"h6",children:"No KYC requests found"})})}):B.map(t=>e.jsxs(y,{hover:!0,children:[e.jsx(c,{children:e.jsxs(d,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(K,{src:t.profilePhoto||"",sx:{width:45,height:45,bgcolor:"primary.light",color:"primary.main",fontWeight:700},children:t.userId?.firstName?t.userId.firstName[0]:"V"}),e.jsxs(o,{children:[e.jsxs(s,{variant:"body2",fontWeight:700,children:[t.userId?.firstName," ",t.userId?.lastName]}),e.jsx(s,{variant:"caption",color:"text.secondary",children:t.userId?.email})]})]})}),e.jsx(c,{children:e.jsx(s,{variant:"body2",children:t.kycDetails?.documentInfo?.documentType||"N/A"})}),e.jsx(c,{children:e.jsxs(d,{direction:"row",spacing:1,alignItems:"center",color:"text.secondary",children:[e.jsx(ce,{sx:{fontSize:14}}),e.jsx(s,{variant:"caption",children:t.kycDetails?.submittedAt?new Date(t.kycDetails.submittedAt).toLocaleDateString():"N/A"})]})}),e.jsx(c,{children:H(t.kycDetails?.status)}),e.jsx(c,{align:"right",children:e.jsxs(d,{direction:"row",spacing:1,justifyContent:"flex-end",children:[e.jsx(w,{title:"View Details",children:e.jsx(D,{onClick:()=>f({open:!0,data:t}),size:"small",color:"primary",children:e.jsx(de,{fontSize:"small"})})}),t.kycDetails?.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx(w,{title:"Verify",children:e.jsx(D,{color:"success",size:"small",onClick:()=>I(t.userId?._id,"verified"),children:e.jsx(R,{fontSize:"small"})})}),e.jsx(w,{title:"Reject",children:e.jsx(D,{color:"error",size:"small",onClick:()=>p({open:!0,data:t,action:"reject"}),children:e.jsx(G,{fontSize:"small"})})})]})]})})]},t._id))})]})]}),e.jsxs(q,{open:a.open,onClose:()=>f({open:!1}),fullWidth:!0,maxWidth:"md",PaperProps:{sx:{borderRadius:4}},children:[e.jsxs(L,{sx:{fontWeight:800,px:3,pt:3},children:["KYC Application Details",e.jsx(s,{variant:"body2",color:"text.secondary",children:"Review vendor documents and information for verification"})]}),e.jsx($,{sx:{px:3},children:a.data&&e.jsxs(j,{container:!0,spacing:3,sx:{mt:.5},children:[e.jsx(j,{item:!0,xs:12,md:5,children:e.jsxs(d,{spacing:3,children:[e.jsxs(o,{sx:{p:2,borderRadius:3,border:"1px solid #eee",bgcolor:"#fafafa"},children:[e.jsxs(d,{direction:"row",spacing:1,alignItems:"center",mb:1,children:[e.jsx(me,{color:"primary",fontSize:"small"}),e.jsx(s,{variant:"subtitle2",fontWeight:700,children:"Personal Info"})]}),e.jsxs(s,{variant:"body2",children:[e.jsx("strong",{children:"Full Name:"})," ",a.data.kycDetails?.personalInfo?.fullName]}),e.jsxs(s,{variant:"body2",children:[e.jsx("strong",{children:"Email:"})," ",a.data.kycDetails?.personalInfo?.email]}),e.jsxs(s,{variant:"body2",children:[e.jsx("strong",{children:"Address:"})," ",a.data.kycDetails?.personalInfo?.address]})]}),e.jsxs(o,{sx:{p:2,borderRadius:3,border:"1px solid #eee",bgcolor:"#f8f9fe"},children:[e.jsxs(d,{direction:"row",spacing:1,alignItems:"center",mb:1,children:[e.jsx(je,{color:"primary",fontSize:"small"}),e.jsx(s,{variant:"subtitle2",fontWeight:700,children:"Bank Details"})]}),e.jsxs(s,{variant:"body2",children:[e.jsx("strong",{children:"Holder:"})," ",a.data.kycDetails?.bankDetails?.accountHolder]}),e.jsxs(s,{variant:"body2",children:[e.jsx("strong",{children:"Account:"})," ",a.data.kycDetails?.bankDetails?.accountNumber]}),e.jsxs(s,{variant:"body2",children:[e.jsx("strong",{children:"IFSC:"})," ",a.data.kycDetails?.bankDetails?.ifsc]}),e.jsxs(s,{variant:"body2",children:[e.jsx("strong",{children:"Bank:"})," ",a.data.kycDetails?.bankDetails?.bankName]})]}),e.jsxs(o,{sx:{p:2,borderRadius:3,bgcolor:a.data.kycDetails?.status==="verified"?S(x.palette.success.main,.1):a.data.kycDetails?.status==="rejected"?S(x.palette.error.main,.1):S(x.palette.warning.main,.1),border:"1px solid",borderColor:a.data.kycDetails?.status==="verified"?"success.main":a.data.kycDetails?.status==="rejected"?"error.main":"warning.main"},children:[e.jsx(s,{variant:"caption",fontWeight:700,display:"block",children:"CURRENT STATUS"}),e.jsxs(d,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[H(a.data.kycDetails?.status),a.data.kycDetails?.status==="rejected"&&e.jsxs(s,{variant:"caption",color:"error",fontWeight:600,children:["Reason: ",a.data.kycDetails?.rejectionReason]})]})]})]})}),e.jsx(j,{item:!0,xs:12,md:7,children:e.jsxs(d,{spacing:2,children:[e.jsxs(d,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(ue,{color:"primary",fontSize:"small"}),e.jsx(s,{variant:"subtitle2",fontWeight:700,children:"Verification Documents"})]}),e.jsx(s,{variant:"caption",fontWeight:600,children:"FRONT IMAGE"}),e.jsx(o,{sx:{width:"100%",height:200,borderRadius:3,overflow:"hidden",border:"1px solid #eee",display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"#f0f0f0"},children:a.data.kycDetails?.documentInfo?.frontImage?e.jsx("img",{src:`https://api.bookmyevent.ae${a.data.kycDetails.documentInfo.frontImage}`,alt:"Front",style:{width:"100%",height:"100%",objectFit:"contain"}}):e.jsx(s,{variant:"caption",children:"No Image Uploaded"})}),e.jsx(s,{variant:"caption",fontWeight:600,children:"BACK IMAGE"}),e.jsx(o,{sx:{width:"100%",height:200,borderRadius:3,overflow:"hidden",border:"1px solid #eee",display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"#f0f0f0"},children:a.data.kycDetails?.documentInfo?.backImage?e.jsx("img",{src:`https://api.bookmyevent.ae${a.data.kycDetails.documentInfo.backImage}`,alt:"Back",style:{width:"100%",height:"100%",objectFit:"contain"}}):e.jsx(s,{variant:"caption",children:"No Image Uploaded"})})]})})]})}),e.jsxs(U,{sx:{p:3},children:[e.jsx(u,{onClick:()=>f({open:!1}),variant:"outlined",sx:{borderRadius:2},children:"Close"}),a.data?.kycDetails?.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx(u,{color:"error",variant:"contained",onClick:()=>p({open:!0,data:a.data,action:"reject"}),sx:{borderRadius:2,color:"white"},children:"Reject"}),e.jsx(u,{color:"success",variant:"contained",onClick:()=>I(a.data.userId?._id,"verified"),sx:{borderRadius:2,color:"white"},children:"Approve KYC"})]})]})]}),e.jsxs(q,{open:g.open&&g.action==="reject",onClose:()=>p({open:!1,data:null,action:""}),fullWidth:!0,maxWidth:"xs",PaperProps:{sx:{borderRadius:4}},children:[e.jsx(L,{children:"Reject KYC Request"}),e.jsxs($,{children:[e.jsxs(s,{variant:"body2",sx:{mb:2},children:["Please provide a reason for rejecting the KYC submission for ",e.jsx("strong",{children:g.data?.kycDetails?.personalInfo?.fullName}),"."]}),e.jsx(M,{fullWidth:!0,multiline:!0,rows:3,label:"Rejection Reason",placeholder:"e.g. Documents are blurry or invalid",value:v,onChange:t=>W(t.target.value)})]}),e.jsxs(U,{sx:{p:3},children:[e.jsx(u,{onClick:()=>p({open:!1,data:null,action:""}),children:"Cancel"}),e.jsx(u,{color:"error",variant:"contained",disabled:!v||A,onClick:()=>I(g.data.userId?._id,"rejected"),sx:{borderRadius:2,color:"white"},children:A?e.jsx(_,{size:24}):"Confirm Rejection"})]})]})]})};export{ze as default};
