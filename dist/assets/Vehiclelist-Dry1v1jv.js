import{r as c,a as te,j as e,B as P,ae as se,af as ae,T as p,K as I,S as w,F as k,H as C,M as o,d as y,o as ne,g as re,C as ie,J as oe,N as ce,Q as le,U as E,V as r,W as de,a3 as R,c as T,X as he,Y as xe}from"./index-CgvkLXhQ.js";import{S as ge}from"./Search-DS6UMqv3.js";import{V as pe}from"./Visibility-nGoOtfDL.js";function me(){const[$,v]=c.useState([]),[_,W]=c.useState([]),[V,D]=c.useState([]),[H,u]=c.useState(!1),[N,d]=c.useState(null),[h,z]=c.useState({brand:"",category:"",type:"",search:""}),[x,b]=c.useState({brand:"",category:"",type:"",search:""}),[j,f]=c.useState(1),[B,L]=c.useState(1),[U,J]=c.useState(0),[S,F]=c.useState(10),A=te(),m="http://localhost:5000/api",M=async()=>{try{u(!0),d(null);const t=localStorage.getItem("token");if(!t)throw new Error("Authentication token not found. Please log in.");const a=await fetch(`${m}/brands`,{headers:{Authorization:`Bearer ${t}`}}),s=await a.json();if(!a.ok)throw new Error(s.message||"Failed to fetch brands");if(s.success)W(s.data.brands||[]);else throw new Error(s.message||"Failed to fetch brands")}catch(t){d(t.message)}finally{u(!1)}},O=async()=>{try{u(!0),d(null);const t=localStorage.getItem("token");if(!t)throw new Error("Authentication token not found. Please log in.");const a=await fetch(`${m}/categories`,{headers:{Authorization:`Bearer ${t}`}}),s=await a.json();if(!a.ok)throw new Error(s.message||"Failed to fetch categories");if(s.success)D(s.data.categories||[]);else throw new Error(s.message||"Failed to fetch categories")}catch(t){d(t.message)}finally{u(!1)}},Y=async()=>{try{u(!0),d(null);const t=localStorage.getItem("token");if(!t)throw new Error("Authentication token not found. Please log in.");const a=new URLSearchParams({page:j.toString(),limit:S.toString()});h.search.trim()&&a.append("search",h.search.trim()),h.brand&&a.append("brand",h.brand),h.category&&a.append("category",h.category),h.type&&a.append("type",h.type);const s=await fetch(`${m}/vehicles?${a}`,{headers:{Authorization:`Bearer ${t}`}}),n=await s.json();if(!s.ok)throw new Error(n.message||"Failed to fetch vehicles");if(n.success)v(n.data.vehicles||[]),n.pagination&&(f(n.pagination.currentPage),L(n.pagination.totalPages),J(n.pagination.totalItems),F(n.pagination.itemsPerPage));else throw new Error(n.message||"Failed to fetch vehicles")}catch(t){d(t.message)}finally{u(!1)}};c.useEffect(()=>{M(),O(),Y()},[j,S,h]);const G=()=>{z(x),f(1)},K=()=>{z({brand:"",category:"",type:"",search:""}),b({brand:"",category:"",type:"",search:""}),f(1)},Q=()=>{const t=["Sl,Name,Code,Category,Brand,Type,Total Trip,Hourly,Distance,Daily,New,Active"],a=$.map((i,g)=>`${g+1},${i.name},${i.vinNumber||"-"},${i.category?.name||"N/A"},${i.brand?.name||"N/A"},${i.type||"-"},${i.totalTrips||0},${i.pricing?.hourly||"-"},${i.pricing?.distanceWise||"-"},${i.pricing?.perDay||"-"},${i.isNew?"Yes":"No"},${i.isActive?"Active":"Inactive"}`),s=t.concat(a).join(`
`),n=new Blob([s],{type:"text/csv"}),l=document.createElement("a");l.href=URL.createObjectURL(n),l.download="vehicles.csv",l.click()},X=t=>{F(t.target.value),f(1)},q=async(t,a)=>{try{const s=localStorage.getItem("token");if(!s)throw new Error("Authentication token not found. Please log in.");const n=await fetch(`${m}/vehicles/${t}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({isNew:!a})}),l=await n.json();if(!n.ok)throw new Error(l.message||"Failed to update vehicle");l.success&&v(i=>i.map(g=>g._id===t?{...g,isNew:!a}:g))}catch(s){d(s.message)}},Z=async(t,a)=>{try{const s=localStorage.getItem("token");if(!s)throw new Error("Authentication token not found. Please log in.");const n=await fetch(`${m}/vehicles/${t}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({isActive:!a})}),l=await n.json();if(!n.ok)throw new Error(l.message||"Failed to update vehicle");l.success&&v(i=>i.map(g=>g._id===t?{...g,isActive:!a}:g))}catch(s){d(s.message)}},ee=async t=>{try{const a=localStorage.getItem("token");if(!a)throw new Error("Authentication token not found. Please log in.");const s=await fetch(`${m}/vehicles/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${a}`}}),n=await s.json();if(!s.ok)throw new Error(n.message||"Failed to delete vehicle");n.success&&v(l=>l.filter(i=>i._id!==t))}catch(a){d(a.message)}};return e.jsxs(P,{sx:{bgcolor:"#fafafa",minHeight:"100vh",p:2},children:[e.jsx(se,{position:"static",color:"default",elevation:0,children:e.jsx(ae,{children:e.jsx(p,{variant:"h6",sx:{flexGrow:1,color:"#333"},children:"ðŸš— CityRide Rentals"})})}),e.jsx(I,{sx:{p:2,mt:2},children:e.jsxs(w,{direction:"row",spacing:2,flexWrap:"wrap",children:[e.jsx(k,{sx:{minWidth:200},size:"small",children:e.jsxs(C,{displayEmpty:!0,value:x.brand,onChange:t=>b({...x,brand:t.target.value}),children:[e.jsx(o,{value:"",children:"Select vehicle brand"}),_.map(t=>e.jsx(o,{value:t._id,children:t.name},t._id))]})}),e.jsx(k,{sx:{minWidth:200},size:"small",children:e.jsxs(C,{displayEmpty:!0,value:x.category,onChange:t=>b({...x,category:t.target.value}),children:[e.jsx(o,{value:"",children:"Select vehicle category"}),V.map(t=>e.jsx(o,{value:t._id,children:t.name},t._id))]})}),e.jsx(k,{sx:{minWidth:200},size:"small",children:e.jsxs(C,{displayEmpty:!0,value:x.type,onChange:t=>b({...x,type:t.target.value}),children:[e.jsx(o,{value:"",children:"Select vehicle type"}),e.jsx(o,{value:"sedan",children:"Sedan"}),e.jsx(o,{value:"suv",children:"SUV"}),e.jsx(o,{value:"hatchback",children:"Hatchback"}),e.jsx(o,{value:"coupe",children:"Coupe"}),e.jsx(o,{value:"convertible",children:"Convertible"}),e.jsx(o,{value:"truck",children:"Truck"}),e.jsx(o,{value:"van",children:"Van"}),e.jsx(o,{value:"motorcycle",children:"Motorcycle"})]})}),e.jsx(y,{variant:"outlined",sx:{bgcolor:"#f3f4f6",borderRadius:"8px"},onClick:K,children:"Reset"}),e.jsx(y,{variant:"contained",sx:{bgcolor:"#2563eb",borderRadius:"8px"},onClick:G,children:"Filter"})]})}),e.jsxs(I,{sx:{p:2,mt:2},children:[e.jsxs(w,{direction:"row",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",spacing:2,mb:2,children:[e.jsxs(p,{variant:"h6",sx:{fontWeight:600},children:["Total Vehicles"," ",e.jsx(ne,{label:U,color:"success",size:"small",sx:{ml:1}})]}),e.jsxs(w,{direction:"row",spacing:1,flexWrap:"wrap",children:[e.jsx(re,{size:"small",placeholder:"Search by vehicle name",value:x.search,onChange:t=>b({...x,search:t.target.value}),InputProps:{endAdornment:e.jsx(ge,{fontSize:"small"})}}),e.jsx(y,{variant:"outlined",onClick:Q,children:"Export"}),e.jsx(y,{variant:"contained",sx:{bgcolor:"#2563eb"},onClick:()=>A("/vehicle-setup/create"),children:"New Vehicle"})]})]}),H?e.jsx(P,{display:"flex",justifyContent:"center",p:2,children:e.jsx(ie,{})}):N?e.jsx(p,{color:"error",align:"center",children:N}):e.jsx(oe,{children:e.jsxs(ce,{children:[e.jsx(le,{sx:{bgcolor:"#f9fafb"},children:e.jsxs(E,{children:[e.jsx(r,{children:"Sl"}),e.jsx(r,{children:"Vehicle Info"}),e.jsx(r,{children:"Category"}),e.jsx(r,{children:"Brand"}),e.jsx(r,{children:"Total Trip"}),e.jsx(r,{children:"Trip Fare"}),e.jsx(r,{children:"New Tag"}),e.jsx(r,{children:"Status"}),e.jsx(r,{children:"Action"})]})}),e.jsxs(de,{children:[$.map((t,a)=>e.jsxs(E,{children:[e.jsx(r,{children:(j-1)*S+a+1}),e.jsxs(r,{children:[e.jsx(p,{variant:"body2",sx:{fontWeight:600,color:"#2563eb"},children:t.name}),e.jsx(p,{variant:"caption",color:"text.secondary",children:t.vinNumber||"-"})]}),e.jsx(r,{children:t.category?.name||"N/A"}),e.jsx(r,{children:t.brand?.name||"N/A"}),e.jsx(r,{children:t.totalTrips||0}),e.jsxs(r,{children:[t.pricing?.hourly&&e.jsxs(p,{variant:"body2",children:["Hourly: $",t.pricing.hourly]}),t.pricing?.distanceWise&&e.jsxs(p,{variant:"body2",children:["Distance Wise: $",t.pricing.distanceWise]}),t.pricing?.perDay&&e.jsxs(p,{variant:"body2",children:["Per Day: $",t.pricing.perDay]})]}),e.jsx(r,{children:e.jsx(R,{checked:t.isNew||!1,onChange:()=>q(t._id,t.isNew)})}),e.jsx(r,{children:e.jsx(R,{checked:t.isActive||!1,onChange:()=>Z(t._id,t.isActive)})}),e.jsx(r,{children:e.jsxs(w,{direction:"row",spacing:1,children:[e.jsx(T,{size:"small",sx:{border:"1px solid #d1d5db",color:"#2563eb",borderRadius:"8px"},onClick:()=>A(`/vehicle-setup/view/${t._id}`),children:e.jsx(pe,{fontSize:"small"})}),e.jsx(T,{size:"small",sx:{border:"1px solid #d1d5db",color:"#065f46",borderRadius:"8px"},onClick:()=>A(`/vehicle-setup/edit/${t._id}`),children:e.jsx(he,{fontSize:"small"})}),e.jsx(T,{size:"small",sx:{border:"1px solid #d1d5db",color:"#dc2626",borderRadius:"8px"},onClick:()=>ee(t._id),children:e.jsx(xe,{fontSize:"small"})})]})})]},t._id)),$.length===0&&e.jsx(E,{children:e.jsx(r,{colSpan:9,align:"center",children:"No vehicles found"})})]})]})}),e.jsxs(P,{sx:{mt:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(k,{variant:"outlined",size:"small",children:e.jsxs(C,{value:S,onChange:X,children:[e.jsx(o,{value:5,children:"5"}),e.jsx(o,{value:10,children:"10"}),e.jsx(o,{value:20,children:"20"})]})}),e.jsxs(w,{direction:"row",spacing:2,children:[e.jsx(y,{variant:"outlined",disabled:j===1,onClick:()=>f(t=>t-1),children:"Previous"}),e.jsxs(p,{variant:"body2",sx:{alignSelf:"center"},children:["Page ",j," of ",B]}),e.jsx(y,{variant:"outlined",disabled:j===B,onClick:()=>f(t=>t+1),children:"Next"})]})]})]})]})}export{me as default};
