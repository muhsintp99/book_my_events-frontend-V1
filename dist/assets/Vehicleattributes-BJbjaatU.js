import{h as we,j as e,r,a as Be,B as i,C as J,Z as oe,A as ce,d as m,q as de,m as ue,a4 as Ne,a2 as He,T as d,g as I,M as V,c as E,a6 as he,o as xe,b as K,J as Oe,K as pe,N as qe,Q as Ge,U as Z,V as u,W as Je,a3 as Ke,X as Ze,Y as Qe,_ as me,ad as Xe,$ as fe,D as Ye,a0 as je,I as et,y as tt,ae as st,af as lt,ag as nt,k as at,a8 as rt,a1 as be,l as it,a7 as ge}from"./index-D781LPqD.js";import{C as ot}from"./CloudUpload-DIPcQBXH.js";import{S as ve}from"./Search-QpPOBNxK.js";import{E as ct}from"./FileDownload-B_lnBiKu.js";import{A as ye}from"./Add-1A2xJC9K.js";import{C as dt}from"./CheckCircle-ChhpX31t.js";import{E as ut}from"./TableView-DBYehj7c.js";import{C as ht}from"./Description-UmF_S9X5.js";const Ce=we(e.jsx("path",{d:"M20 10V8h-4V4h-2v4h-4V4H8v4H4v2h4v4H4v2h4v4h2v-4h4v4h2v-4h4v-2h-4v-4zm-6 4h-4v-4h4z"})),xt=we(e.jsx("path",{d:"M1 21h22L12 2zm12-3h-2v-2h2zm0-4h-2v-4h2z"})),k="https://api.bookmyevent.ae/api";function Ct(){const[z,Ie]=r.useState(0),[D,ke]=r.useState(""),[R,P]=r.useState(null),[Q,F]=r.useState(null),[g,Se]=r.useState([]),[X,U]=r.useState(!0),[_,B]=r.useState(null),[N,Y]=r.useState("all"),[f,$]=r.useState({title:"",module:""}),[ee,Ae]=r.useState([]),[v,h]=r.useState(!0),[te,L]=r.useState(null),[H,O]=r.useState({open:!1,message:"",severity:"success"}),[S,M]=r.useState({open:!1,attributeId:null,attributeTitle:""}),[o,j]=r.useState({open:!1,attributeId:null,attributeTitle:"",currentValues:[],newValueInput:"",searchValueFilter:""}),[se,le]=r.useState(null),Te=!!se,b=Be(),A=r.useRef(null),W=[{key:"default",label:"Default"},{key:"english",label:"English(EN)"},{key:"arabic",label:"Arabic - العربية(AR)"}],w=()=>localStorage.getItem("token")||sessionStorage.getItem("token"),Ve=()=>{const t=localStorage.getItem("user")||sessionStorage.getItem("user");if(!t)return null;try{return JSON.parse(t).role}catch{return null}},Ee=(t,s)=>Ie(s),q=r.useCallback(async()=>{const t=w();if(!t){B("Authentication required"),U(!1);return}U(!0);try{const s=await fetch(`${k}/modules`,{headers:{Authorization:`Bearer ${t}`}});if(s.status===401){b("/login");return}if(!s.ok)throw new Error(`HTTP ${s.status}`);const l=await s.json();let a=[];Array.isArray(l)?a=l:l.modules?a=l.modules:l.data?.modules?a=l.data.modules:l.data&&(a=l.data),Se(a);const x=a.find(n=>(n.title||n.name||"").toLowerCase().includes("transport"))?._id||a[0]?._id||"";$(n=>({...n,module:x})),Y("all")}catch(s){B(s.message)}finally{U(!1)}},[b]),y=r.useCallback(async()=>{const t=w();if(!t){L("Authentication required"),h(!1);return}h(!0);try{const s=`${k}/vehicle-attributes?search=${encodeURIComponent(D)}`,l=await fetch(s,{headers:{Authorization:`Bearer ${t}`}});if(l.status===401){b("/login");return}if(!l.ok)throw new Error(`HTTP ${l.status}`);const x=((await l.json()).data||[]).map(n=>{let p="";return n.icon&&(n.icon.startsWith("http://")||n.icon.startsWith("https://")?p=n.icon:n.icon.startsWith("/uploads")||n.icon.startsWith("uploads")?p=`https://api.bookmyevent.ae${n.icon.startsWith("/")?n.icon:`/${n.icon}`}`:p=`https://api.bookmyevent.ae/${n.icon}`),{id:n._id,title:n.title||"",module:g.find(ie=>ie._id===n.module)||{title:"Unknown",_id:n.module},moduleId:n.module,icon:p,values:n.values||[],status:n.status??!0}});Ae(x)}catch(s){L(s.message)}finally{h(!1)}},[D,g,b]);r.useEffect(()=>{const t=Ve();if(!["admin","manager","superadmin"].includes(t||"")){L("Access denied"),b("/dashboard");return}q()},[q,b]),r.useEffect(()=>{g.length>0&&y()},[y,g]);const ze=t=>{const s=t.target.files?.[0];if(!s)return;if(!s.type.startsWith("image/")){c("Please select a valid image file (JPEG, PNG, GIF, WebP, SVG)","error");return}if(s.size>2*1024*1024){c("Icon must be less than 2 MB","error");return}P(s);const l=new FileReader;l.onload=a=>F(a.target.result),l.readAsDataURL(s)},ne=()=>{$({title:"",module:g[0]?._id||""}),P(null),F(null),A.current&&(A.current.value="")},De=async()=>{const t=w();if(!t){b("/login");return}if(!f.title.trim()){c("Attribute title is required","error");return}if(!f.module){c("Please select a module","error");return}h(!0);try{const s=new FormData;s.append("title",f.title.trim()),s.append("module",f.module),R&&s.append("icon",R);const l=await fetch(`${k}/vehicle-attributes`,{method:"POST",headers:{Authorization:`Bearer ${t}`},body:s}),a=await l.json();if(!l.ok)throw new Error(a.message||"Failed to create");c(`"${f.title}" added!`,"success"),ne(),y()}catch(s){c(s.message,"error")}finally{h(!1)}},Re=(t,s)=>{M({open:!0,attributeId:t,attributeTitle:s})},$e=async()=>{const t=w();h(!0);try{if(!(await fetch(`${k}/vehicle-attributes/${S.attributeId}`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`}})).ok)throw new Error("Delete failed");c("Attribute deleted!","success"),M({open:!1,attributeId:null,attributeTitle:""}),y()}catch(s){c(s.message,"error")}finally{h(!1)}},Le=async t=>{const s=w();h(!0);try{const l=await fetch(`${k}/vehicle-attributes/toggle/${t}`,{method:"PATCH",headers:{Authorization:`Bearer ${s}`}}),a=await l.json();if(!l.ok)throw new Error(a.message||"Failed");c(a.message,"success"),y()}catch(l){c(l.message,"error")}finally{h(!1)}},Me=(t,s,l)=>{j({open:!0,attributeId:t,attributeTitle:s,currentValues:[...l],newValueInput:"",searchValueFilter:""})},ae=()=>{const t=o.newValueInput.trim();if(!t)return;const s=t.split(",").map(l=>l.trim()).filter(l=>l&&!o.currentValues.includes(l));if(s.length===0){c("No new unique values to add","warning");return}j(l=>({...l,currentValues:[...l.currentValues,...s],newValueInput:""})),c(`${s.length} value(s) added`,"success")},We=t=>{j(s=>({...s,currentValues:s.currentValues.filter((l,a)=>a!==t)}))},re=o.currentValues.filter(t=>t.toLowerCase().includes(o.searchValueFilter.toLowerCase())),Pe=async()=>{const t=w();h(!0);try{const s=await fetch(`${k}/vehicle-attributes/values/${o.attributeId}`,{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({values:o.currentValues})});if(!s.ok){const l=await s.json();throw new Error(l.message||"Failed to save values")}c("Values updated successfully!","success"),j({...o,open:!1}),y()}catch(s){c(s.message,"error")}finally{h(!1)}},T=ee.filter(t=>{const s=t.title.toLowerCase().includes(D.toLowerCase()),l=N==="all"||t.moduleId===N;return s&&l}),Fe=t=>le(t.currentTarget),G=()=>le(null),Ue=()=>{const t=["SI","ID","Title","Module","Values","Status"],s=T.map((n,p)=>[p+1,n.id,n.title,n.module?.title||"N/A",n.values.join("; "),n.status?"Active":"Inactive"]),l=[t,...s.map(n=>n.map(p=>`"${p}"`).join(","))].join(`
`),a=new Blob([l],{type:"text/csv"}),C=URL.createObjectURL(a),x=document.createElement("a");x.href=C,x.download=`vehicle_attributes_${new Date().toISOString().split("T")[0]}.csv`,x.click(),URL.revokeObjectURL(C),G(),c("CSV exported","success")},_e=()=>{const t=["SI","ID","Title","Module","Values","Status"],s=T.map((n,p)=>[p+1,n.id,n.title,n.module?.title||"N/A",n.values.join("; "),n.status?"Active":"Inactive"]),l=[t,...s.map(n=>n.join("	"))].join(`
`),a=new Blob([l],{type:"application/vnd.ms-excel"}),C=URL.createObjectURL(a),x=document.createElement("a");x.href=C,x.download=`vehicle_attributes_${new Date().toISOString().split("T")[0]}.xls`,x.click(),URL.revokeObjectURL(C),G(),c("Excel exported","success")},c=(t,s="success")=>{O({open:!0,message:t,severity:s})};return v&&ee.length===0&&X?e.jsx(i,{sx:{p:3,display:"flex",justifyContent:"center"},children:e.jsx(J,{})}):e.jsxs(i,{sx:{width:"100%",minHeight:"100vh",bgcolor:"#f5f5f5",p:{xs:2,sm:3}},children:[e.jsx(oe,{open:!!te||!!_,autoHideDuration:null,onClose:()=>{L(null),B(null)},children:e.jsxs(ce,{severity:"error",sx:{width:"100%"},children:[te||_,e.jsx(m,{size:"small",onClick:()=>{q(),y()},sx:{ml:2},children:"Retry"})]})}),e.jsx(i,{sx:{display:"flex",justifyContent:"center",mb:4},children:e.jsx(de,{sx:{width:"100%",maxWidth:1400,boxShadow:3,borderRadius:3},children:e.jsxs(ue,{sx:{p:{xs:2,sm:4}},children:[e.jsx(Ne,{value:z,onChange:Ee,sx:{mb:4},children:W.map(t=>e.jsx(He,{label:t.label},t.key))}),e.jsxs(d,{variant:"subtitle1",sx:{mb:1,fontWeight:500},children:["Attribute Title ",e.jsx("span",{style:{color:"#f44336"},children:"*"})]}),e.jsx(I,{fullWidth:!0,value:W[z].key==="default"?f.title:"",onChange:t=>W[z].key==="default"&&$(s=>({...s,title:t.target.value})),placeholder:"e.g. Fuel Type, Transmission",disabled:W[z].key!=="default",sx:{mb:4}}),e.jsxs(d,{variant:"subtitle1",sx:{mb:1,fontWeight:500},children:["Module ",e.jsx("span",{style:{color:"#f44336"},children:"*"})]}),e.jsx(I,{select:!0,fullWidth:!0,value:f.module,onChange:t=>$(s=>({...s,module:t.target.value})),disabled:X||!!_,sx:{mb:4},children:g.map(t=>e.jsx(V,{value:t._id,children:t.title||t.name},t._id))}),e.jsxs(d,{variant:"subtitle1",sx:{mb:1,fontWeight:500},children:["Icon ",e.jsx("span",{style:{color:"#777",fontSize:"0.8rem"},children:"(optional, max 2 MB)"})]}),e.jsxs(i,{sx:{display:"flex",gap:3,mb:4,flexDirection:{xs:"column",sm:"row"}},children:[e.jsxs(i,{children:[e.jsx("input",{id:"icon-upload",type:"file",accept:"image/*",onChange:ze,ref:A,style:{display:"none"}}),e.jsx("label",{htmlFor:"icon-upload",children:e.jsxs(m,{component:"span",variant:"outlined",sx:{width:{xs:"100%",sm:240},height:140,border:"2px dashed #e0e0e0",borderRadius:2,display:"flex",flexDirection:"column",gap:1,color:"text.secondary",textTransform:"none","&:hover":{borderColor:"#2196f3",bgcolor:"#e3f2fd"}},children:[e.jsx(ot,{sx:{fontSize:40,color:"#bdbdbd"}}),e.jsx(d,{variant:"body2",color:"text.secondary",children:R?"Change Icon":"Upload Icon"})]})})]}),Q&&e.jsxs(i,{sx:{position:"relative"},children:[e.jsxs(i,{sx:{width:240,height:140,border:"2px solid #e0e0e0",borderRadius:2,overflow:"hidden"},children:[e.jsx("img",{src:Q,alt:"preview",style:{width:"100%",height:"100%",objectFit:"cover"}}),e.jsx(E,{size:"small",onClick:()=>{P(null),F(null),A.current&&(A.current.value="")},sx:{position:"absolute",top:8,right:8,bgcolor:"rgba(0,0,0,0.5)",color:"#fff","&:hover":{bgcolor:"rgba(0,0,0,0.7)"}},children:e.jsx(he,{fontSize:"small"})})]}),e.jsx(d,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:R?.name})]})]}),e.jsxs(i,{sx:{display:"flex",gap:2,justifyContent:"flex-end"},children:[e.jsx(m,{variant:"outlined",onClick:ne,disabled:v,children:"Reset"}),e.jsx(m,{variant:"contained",onClick:De,disabled:!f.title.trim()||!f.module||v,children:v?e.jsx(J,{size:20}):"Add Attribute"})]})]})})}),e.jsx(i,{sx:{display:"flex",justifyContent:"center"},children:e.jsx(de,{sx:{width:"100%",maxWidth:1400,boxShadow:3,borderRadius:3},children:e.jsxs(ue,{sx:{p:{xs:2,sm:3}},children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",mb:3,flexWrap:"wrap",gap:2},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(d,{variant:"h6",fontWeight:600,children:"Vehicle Attributes"}),e.jsx(xe,{label:T.length,color:"primary",size:"small"})]}),e.jsxs(i,{sx:{display:"flex",gap:2,flexWrap:"wrap",alignItems:"center"},children:[e.jsxs(I,{select:!0,size:"small",value:N,onChange:t=>Y(t.target.value),sx:{minWidth:180},children:[e.jsx(V,{value:"all",children:"All Modules"}),g.map(t=>e.jsx(V,{value:t._id,children:t.title||t.name},t._id))]}),e.jsx(I,{size:"small",placeholder:"Search attributes...",value:D,onChange:t=>ke(t.target.value),InputProps:{startAdornment:e.jsx(K,{position:"start",children:e.jsx(ve,{})})},sx:{minWidth:250}}),e.jsx(m,{variant:"outlined",startIcon:e.jsx(ct,{}),onClick:Fe,children:"Export"})]})]}),e.jsx(Oe,{component:pe,children:e.jsxs(qe,{children:[e.jsx(Ge,{children:e.jsxs(Z,{children:[e.jsx(u,{children:"SI"}),e.jsx(u,{children:"Icon"}),e.jsx(u,{children:"Title"}),e.jsx(u,{children:"Module"}),e.jsx(u,{children:"Values"}),e.jsx(u,{children:"Status"}),e.jsx(u,{children:"Action"})]})}),e.jsxs(Je,{children:[T.map((t,s)=>e.jsxs(Z,{hover:!0,children:[e.jsx(u,{children:s+1}),e.jsx(u,{children:t.icon?e.jsx(i,{sx:{width:50,height:35,borderRadius:1,overflow:"hidden",border:"1px solid #e0e0e0"},children:e.jsx("img",{src:t.icon,alt:t.title,style:{width:"100%",height:"100%",objectFit:"cover"},onError:l=>{l.target.style.display="none",l.target.parentElement.innerHTML=`
                                  <div style="
                                    width:100%;height:100%;
                                    display:flex;align-items:center;justify-content:center;
                                    background:#f5f5f5;font-size:10px;color:#999;
                                  ">Error</div>`}})}):e.jsx(i,{sx:{width:50,height:35,borderRadius:1,backgroundColor:"#f5f5f5",display:"flex",alignItems:"center",justifyContent:"center",border:"1px solid #e0e0e0"},children:e.jsx(d,{variant:"caption",color:"text.secondary",children:"No Icon"})})}),e.jsx(u,{children:t.title}),e.jsx(u,{children:t.module?.title||"N/A"}),e.jsx(u,{children:e.jsxs(m,{size:"small",variant:"outlined",startIcon:e.jsx(ye,{}),onClick:()=>Me(t.id,t.title,t.values),children:[t.values.length," Value",t.values.length!==1?"s":""]})}),e.jsx(u,{children:e.jsx(Ke,{checked:t.status,onChange:()=>Le(t.id),disabled:v})}),e.jsxs(u,{children:[e.jsx(E,{size:"small",onClick:()=>b(`/vehicle-attributes/edit/${t.id}`),children:e.jsx(Ze,{})}),e.jsx(E,{size:"small",color:"error",onClick:()=>Re(t.id,t.title),children:e.jsx(Qe,{})})]})]},t.id)),T.length===0&&e.jsx(Z,{children:e.jsx(u,{colSpan:7,align:"center",sx:{py:4},children:e.jsx(d,{children:"No attributes found"})})})]})]})})]})})}),e.jsxs(me,{open:o.open,onClose:()=>j({...o,open:!1}),maxWidth:"sm",fullWidth:!0,TransitionComponent:Xe,children:[e.jsxs(fe,{sx:{pb:1},children:[e.jsxs(i,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(Ce,{color:"primary"}),e.jsx(d,{variant:"h6",component:"span",children:"Manage Values"}),e.jsx(xe,{label:o.currentValues.length,size:"small",color:"primary"})]}),e.jsx(d,{variant:"body2",color:"text.secondary",children:o.attributeTitle})]}),e.jsx(Ye,{}),e.jsxs(je,{sx:{pt:3},children:[e.jsxs(i,{sx:{mb:3},children:[e.jsx(et,{sx:{mb:1,fontWeight:500},children:"Add Values (comma-separated)"}),e.jsx(I,{fullWidth:!0,size:"small",placeholder:"e.g. Diesel, Petrol, Electric, Hybrid",value:o.newValueInput,onChange:t=>j(s=>({...s,newValueInput:t.target.value})),onKeyPress:t=>t.key==="Enter"&&ae(),InputProps:{endAdornment:e.jsx(K,{position:"end",children:e.jsx(tt,{title:"Add all unique values",children:e.jsx(E,{onClick:ae,disabled:!o.newValueInput.trim(),children:e.jsx(ye,{})})})})}}),e.jsx(d,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:"Tip: Paste or type comma-separated values"})]}),e.jsx(i,{sx:{mb:2},children:e.jsx(I,{fullWidth:!0,size:"small",placeholder:"Search values...",value:o.searchValueFilter,onChange:t=>j(s=>({...s,searchValueFilter:t.target.value})),InputProps:{startAdornment:e.jsx(K,{position:"start",children:e.jsx(ve,{})})}})}),e.jsx(pe,{variant:"outlined",sx:{maxHeight:300,overflow:"auto",bgcolor:"#fafafa"},children:re.length===0?e.jsx(i,{sx:{p:4,textAlign:"center",color:"text.secondary"},children:o.searchValueFilter?e.jsxs(e.Fragment,{children:[e.jsx(xt,{sx:{fontSize:40,mb:1,color:"warning.main"}}),e.jsx(d,{children:"No values match your search"})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ce,{sx:{fontSize:40,mb:1,opacity:.3}}),e.jsx(d,{children:"No values added yet"}),e.jsx(d,{variant:"caption",children:"Start by adding values above"})]})}):e.jsx(st,{disablePadding:!0,children:re.map((t,s)=>e.jsxs(lt,{secondaryAction:e.jsx(E,{size:"small",onClick:()=>We(o.currentValues.indexOf(t)),children:e.jsx(he,{fontSize:"small"})}),sx:{bgcolor:"background.paper",mb:.5,borderRadius:1,mx:1,mt:.5,"&:hover":{bgcolor:"action.hover"}},children:[e.jsx(nt,{children:e.jsx(at,{sx:{width:32,height:32,bgcolor:"primary.main",fontSize:"0.85rem"},children:t.charAt(0).toUpperCase()})}),e.jsx(rt,{primary:t})]},s))})})]}),e.jsxs(be,{sx:{p:2,pt:1},children:[e.jsx(m,{onClick:()=>j({...o,open:!1}),children:"Cancel"}),e.jsx(m,{onClick:Pe,variant:"contained",disabled:v,startIcon:v?e.jsx(J,{size:16}):e.jsx(dt,{}),children:"Save Values"})]})]}),e.jsxs(me,{open:S.open,onClose:()=>M({...S,open:!1}),children:[e.jsx(fe,{children:"Confirm Delete"}),e.jsx(je,{children:e.jsxs(d,{children:['Delete "',S.attributeTitle,'"? This cannot be undone.']})}),e.jsxs(be,{children:[e.jsx(m,{onClick:()=>M({...S,open:!1}),children:"Cancel"}),e.jsx(m,{onClick:$e,color:"error",children:"Delete"})]})]}),e.jsxs(it,{anchorEl:se,open:Te,onClose:G,children:[e.jsxs(V,{onClick:_e,children:[e.jsx(ge,{children:e.jsx(ut,{})})," Excel"]}),e.jsxs(V,{onClick:Ue,children:[e.jsx(ge,{children:e.jsx(ht,{})})," CSV"]})]}),e.jsx(oe,{open:H.open,autoHideDuration:4e3,onClose:()=>O(t=>({...t,open:!1})),children:e.jsx(ce,{severity:H.severity,onClose:()=>O(t=>({...t,open:!1})),children:H.message})})]})}export{Ct as default};
