import{r as n,j as t,B as u,T as U,d as B,A as Z,g as ee,F as P,I as _,H as M,M as h,ak as ye,C as te,N as we,Q as ve,U as N,V as l,W as Ce,o as be,y as se,c as ae,X as Be,Y as Se,_ as Ae,$ as Ie,a0 as Ee,a1 as De}from"./index-Bv9CUdV4.js";import{S as $e}from"./Search-M3ebp4kZ.js";import{R as Te}from"./Refresh-C2Rhf2ss.js";import{P as ke}from"./Pagination-IFoHs8Xc.js";const ze=()=>{const[v,re]=n.useState(""),[m,p]=n.useState([]),[O,S]=n.useState(!0),[H,c]=n.useState(null),[G,C]=n.useState(null),[A,b]=n.useState(1),[f,ne]=n.useState(10),[I,le]=n.useState("all"),[g,q]=n.useState("all"),[J,oe]=n.useState([]),[ie,Q]=n.useState(!1),[E,z]=n.useState(!1),[D,L]=n.useState(null),[o,y]=n.useState({title:"",module:"",icon:null}),[R,$]=n.useState(!1),x="https://api.bookmyevent.ae",j=()=>localStorage.getItem("token")||"",W=()=>localStorage.getItem("userId")||null,ce=async()=>{try{const e=await fetch(`${x}/api/modules`,{headers:{Authorization:`Bearer ${j()}`}});if(e.ok){const s=await e.json();oe(Array.isArray(s)?s:[])}}catch(e){console.error("Error fetching modules:",e)}},T=async()=>{try{S(!0),c(null);const e=await fetch(`${x}/api/brands`,{headers:{Authorization:`Bearer ${j()}`}});if(!e.ok)throw new Error(`Failed to fetch brands: ${e.status}`);const s=await e.json();if(Array.isArray(s))p(s);else throw new Error("Invalid response format")}catch(e){console.error("Error fetching brands:",e),c(e.message)}finally{S(!1)}},de=async e=>{if(!e||e==="all"){T();return}try{S(!0),c(null);const s=await fetch(`${x}/api/brands/module/${e}`,{headers:{Authorization:`Bearer ${j()}`}});if(!s.ok)throw new Error(`Failed to fetch brands by module: ${s.status}`);const a=await s.json();if(Array.isArray(a))p(a);else throw new Error("Invalid response format")}catch(s){console.error("Error fetching brands by module:",s),c(s.message)}finally{S(!1)}},ue=async()=>{try{$(!0),c(null);const e=new FormData;e.append("title",o.title),e.append("module",o.module);const s=W();s&&e.append("createdBy",s),o.icon&&e.append("icon",o.icon);const a=await fetch(`${x}/api/brands`,{method:"POST",headers:{Authorization:`Bearer ${j()}`},body:e});if(!a.ok){const r=await a.json();throw new Error(r.error||"Failed to create brand")}const d=await a.json();C(d.message||"Brand created successfully"),p([d.brand,...m]),k(),b(1)}catch(e){console.error("Error creating brand:",e),c(e.message)}finally{$(!1)}},he=async()=>{try{$(!0),c(null);const e=new FormData;e.append("title",o.title),e.append("module",o.module);const s=W();s&&e.append("updatedBy",s),o.icon&&e.append("icon",o.icon);const a=await fetch(`${x}/api/brands/${D._id}`,{method:"PUT",headers:{Authorization:`Bearer ${j()}`},body:e});if(!a.ok){const r=await a.json();throw new Error(r.error||"Failed to update brand")}const d=await a.json();C(d.message||"Brand updated successfully"),p(m.map(r=>r._id===D._id?d.brand:r)),k()}catch(e){console.error("Error updating brand:",e),c(e.message)}finally{$(!1)}},xe=async e=>{try{const s=e.isActive?"block":"reactivate",a=W(),d=a?{updatedBy:a}:{},r=await fetch(`${x}/api/brands/${e._id}/${s}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${j()}`},body:JSON.stringify(d)});if(!r.ok){const w=await r.json();throw new Error(w.error||"Failed to toggle brand status")}const i=await r.json();C(i.message),p(m.map(w=>w._id===e._id?i.brand:w))}catch(s){console.error("Error toggling brand status:",s),c(s.message)}},me=async e=>{if(window.confirm("Are you sure you want to delete this brand?"))try{const s=await fetch(`${x}/api/brands/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${j()}`}});if(!s.ok){const i=await s.json().catch(()=>({}));throw new Error(i.error||"Failed to delete brand")}const a=await s.json();C(a.message||"Brand deleted successfully"),p(m.filter(i=>i._id!==e));const d=m.filter(i=>i._id!==e).length,r=Math.ceil(d/f);A>r&&r>0&&b(r)}catch(s){console.error("Error deleting brand:",s),c(s.message)}},V=(e=null)=>{e?(z(!0),L(e),y({title:e.title,module:e.module?._id||e.module||"",icon:null})):(z(!1),L(null),y({title:"",module:"",icon:null})),Q(!0)},k=()=>{Q(!1),z(!1),L(null),y({title:"",module:"",icon:null})},je=()=>{E?he():ue()},F=()=>{let e=[...m];return v.trim()&&(e=e.filter(s=>s.title.toLowerCase().includes(v.toLowerCase())||s.brandId.toLowerCase().includes(v.toLowerCase()))),I!=="all"&&(e=e.filter(s=>I==="active"?s.isActive:!s.isActive)),g!=="all"&&(e=e.filter(s=>(s.module?._id||s.module)===g)),e},pe=()=>{const e=F(),s=(A-1)*f,a=s+f;return e.slice(s,a)},fe=()=>{const e=F();return Math.ceil(e.length/f)},ge=()=>{const e=F(),s=[["Sr","Brand ID","Brand Title","Module","Status","Created At"].join(","),...e.map((i,w)=>[w+1,i.brandId,`"${i.title}"`,`"${i.module?.title||i.module?.name||"N/A"}"`,i.isActive?"Active":"Inactive",new Date(i.createdAt).toLocaleDateString()].join(","))].join(`
`),a=new Blob([s],{type:"text/csv"}),d=window.URL.createObjectURL(a),r=document.createElement("a");r.setAttribute("hidden",""),r.setAttribute("href",d),r.setAttribute("download",`brands_${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(r),r.click(),document.body.removeChild(r)};n.useEffect(()=>{T(),ce()},[]),n.useEffect(()=>{b(1)},[v,I]),n.useEffect(()=>{g!=="all"?de(g):T()},[g]);const X=pe(),Y=fe(),K=F().length;return t.jsxs(u,{sx:{p:3,backgroundColor:"#f5f5f5",minHeight:"100vh"},children:[t.jsxs(u,{sx:{maxWidth:"lg",margin:"auto",backgroundColor:"white",borderRadius:2,boxShadow:1,p:3},children:[t.jsxs(u,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[t.jsxs(U,{variant:"h5",component:"h1",children:["Brand List (",K," ",K===1?"brand":"brands",")"]}),t.jsx(B,{variant:"contained",color:"primary",onClick:()=>V(),children:"+ Create Brand"})]}),H&&t.jsx(Z,{severity:"error",sx:{mb:2},onClose:()=>c(null),children:H}),G&&t.jsx(Z,{severity:"success",sx:{mb:2},onClose:()=>C(null),children:G}),t.jsxs(u,{sx:{display:"flex",gap:2,mb:3,flexWrap:"wrap"},children:[t.jsx(ee,{variant:"outlined",placeholder:"Search by title or ID",value:v,onChange:e=>re(e.target.value),size:"small",sx:{flexGrow:1,minWidth:200},InputProps:{startAdornment:t.jsx($e,{sx:{mr:1,color:"action.active"}})}}),t.jsxs(P,{size:"small",sx:{minWidth:130},children:[t.jsx(_,{children:"Status"}),t.jsxs(M,{value:I,onChange:e=>le(e.target.value),label:"Status",children:[t.jsx(h,{value:"all",children:"All"}),t.jsx(h,{value:"active",children:"Active"}),t.jsx(h,{value:"inactive",children:"Inactive"})]})]}),t.jsxs(P,{size:"small",sx:{minWidth:150},children:[t.jsx(_,{children:"Module"}),t.jsxs(M,{value:g,onChange:e=>q(e.target.value),label:"Module",children:[t.jsx(h,{value:"all",children:"All Modules"}),J.map(e=>t.jsx(h,{value:e._id,children:e.title||e.name},e._id))]})]}),t.jsx(B,{variant:"outlined",startIcon:t.jsx(ye,{}),onClick:ge,disabled:m.length===0,children:"Export"}),t.jsx(B,{variant:"outlined",startIcon:t.jsx(Te,{}),onClick:()=>{q("all"),T()},disabled:O,children:"Refresh"})]}),O?t.jsx(u,{display:"flex",justifyContent:"center",p:4,children:t.jsx(te,{})}):t.jsxs(t.Fragment,{children:[t.jsxs(we,{children:[t.jsx(ve,{children:t.jsxs(N,{children:[t.jsx(l,{children:"Sr"}),t.jsx(l,{children:"Brand ID"}),t.jsx(l,{children:"Icon"}),t.jsx(l,{children:"Title"}),t.jsx(l,{children:"Module"}),t.jsx(l,{children:"Status"}),t.jsx(l,{children:"Created At"}),t.jsx(l,{children:"Actions"})]})}),t.jsx(Ce,{children:X.length===0?t.jsx(N,{children:t.jsx(l,{colSpan:8,align:"center",children:"No brands found"})}):X.map((e,s)=>t.jsxs(N,{children:[t.jsx(l,{children:(A-1)*f+s+1}),t.jsx(l,{children:e.brandId}),t.jsx(l,{children:e.icon&&t.jsx("img",{src:`${x}/${e.icon}`,alt:e.title,style:{width:80,height:40,objectFit:"contain"},onError:a=>{a.target.style.display="none"}})}),t.jsx(l,{children:e.title}),t.jsx(l,{children:e.module?.title||e.module?.name||"N/A"}),t.jsx(l,{children:t.jsx(be,{label:e.isActive?"Active":"Inactive",color:e.isActive?"success":"default",size:"small",onClick:()=>xe(e),sx:{cursor:"pointer"}})}),t.jsx(l,{children:new Date(e.createdAt).toLocaleDateString()}),t.jsx(l,{children:t.jsxs(u,{sx:{display:"flex",gap:1},children:[t.jsx(se,{title:"Edit",children:t.jsx(ae,{size:"small",color:"primary",onClick:()=>V(e),children:t.jsx(Be,{fontSize:"small"})})}),t.jsx(se,{title:"Delete",children:t.jsx(ae,{size:"small",color:"error",onClick:()=>me(e._id),children:t.jsx(Se,{fontSize:"small"})})})]})})]},e._id))})]}),Y>1&&t.jsxs(u,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mt:3},children:[t.jsxs(P,{size:"small",children:[t.jsx(_,{children:"Rows"}),t.jsxs(M,{value:f,onChange:e=>{ne(e.target.value),b(1)},label:"Rows",children:[t.jsx(h,{value:5,children:"5"}),t.jsx(h,{value:10,children:"10"}),t.jsx(h,{value:25,children:"25"}),t.jsx(h,{value:50,children:"50"})]})]}),t.jsx(ke,{count:Y,page:A,onChange:(e,s)=>b(s),color:"primary"})]})]})]}),t.jsxs(Ae,{open:ie,onClose:k,maxWidth:"sm",fullWidth:!0,children:[t.jsx(Ie,{children:E?"Edit Brand":"Create Brand"}),t.jsx(Ee,{children:t.jsxs(u,{sx:{display:"flex",flexDirection:"column",gap:2,pt:2},children:[t.jsx(ee,{label:"Brand Title",value:o.title,onChange:e=>y({...o,title:e.target.value}),fullWidth:!0,required:!0}),t.jsxs(P,{fullWidth:!0,required:!0,children:[t.jsx(_,{children:"Module"}),t.jsx(M,{value:o.module,onChange:e=>y({...o,module:e.target.value}),label:"Module",children:J.map(e=>t.jsx(h,{value:e._id,children:e.title||e.name},e._id))})]}),t.jsxs(u,{children:[t.jsx(U,{variant:"body2",sx:{mb:1},children:"Brand Icon (PNG/JPEG, max 2MB)"}),t.jsx("input",{type:"file",accept:"image/png, image/jpeg",onChange:e=>y({...o,icon:e.target.files[0]})}),E&&D?.icon&&t.jsxs(u,{sx:{mt:2},children:[t.jsx(U,{variant:"caption",children:"Current Icon:"}),t.jsx("img",{src:`${x}/${D.icon}`,alt:"Current",style:{width:100,height:50,objectFit:"contain",display:"block",marginTop:8}})]})]})]})}),t.jsxs(De,{children:[t.jsx(B,{onClick:k,disabled:R,children:"Cancel"}),t.jsx(B,{onClick:je,variant:"contained",disabled:R||!o.title.trim()||!o.module,children:R?t.jsx(te,{size:24}):E?"Update":"Create"})]})]})]})};export{ze as default};
