import{r as u,a as it,j as e,B as l,S as X,C as U,T as d,Z as Se,A as Ie,d as C,q as Ae,m as Te,a4 as nt,a2 as lt,g as S,M as I,c as Q,a6 as Ee,o as De,b as dt,l as ct,a8 as We,a9 as Pe,D as $e,J as ut,K as ht,N as gt,Q as mt,U as ge,V as w,W as xt,a3 as me,X as pt,Y as ft,_ as Fe,$ as Me,a0 as Re,G as A,a1 as ze}from"./index-C-AtCVLN.js";import{C as Ne}from"./CloudUpload-Di5NvzSY.js";import{S as yt}from"./Search-B53zclG-.js";import{E as bt}from"./ExpandMore-BV-AX-RV.js";import{E as jt}from"./FileDownload-Cc87oadK.js";import{E as vt}from"./TableView-JqA55pCO.js";import{C as Ct}from"./Description-BLKU7EdF.js";const z="https://api.bookmyevent.ae/api";function Wt(){const[f,Le]=u.useState(0),[N,Be]=u.useState(""),[H,Z]=u.useState(null),[xe,ee]=u.useState(null),[E,Oe]=u.useState([]),[$,te]=u.useState(!0),[v,F]=u.useState(null),[re,ae]=u.useState("all"),[g,Y]=u.useState({name:"",description:"",parentCategory:"",module:"",displayOrder:0,isActive:!0,isFeatured:!1,metaTitle:"",metaDescription:""}),[L,Ue]=u.useState([]),[b,k]=u.useState(!0),[T,p]=u.useState(null),[se,pe]=u.useState({open:!1,message:"",severity:"success"}),[G,J]=u.useState({open:!1,categoryId:null,categoryName:""}),[fe,ye]=u.useState(null),_e=!!fe,x=it(),_=u.useRef(null),oe=u.useRef(null),[M,B]=u.useState({open:!1,categoryId:null,loading:!1}),[m,ie]=u.useState({name:"",description:"",parentCategory:"",module:"",displayOrder:0,isActive:!0,isFeatured:!1,metaTitle:"",metaDescription:""}),[be,je]=u.useState(null),[ne,V]=u.useState(null),[wt,le]=u.useState(null),y=[{key:"default",label:"Default"},{key:"english",label:"English(EN)"},{key:"arabic",label:"Arabic - العربية(AR)"}],W=()=>{const t=localStorage.getItem("token")||sessionStorage.getItem("token");return console.log("Retrieved token:",t?"Token exists":"No token found"),t},He=()=>{const t=localStorage.getItem("user")||sessionStorage.getItem("user");if(!t)return console.log("No user data found in storage"),null;try{const r=JSON.parse(t);return console.log("User role:",r.role),r.role}catch(r){return console.error("Error parsing user data:",r),null}},de=()=>{const t=localStorage.getItem("user")||sessionStorage.getItem("user");if(!t)return null;try{return JSON.parse(t)._id}catch(r){return console.error("Error parsing user data:",r),null}},Ye=(t,r)=>Le(r),ce=u.useCallback(async()=>{const t=W();if(!t){F("You are not authenticated. Please log in."),te(!1);return}te(!0),F(null);try{const r=await fetch(`${z}/modules`,{headers:{Authorization:`Bearer ${t}`,Accept:"application/json"}});if(r.status===401){F("Session expired. Please log in again."),x("/login");return}if(!r.ok){const s=await r.text();throw new Error(`HTTP error! status: ${r.status}: ${s}`)}const a=await r.json();console.log("Fetched modules:",a);let o=[];Array.isArray(a)?o=a:Array.isArray(a.modules)?o=a.modules:a.data&&Array.isArray(a.data.modules)?o=a.data.modules:a.data&&Array.isArray(a.data)&&(o=a.data),Oe(o);const i=window.location.pathname;let c=null;i.includes("/catering")?c=o.find(s=>(s.title||s.name||"").toLowerCase().includes("catering")):i.includes("/auditorium")&&(c=o.find(s=>(s.title||s.name||"").toLowerCase().includes("auditorium"))),c?(Y(s=>({...s,module:c._id})),ae(c._id)):o.length>0?(Y(s=>({...s,module:o[0]._id})),ae(o[0]._id)):F("No modules available. Please create a module first.")}catch(r){console.error("Error fetching modules:",r),F(r.message),h("Failed to fetch modules","error")}finally{te(!1)}},[x]),R=u.useCallback(async()=>{const t=W();if(!t){p("You are not authenticated. Please log in."),k(!1);return}k(!0),p(null);try{const r=`${z}/categories?limit=1000&search=${encodeURIComponent(N)}`,a=await fetch(r,{headers:{Authorization:`Bearer ${t}`,Accept:"application/json"}});if(a.status===401){p("Session expired. Please log in again."),x("/login");return}if(a.status===403){p("Access denied. You don't have permission to view categories."),x("/dashboard");return}if(!a.ok){const s=await a.text();throw new Error(`HTTP error! status: ${a.status}: ${s}`)}const o=await a.json();console.log("Fetched categories:",o);let i=[];Array.isArray(o)?i=o:Array.isArray(o.categories)?i=o.categories:o.data&&Array.isArray(o.data.categories)?i=o.data.categories:o.data&&Array.isArray(o.data)&&(i=o.data);const c=i.map(s=>{let j="";return s.image&&(s.image.startsWith("http://")||s.image.startsWith("https://")?j=s.image:s.image.startsWith("/uploads")||s.image.startsWith("uploads")?j=`https://api.bookmyevent.ae${s.image.startsWith("/")?s.image:`/${s.image}`}`:j=`https://api.bookmyevent.ae/${s.image}`),{id:s._id,names:{default:s.title||s.name||"",english:s.title||s.name||"",arabic:s.title||s.name||""},status:s.isActive!==void 0?s.isActive:!0,image:j,module:s.module||null}});Ue(c)}catch(r){console.error("Error fetching categories:",r),p(r.message),h(`Failed to fetch categories: ${r.message}`,"error")}finally{k(!1)}},[N,x]);u.useEffect(()=>{const t=He(),r=W();if(console.log("Initial check - Token:",r?"Exists":"Missing","Role:",t),!r){console.log("No token found - showing error but staying on page"),p("You are not authenticated. Please log in."),k(!1);return}if(!["admin","manager","superadmin"].includes(t)){console.log("Insufficient permissions - showing error but staying on page"),p("Access denied. Admin, Manager, or Superadmin role required."),k(!1),x("/dashboard");return}ce(),R()},[ce,R,x]);const ve=(t,r)=>{Y(a=>({...a,[t]:r}))},Ge=t=>{const r=t.target.files[0];if(r){if(!r.type.startsWith("image/")){h("Please select a valid image file (JPEG, PNG, GIF, WebP, SVG)","error");return}if(r.size>5*1024*1024){h("File size should be less than 5MB","error");return}Z(r);const a=new FileReader;a.onload=o=>{ee(o.target.result)},a.readAsDataURL(r)}},Je=async()=>{const t=W();if(!t){p("You are not authenticated. Please log in."),x("/login");return}if(!g.name.trim()){h("Please enter a category title in Default language","error");return}if(!g.module||!/^[0-9a-fA-F]{24}$/.test(g.module)){h("Please select a valid module","error");return}k(!0);try{const r=new FormData;r.append("title",g.name.trim()),r.append("module",g.module),g.description.trim()&&r.append("description",g.description.trim()),g.parentCategory.trim()&&r.append("parentCategory",g.parentCategory.trim()),r.append("displayOrder",g.displayOrder),r.append("isActive",g.isActive),r.append("isFeatured",g.isFeatured),g.metaTitle.trim()&&r.append("metaTitle",g.metaTitle.trim()),g.metaDescription.trim()&&r.append("metaDescription",g.metaDescription.trim()),r.append("createdBy",de()),r.append("image",H),console.log("Sending FormData with module:",g.module);const a=await fetch(`${z}/categories`,{method:"POST",headers:{Authorization:`Bearer ${t}`},body:r});if(!a.ok){let c="Failed to add category";const s=a.status;try{const j=await a.text();let n;try{n=JSON.parse(j),c=n.error||c}catch{c=j||c}if(s===401){p("Session expired. Please log in again."),x("/login");return}if(s===403){p("Access denied. You don't have permission to create categories."),x("/dashboard");return}if(s===502&&(c="Server error: Unable to connect to the backend service. Please try again later."),n?.error&&n.error.includes("Unexpected file field")){h(`Image upload failed: ${n.error}. Please ensure the file is sent with the field name 'image'.`,"error");return}if(n?.error&&n.error.includes("title is required")){h("A title is required for the category.","error");return}if(n?.error&&n.error.includes("Module")){h(n.error,"error");return}}catch{c="Failed to parse server response. Please try again."}throw new Error(c)}const o=await a.json(),i=o.data?.category||o.category;h(`Category "${i.title||i.name}" added successfully!`,"success"),Ce(),R()}catch(r){console.error("Error adding category:",r);let a=r.message||"Failed to add category due to a network or server error. Please try again.";r.message.includes("Failed to fetch")&&(a="Network error: Unable to reach the server. Please check your connection or try again later."),h(a,"error")}finally{k(!1)}},Ce=()=>{Y(t=>({...t,name:"",description:"",parentCategory:"",module:t.module||(E.length>0?E[0]._id:""),displayOrder:0,isActive:!0,isFeatured:!1,metaTitle:"",metaDescription:""})),Z(null),ee(null),_.current&&(_.current.value="")},Ve=async t=>{const r=W();if(!r){x("/login");return}B(a=>({...a,open:!0,loading:!0,categoryId:t}));try{const a=await fetch(`${z}/categories/${t}`,{headers:{Authorization:`Bearer ${r}`}});if(!a.ok)throw new Error("Failed to fetch category details");const o=await a.json(),i=o.data||o;if(ie({name:i.title||"",description:i.description||"",parentCategory:i.parentCategory?._id||i.parentCategory||"",module:i.module?._id||i.module||"",displayOrder:i.displayOrder||0,isActive:i.isActive!==void 0?i.isActive:!0,isFeatured:i.isFeatured!==void 0?i.isFeatured:!1,metaTitle:i.metaTitle||"",metaDescription:i.metaDescription||""}),i.image){let c="";i.image.startsWith("http")?c=i.image:c=`https://api.bookmyevent.ae${i.image.startsWith("/")?i.image:`/${i.image}`}`,le(c),V(c)}else le(null),V(null)}catch(a){console.error("Fetch category error:",a),h(`Failed to load category: ${a.message}`,"error"),B(o=>({...o,open:!1}))}finally{B(a=>({...a,loading:!1}))}},q=()=>{B({open:!1,categoryId:null,loading:!1}),ie({name:"",description:"",parentCategory:"",module:"",displayOrder:0,isActive:!0,isFeatured:!1,metaTitle:"",metaDescription:""}),je(null),V(null),le(null),oe.current&&(oe.current.value="")},D=(t,r)=>{ie(a=>{const o={...a,[t]:r};return t==="module"&&(o.parentCategory=""),o})},qe=t=>{const r=t.target.files[0];if(!r)return;if(!r.type.startsWith("image/")){h("Please select a valid image file","error");return}je(r);const a=new FileReader;a.onload=o=>V(o.target.result),a.readAsDataURL(r)},Ke=async()=>{const t=W();if(t){if(!m.name.trim()){h("Please enter a category title","error");return}B(r=>({...r,loading:!0}));try{const r=new FormData;r.append("title",m.name.trim()),r.append("module",m.module),r.append("description",m.description),r.append("parentCategory",m.parentCategory||""),r.append("displayOrder",m.displayOrder),r.append("isActive",m.isActive),r.append("isFeatured",m.isFeatured),r.append("metaTitle",m.metaTitle),r.append("metaDescription",m.metaDescription),r.append("updatedBy",de()),be&&r.append("image",be);const a=await fetch(`${z}/categories/${M.categoryId}`,{method:"PUT",headers:{Authorization:`Bearer ${t}`},body:r});if(!a.ok){const o=await a.json();throw new Error(o.error||"Failed to update category")}h("Category updated successfully!","success"),q(),R()}catch(r){console.error("Update error:",r),h(r.message,"error")}finally{B(r=>({...r,loading:!1}))}}},Xe=t=>Ve(t),Qe=t=>{const r=L.find(a=>a.id===t);J({open:!0,categoryId:t,categoryName:r?.names?.default||""})},Ze=async()=>{const t=W();if(!t){p("You are not authenticated. Please log in."),x("/login");return}k(!0);try{const r=await fetch(`${z}/categories/${G.categoryId}`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`}});if(!r.ok){const a=await r.text();let o;try{o=JSON.parse(a)}catch{o={error:a||"Unknown error"}}if(r.status===401){p("Session expired. Please log in again."),x("/login");return}if(r.status===403){p("Access denied. You don't have permission to delete categories."),x("/dashboard");return}throw new Error(o.error||`HTTP error! status: ${r.status}`)}h(`Category "${G.categoryName}" deleted successfully!`,"success"),J({open:!1,categoryId:null,categoryName:""}),R()}catch(r){console.error("Error deleting category:",r),h(`Failed to delete category: ${r.message}`,"error")}finally{k(!1)}},et=async t=>{const r=W();if(!r){p("You are not authenticated. Please log in."),x("/login");return}const a=L.find(s=>s.id===t);if(!a){h("Category not found","error");return}const o=a.status,i=o?`/categories/${t}/block`:`/categories/${t}/reactivate`,c=o?"blocked":"reactivated";k(!0);try{const s=await fetch(`${z}${i}`,{method:"PATCH",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"},body:JSON.stringify({updatedBy:de()})});if(!s.ok){const P=await s.text();let he;try{he=JSON.parse(P)}catch{he={error:P||"Unknown error"}}if(s.status===401){p("Session expired. Please log in again."),x("/login");return}if(s.status===403){p(`Access denied. You don't have permission to ${c} categories.`),x("/dashboard");return}throw new Error(he.error||`HTTP error! status: ${s.status}`)}const j=await s.json(),n=j.data?.category||j.category;h(`Category "${n.title||n.name}" ${c} successfully`,"info"),R()}catch(s){console.error(`Error ${c} category:`,s),h(`Failed to ${c} category: ${s.message}`,"error")}finally{k(!1)}},h=(t,r="success")=>{pe({open:!0,message:t,severity:r})},we=()=>{pe(t=>({...t,open:!1}))},tt=()=>{x("/login")},rt=()=>{x("/dashboard")},ke=()=>{ce(),R()},K=()=>y[f].key,O=L.filter(t=>{const r=K(),a=t.names[r].toLowerCase().includes(N.toLowerCase()),o=re==="all"||t.module?._id===re;return a&&o}),at=t=>{ye(t.currentTarget)},ue=()=>{ye(null)},st=()=>{const t=K(),a=["SI","ID",`Name (${y[f].label})`,"Module","Status"],o=O.map((n,P)=>[P+1,n.id,n.names[t],n.module?n.module.title||"N/A":"None",n.status?"Active":"Inactive"]);let i=a.join(",")+`
`;o.forEach(n=>{i+=n.map(P=>`"${P}"`).join(",")+`
`});const c=new Blob([i],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a"),j=URL.createObjectURL(c);s.setAttribute("href",j),s.setAttribute("download",`categories_${t}_${new Date().toISOString().split("T")[0]}.csv`),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s),ue(),h("CSV file downloaded successfully!","success")},ot=()=>{const t=K(),a=["SI","ID",`Name (${y[f].label})`,"Module","Status"],o=O.map((n,P)=>[P+1,n.id,n.names[t],n.module?n.module.title||"N/A":"None",n.status?"Active":"Inactive"]);let i=a.join("	")+`
`;o.forEach(n=>{i+=n.join("	")+`
`});const c=new Blob([i],{type:"application/vnd.ms-excel;charset=utf-8;"}),s=document.createElement("a"),j=URL.createObjectURL(c);s.setAttribute("href",j),s.setAttribute("download",`categories_${t}_${new Date().toISOString().split("T")[0]}.xls`),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s),ue(),h("Excel file downloaded successfully!","success")};return b&&L.length===0&&$?e.jsx(l,{sx:{p:2,display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px"},children:e.jsxs(X,{alignItems:"center",spacing:2,children:[e.jsx(U,{}),e.jsx(d,{children:"Loading categories and modules..."})]})}):e.jsxs(l,{sx:{width:"100%",minHeight:"100vh",backgroundColor:"#f5f5f5",p:{xs:2,sm:3}},children:[e.jsx(Se,{open:!!T||!!v,autoHideDuration:null,onClose:()=>{p(null),F(null)},children:e.jsx(Ie,{severity:"error",onClose:()=>{p(null),F(null)},action:e.jsxs(X,{direction:"row",spacing:1,children:[(T||v)&&(T?.includes("not authenticated")||v?.includes("not authenticated"))&&e.jsx(C,{color:"inherit",size:"small",onClick:tt,children:"Go to Login"}),(T||v)&&(T?.includes("Access denied")||v?.includes("Access denied"))&&e.jsx(C,{color:"inherit",size:"small",onClick:rt,children:"Go to Dashboard"}),(T||v)&&!(T?.includes("not authenticated")||v?.includes("not authenticated"))&&!(T?.includes("Access denied")||v?.includes("Access denied"))&&e.jsx(C,{color:"inherit",size:"small",onClick:ke,children:"Retry"})]}),children:T||v})}),e.jsx(l,{sx:{display:"flex",justifyContent:"center",mb:4},children:e.jsx(Ae,{sx:{width:"100%",maxWidth:"1400px",boxShadow:3,borderRadius:3},children:e.jsxs(Te,{sx:{p:{xs:2,sm:4}},children:[e.jsx(nt,{value:f,onChange:Ye,variant:"scrollable",scrollButtons:"auto",sx:{mb:4,borderBottom:1,borderColor:"divider","& .MuiTabs-indicator":{backgroundColor:"#2196f3"}},children:y.map(t=>e.jsx(lt,{label:t.label},t.key))}),e.jsxs(d,{variant:"subtitle1",sx:{mb:1,fontWeight:500},children:["Title (",y[f].label,") ",e.jsx("span",{style:{color:"#f44336"},children:"*"})]}),e.jsx(S,{fullWidth:!0,value:y[f].key==="default"?g.name:"",onChange:t=>y[f].key==="default"&&ve("name",t.target.value),placeholder:`Enter category title in ${y[f].label}`,variant:"outlined",disabled:y[f].key!=="default",sx:{mb:4,"& .MuiOutlinedInput-root":{direction:y[f].key==="arabic"?"rtl":"ltr"}}}),e.jsxs(d,{variant:"subtitle1",sx:{mb:1,fontWeight:500},children:["Module ",e.jsx("span",{style:{color:"#f44336"},children:"*"})]}),e.jsx(S,{select:!0,fullWidth:!0,value:g.module,onChange:t=>ve("module",t.target.value),placeholder:"Select a module",variant:"outlined",disabled:$||v||E.length===0,sx:{mb:4,"& .MuiOutlinedInput-root":{backgroundColor:$||v||E.length===0?"#f5f5f5":"white"}},children:$?e.jsx(I,{value:"",children:"Loading modules..."}):v?e.jsx(I,{value:"",children:"Error loading modules"}):E.length===0?e.jsx(I,{value:"",children:"No modules available"}):E.map(t=>e.jsx(I,{value:t._id,children:t.title||t.name||"Unnamed Module"},t._id))}),e.jsxs(d,{variant:"subtitle1",sx:{mb:1,fontWeight:500},children:["Image ",e.jsx("span",{style:{color:"#f44336"},children:"*"})," ",e.jsx("span",{style:{color:"#e91e63",fontSize:"0.875rem"},children:"(Ratio 3:2)"})]}),e.jsxs(l,{sx:{display:"flex",gap:3,mb:4,flexDirection:{xs:"column",sm:"row"}},children:[e.jsxs(l,{children:[e.jsx("input",{id:"image-upload-input",type:"file",accept:"image/*",onChange:Ge,ref:_,style:{display:"none"}}),e.jsx("label",{htmlFor:"image-upload-input",children:e.jsxs(C,{component:"span",variant:"outlined",sx:{width:{xs:"100%",sm:240},height:{xs:100,sm:140},border:"2px dashed #e0e0e0",borderRadius:2,display:"flex",flexDirection:"column",gap:1,color:"text.secondary",textTransform:"none","&:hover":{borderColor:"#2196f3",backgroundColor:"#e3f2fd",border:"2px dashed #2196f3"}},children:[e.jsx(Ne,{sx:{fontSize:40,color:"#bdbdbd"}}),e.jsx(d,{variant:"body2",color:"text.secondary",children:H?"Change Image":"Upload Image"})]})})]}),xe&&e.jsxs(l,{sx:{position:"relative"},children:[e.jsxs(l,{sx:{width:{xs:"100%",sm:240},height:{xs:160,sm:140},border:"2px solid #e0e0e0",borderRadius:2,overflow:"hidden",position:"relative"},children:[e.jsx("img",{src:xe,alt:"Preview",style:{width:"100%",height:"100%",objectFit:"cover"}}),e.jsx(Q,{size:"small",onClick:()=>{ee(null),Z(null),_.current&&(_.current.value="")},sx:{position:"absolute",top:8,right:8,backgroundColor:"rgba(0,0,0,0.5)",color:"white","&:hover":{backgroundColor:"rgba(0,0,0,0.7)"}},children:e.jsx(Ee,{fontSize:"small"})})]}),e.jsx(d,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:H?.name})]})]}),e.jsxs(l,{sx:{display:"flex",flexWrap:"wrap",justifyContent:{xs:"center",sm:"flex-end"},gap:2},children:[e.jsx(C,{variant:"outlined",onClick:Ce,sx:{px:4,py:1.5,textTransform:"none",borderColor:"#e0e0e0",color:"#666","&:hover":{borderColor:"#bdbdbd",backgroundColor:"#f5f5f5"}},disabled:b||$,children:"Reset"}),e.jsx(C,{variant:"contained",onClick:Je,disabled:!g.name.trim()||!g.module||!/^[0-9a-fA-F]{24}$/.test(g.module)||!H||b||$||v||E.length===0,sx:{px:4,py:1.5,backgroundColor:"#00695c",textTransform:"none","&:hover":{backgroundColor:"#004d40"},"&:disabled":{backgroundColor:"#e0e0e0",color:"#999"}},children:b?e.jsx(U,{size:20,color:"inherit"}):"Add"})]})]})})}),e.jsx(l,{sx:{display:"flex",justifyContent:"center"},children:e.jsx(Ae,{sx:{width:"100%",maxWidth:"1400px",boxShadow:3,borderRadius:3},children:e.jsxs(Te,{sx:{p:{xs:2,sm:3}},children:[e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",flexWrap:"wrap",gap:2,mb:3},children:[e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(d,{variant:"h6",fontWeight:600,children:"Category List"}),e.jsx(De,{label:O.length,size:"small",sx:{backgroundColor:"#e3f2fd",color:"#2196f3",fontWeight:600}}),e.jsx(De,{label:`Language: ${y[f].label}`,size:"small",sx:{backgroundColor:"#e8f5e8",color:"#2e7d32",fontWeight:500}})]}),e.jsxs(l,{sx:{display:"flex",flexWrap:"wrap",gap:2,alignItems:"center"},children:[e.jsxs(S,{select:!0,size:"small",value:re,onChange:t=>ae(t.target.value),sx:{minWidth:{xs:"100%",sm:200}},disabled:b||$,children:[e.jsx(I,{value:"all",children:"All Modules"}),E.map(t=>e.jsx(I,{value:t._id,children:t.title||t.name||"Unnamed Module"},t._id))]}),e.jsx(S,{size:"small",placeholder:`Search categories in ${y[f].label}`,value:N,onChange:t=>Be(t.target.value),sx:{minWidth:{xs:"100%",sm:250,md:300},"& .MuiOutlinedInput-root":{direction:y[f].key==="arabic"?"rtl":"ltr"}},InputProps:{startAdornment:e.jsx(dt,{position:"start",children:e.jsx(yt,{sx:{color:"#bdbdbd"}})})},disabled:b}),e.jsx(C,{variant:"outlined",startIcon:e.jsx(jt,{}),endIcon:e.jsx(bt,{}),onClick:at,sx:{textTransform:"none",borderColor:"#e0e0e0",color:"#2196f3","&:hover":{borderColor:"#2196f3",backgroundColor:"#e3f2fd"}},disabled:b||O.length===0,children:"Export"}),e.jsxs(ct,{anchorEl:fe,open:_e,onClose:ue,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},sx:{"& .MuiPaper-root":{minWidth:180,boxShadow:"0 4px 20px rgba(0,0,0,0.1)",borderRadius:2,mt:1}},children:[e.jsxs(I,{onClick:ot,sx:{py:1.5,px:2},children:[e.jsx(We,{children:e.jsx(vt,{sx:{color:"#1976d2"}})}),e.jsx(Pe,{primary:"Export to Excel",primaryTypographyProps:{fontWeight:500}})]}),e.jsx($e,{}),e.jsxs(I,{onClick:st,sx:{py:1.5,px:2},children:[e.jsx(We,{children:e.jsx(Ct,{sx:{color:"#2e7d32"}})}),e.jsx(Pe,{primary:"Export to CSV",primaryTypographyProps:{fontWeight:500}})]})]})]})]}),b&&L.length>0&&e.jsx(l,{display:"flex",justifyContent:"center",p:2,children:e.jsx(U,{size:24})}),e.jsx(ut,{component:ht,sx:{overflowX:"auto"},children:e.jsxs(gt,{size:"small",children:[e.jsx(mt,{sx:{backgroundColor:"#fafafa"},children:e.jsxs(ge,{children:[e.jsx(w,{sx:{fontWeight:600,color:"#666"},children:"SI"}),e.jsx(w,{sx:{fontWeight:600,color:"#666"},children:"Image"}),e.jsxs(w,{sx:{fontWeight:600,color:"#666",direction:y[f].key==="arabic"?"rtl":"ltr"},children:["Name (",y[f].label,")"]}),e.jsx(w,{sx:{fontWeight:600,color:"#666"},children:"Module"}),e.jsx(w,{sx:{fontWeight:600,color:"#666"},children:"Status"}),e.jsx(w,{sx:{fontWeight:600,color:"#666"},children:"Action"})]})}),e.jsx(xt,{children:O.length>0?O.map((t,r)=>{const a=K();return e.jsxs(ge,{sx:{"&:hover":{backgroundColor:"#f9f9f9"}},children:[e.jsx(w,{children:r+1}),e.jsx(w,{children:t.image?e.jsx(l,{sx:{width:50,height:35,borderRadius:1,overflow:"hidden",border:"1px solid #e0e0e0"},children:e.jsx("img",{src:t.image,alt:t.names[a],style:{width:"100%",height:"100%",objectFit:"cover"},onError:o=>{console.error("Image failed to load:",t.image),o.target.style.display="none",o.target.parentElement.innerHTML='<div style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:#f5f5f5;font-size:10px;color:#999;">Error</div>'}})}):e.jsx(l,{sx:{width:50,height:35,borderRadius:1,backgroundColor:"#f5f5f5",display:"flex",alignItems:"center",justifyContent:"center",border:"1px solid #e0e0e0"},children:e.jsx(d,{variant:"caption",color:"text.secondary",children:"No Image"})})}),e.jsx(w,{sx:{fontWeight:500,maxWidth:200,direction:y[f].key==="arabic"?"rtl":"ltr"},children:e.jsx(d,{variant:"body2",sx:{wordBreak:"break-word"},children:t.names[a]})}),e.jsx(w,{children:e.jsx(d,{variant:"body2",children:t.module?t.module.title||"N/A":"None"})}),e.jsx(w,{children:e.jsx(me,{checked:t.status,onChange:()=>et(t.id),sx:{"& .MuiSwitch-switchBase.Mui-checked":{color:"#2196f3"},"& .MuiSwitch-switchBase.Mui-checked + .MuiSwitch-track":{backgroundColor:"#2196f3"}},disabled:b})}),e.jsx(w,{children:e.jsxs(l,{sx:{display:"flex",gap:1},children:[e.jsx(Q,{size:"small",onClick:()=>Xe(t.id),sx:{color:"#2196f3"},disabled:b,children:e.jsx(pt,{fontSize:"small"})}),e.jsx(Q,{size:"small",onClick:()=>Qe(t.id),sx:{color:"#f44336"},disabled:b,children:e.jsx(ft,{fontSize:"small"})})]})})]},t.id)}):e.jsx(ge,{children:e.jsx(w,{colSpan:6,sx:{textAlign:"center",py:4,color:"#999"},children:e.jsxs(X,{spacing:2,alignItems:"center",children:[e.jsx(d,{variant:"h6",color:"textSecondary",children:b?"Loading categories...":N?`No categories found matching your search in ${y[f].label}.`:"No categories available."}),T||v?e.jsx(C,{variant:"outlined",onClick:ke,children:"Try Again"}):!b&&!N&&e.jsx(d,{variant:"body2",color:"textSecondary",children:"Create your first category using the form above"})]})})})})]})})]})})}),e.jsxs(Fe,{open:M.open,onClose:q,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:3,boxShadow:"0 8px 32px rgba(0,0,0,0.1)"}},TransitionProps:{timeout:400},children:[e.jsxs(Me,{sx:{m:0,p:2,display:"flex",alignItems:"center",justifyContent:"space-between",borderBottom:"1px solid #eee",bgcolor:"#fafafa"},children:[e.jsx(d,{variant:"h6",fontWeight:700,color:"primary",children:"Edit Category"}),e.jsx(Q,{onClick:q,sx:{color:"#999","&:hover":{color:"#f44336"}},children:e.jsx(Ee,{})})]}),e.jsx(Re,{sx:{p:4},children:M.loading?e.jsxs(l,{sx:{display:"flex",flexDirection:"column",alignItems:"center",py:8,gap:2},children:[e.jsx(U,{size:48,thickness:4}),e.jsx(d,{variant:"body1",color:"textSecondary",fontWeight:500,children:"Fetching category details..."})]}):e.jsxs(X,{spacing:4,sx:{mt:1},children:[e.jsxs(l,{children:[e.jsxs(d,{variant:"subtitle2",sx:{mb:2,color:"#666",fontWeight:600,display:"flex",alignItems:"center",gap:1},children:[e.jsx(l,{component:"span",sx:{width:4,height:16,bgcolor:"primary.main",borderRadius:1}}),"Basic Information"]}),e.jsxs(A,{container:!0,spacing:3,children:[e.jsxs(A,{item:!0,xs:12,children:[e.jsx(d,{variant:"body2",gutterBottom:!0,fontWeight:500,children:"Category Title *"}),e.jsx(S,{fullWidth:!0,value:m.name,onChange:t=>D("name",t.target.value),placeholder:"e.g. Premium Venues",size:"small",variant:"outlined"})]}),e.jsxs(A,{item:!0,xs:12,children:[e.jsx(d,{variant:"body2",gutterBottom:!0,fontWeight:500,children:"Description"}),e.jsx(S,{fullWidth:!0,multiline:!0,rows:3,value:m.description,onChange:t=>D("description",t.target.value),placeholder:"Provide a brief description of this category..."})]})]})]}),e.jsxs(l,{children:[e.jsxs(d,{variant:"subtitle2",sx:{mb:2,color:"#666",fontWeight:600,display:"flex",alignItems:"center",gap:1},children:[e.jsx(l,{component:"span",sx:{width:4,height:16,bgcolor:"primary.main",borderRadius:1}}),"Associations"]}),e.jsxs(A,{container:!0,spacing:3,children:[e.jsxs(A,{item:!0,xs:12,sm:6,children:[e.jsx(d,{variant:"body2",gutterBottom:!0,fontWeight:500,children:"Module *"}),e.jsx(S,{select:!0,fullWidth:!0,size:"small",value:m.module,onChange:t=>D("module",t.target.value),children:E.map(t=>e.jsx(I,{value:t._id,children:t.title||t.name},t._id))})]}),e.jsxs(A,{item:!0,xs:12,sm:6,children:[e.jsx(d,{variant:"body2",gutterBottom:!0,fontWeight:500,children:"Parent Category"}),e.jsxs(S,{select:!0,fullWidth:!0,size:"small",value:m.parentCategory,onChange:t=>D("parentCategory",t.target.value),children:[e.jsx(I,{value:"",children:e.jsx("em",{children:"None (Root Category)"})}),L.filter(t=>!t.parentCategory&&t.module?._id===m.module&&t.id!==M.categoryId).map(t=>e.jsx(I,{value:t.id,children:t.names.default},t.id))]})]})]})]}),e.jsxs(l,{children:[e.jsxs(d,{variant:"subtitle2",sx:{mb:2,color:"#666",fontWeight:600,display:"flex",alignItems:"center",gap:1},children:[e.jsx(l,{component:"span",sx:{width:4,height:16,bgcolor:"primary.main",borderRadius:1}}),"Media & Visuals"]}),e.jsxs(l,{sx:{display:"flex",gap:4,alignItems:"flex-start"},children:[e.jsx(l,{sx:{width:180,height:120,border:"1px solid #e0e0e0",borderRadius:2,overflow:"hidden",backgroundColor:"#f9f9f9",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"inset 0 2px 4px rgba(0,0,0,0.05)"},children:ne?e.jsx("img",{src:ne,alt:"Preview",style:{width:"100%",height:"100%",objectFit:"cover"}}):e.jsx(d,{variant:"caption",color:"textSecondary",children:"No Image Selected"})}),e.jsxs(l,{sx:{flex:1},children:[e.jsx("input",{type:"file",id:"edit-img-input",style:{display:"none"},accept:"image/*",onChange:qe,ref:oe}),e.jsx("label",{htmlFor:"edit-img-input",children:e.jsx(C,{component:"span",variant:"soft",size:"medium",startIcon:e.jsx(Ne,{}),sx:{textTransform:"none",bgcolor:"#e3f2fd",color:"#1976d2","&:hover":{bgcolor:"#bbdefb"}},children:ne?"Replace Image":"Upload Image"})}),e.jsxs(d,{variant:"caption",display:"block",color:"textSecondary",sx:{mt:1.5,lineHeight:1.6},children:["Recommended: ",e.jsx("strong",{children:"600x400px"})," (3:2 ratio).",e.jsx("br",{}),"Max file size: 5MB. Supports JPG, PNG, WebP."]})]})]})]}),e.jsx($e,{sx:{borderStyle:"dashed"}}),e.jsxs(l,{children:[e.jsxs(d,{variant:"subtitle2",sx:{mb:2,color:"#666",fontWeight:600,display:"flex",alignItems:"center",gap:1},children:[e.jsx(l,{component:"span",sx:{width:4,height:16,bgcolor:"primary.main",borderRadius:1}}),"Settings & SEO"]}),e.jsxs(A,{container:!0,spacing:3,children:[e.jsxs(A,{item:!0,xs:12,sm:4,children:[e.jsx(d,{variant:"body2",gutterBottom:!0,fontWeight:500,children:"Display Order"}),e.jsx(S,{fullWidth:!0,type:"number",size:"small",value:m.displayOrder,onChange:t=>D("displayOrder",t.target.value)})]}),e.jsxs(A,{item:!0,xs:12,sm:8,sx:{display:"flex",gap:6,alignItems:"center",height:"100%",pt:2.5},children:[e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(d,{variant:"body2",fontWeight:500,children:"Active Status"}),e.jsx(me,{checked:m.isActive,onChange:t=>D("isActive",t.target.checked),size:"medium"})]}),e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(d,{variant:"body2",fontWeight:500,children:"Featured"}),e.jsx(me,{checked:m.isFeatured,onChange:t=>D("isFeatured",t.target.checked),color:"secondary",size:"medium"})]})]}),e.jsxs(A,{item:!0,xs:12,sm:6,children:[e.jsx(d,{variant:"body2",gutterBottom:!0,fontWeight:500,children:"Meta Title (SEO)"}),e.jsx(S,{fullWidth:!0,size:"small",value:m.metaTitle,onChange:t=>D("metaTitle",t.target.value),placeholder:"Title for search engines"})]}),e.jsxs(A,{item:!0,xs:12,sm:6,children:[e.jsx(d,{variant:"body2",gutterBottom:!0,fontWeight:500,children:"Meta Description (SEO)"}),e.jsx(S,{fullWidth:!0,size:"small",value:m.metaDescription,onChange:t=>D("metaDescription",t.target.value),placeholder:"Short summary for search results"})]})]})]})]})}),e.jsxs(ze,{sx:{p:3,borderTop:"1px solid #eee",bgcolor:"#fafafa"},children:[e.jsx(C,{onClick:q,variant:"outlined",sx:{textTransform:"none",px:4,borderRadius:2,borderColor:"#ddd",color:"#666"},disabled:M.loading,children:"Cancel"}),e.jsx(C,{onClick:Ke,variant:"contained",color:"primary",sx:{textTransform:"none",px:5,borderRadius:2,boxShadow:"0 4px 12px rgba(25, 118, 210, 0.2)",fontWeight:600},disabled:M.loading||!m.name.trim(),children:M.loading?e.jsx(U,{size:20,color:"inherit"}):"Save Changes"})]})]}),e.jsxs(Fe,{open:G.open,onClose:()=>J({open:!1,categoryId:null,categoryName:""}),maxWidth:"sm",fullWidth:!0,children:[e.jsx(Me,{sx:{fontWeight:600},children:"Confirm Delete"}),e.jsx(Re,{children:e.jsxs(d,{children:['Are you sure you want to delete the category "',G.categoryName,'"? This action cannot be undone.']})}),e.jsxs(ze,{sx:{p:3,gap:1},children:[e.jsx(C,{onClick:()=>J({open:!1,categoryId:null,categoryName:""}),variant:"outlined",sx:{textTransform:"none"},disabled:b,children:"Cancel"}),e.jsx(C,{onClick:Ze,variant:"contained",color:"error",sx:{textTransform:"none"},disabled:b,children:b?e.jsx(U,{size:20,color:"inherit"}):"Delete"})]})]}),e.jsx(Se,{open:se.open,autoHideDuration:4e3,onClose:we,anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(Ie,{onClose:we,severity:se.severity,variant:"filled",sx:{width:"100%"},children:se.message})})]})}export{Wt as default};
