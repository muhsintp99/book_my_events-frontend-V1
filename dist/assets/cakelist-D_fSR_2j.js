import{a as Ne,r as u,j as e,J as ze,K as _e,B as x,d as j,g as f,b as Be,ah as Le,l as Re,M as ae,C as O,T as o,N as We,Q as Oe,U as F,V as d,W as Ve,a3 as ne,c as A,aV as Ue,X as le,Y as oe,_ as q,$ as H,a0 as M,G as h,aK as Fe,aQ as qe,aP as He,aL as Me,aM as Ge,aN as Ke,aO as Ye,D as Je,ae as ce,af as de,a8 as ue,o as he,a1 as G,a6 as Qe,a4 as Xe,a2 as K,aR as Ze,aS as et,aJ as tt,Z as st,A as it}from"./index-Bht4W_XB.js";const nt=()=>{Ne();const[C,b]=u.useState([]),[E,y]=u.useState([]),[Y,pe]=u.useState(""),[xe,D]=u.useState(!1),[w,J]=u.useState(null),[V,Q]=u.useState(!0),[v,N]=u.useState({}),[U,p]=u.useState({open:!1,message:"",severity:"success"}),[X,z]=u.useState(null),ge=!!X,[me,_]=u.useState(!1),[c,je]=u.useState(null),[fe,S]=u.useState(!1),[k,ve]=u.useState(null),[m,g]=u.useState({}),[B,Z]=u.useState(!1),[L,ee]=u.useState(0),T="https://api.bookmyevent.ae/api/catering",be=()=>{try{return localStorage.getItem("token")||sessionStorage.getItem("token")}catch{return null}},P=(t="GET",s=null)=>{const a=be(),l={method:t,headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include",mode:"cors"};return a&&(l.headers.Authorization=`Bearer ${a}`),s&&(l.body=JSON.stringify(s)),l},$=async(t,s,a=2)=>{for(let l=0;l<=a;l++)try{const r=new AbortController,i=setTimeout(()=>r.abort(),1e4),n=await fetch(t,{...s,signal:r.signal});if(clearTimeout(i),!n.ok){const De=await n.text();throw n.status===401?new Error("Authentication required"):n.status===403?new Error("Forbidden"):n.status===404?new Error("Not found"):n.status>=500?new Error("Server error"):new Error(`HTTP ${n.status}: ${De}`)}return await n.json()}catch(r){if(l===a)throw r;await new Promise(i=>setTimeout(i,1e3))}},ye=22.8,I=t=>Math.round(t*ye),te=(t,s)=>({id:s+1,_id:t._id,cateringId:t.cateringId,title:t.title||"Untitled",subtitle:t.subtitle||"",description:t.description||"",cateringType:t.cateringType||"",price:t.price??0,providerName:t.provider?.firstName&&t.provider?.lastName?`${t.provider.firstName} ${t.provider.lastName}`:t.provider?.firstName||"—",providerEmail:t.provider?.email||"",includes:(t.includes||[]).map(a=>`${a.title}: ${a.items.join(", ")}`).join(" | "),isTopPick:t.isTopPick??!1,isActive:t.isActive??!1,thumbnail:t.thumbnail||"",searchTags:t.searchTags||[],faqs:t.faqs||[],rawCatering:t}),se=async(t=!1)=>{try{Q(!0);const s=t?`${T}/top-picks`:T,a=await $(s,P());if(a?.data&&Array.isArray(a.data)){const r=a.data.filter(i=>i.module?.title?.toLowerCase().includes("cake")).map((i,n)=>te(i,n));y(r),b(r)}}catch(s){p({open:!0,message:`Error: ${s.message}`,severity:"error"})}finally{Q(!1)}};u.useEffect(()=>{se()},[]);const Te=u.useCallback(async t=>{const s=`${t}-topPick`;if(v[s])return;const a=C.find(r=>r._id===t);if(!a)return;const l=!a.isTopPick;N(r=>({...r,[s]:!0})),b(r=>r.map(i=>i._id===t?{...i,isTopPick:l}:i)),y(r=>r.map(i=>i._id===t?{...i,isTopPick:l}:i));try{const r=await $(`${T}/${t}/toggle-top-pick`,P("PATCH"));if(!r.success)throw new Error(r.message||"Failed");p({open:!0,message:r.data.isTopPick?"Top-pick enabled":"Top-pick disabled",severity:"success"})}catch(r){b(i=>i.map(n=>n._id===t?{...n,isTopPick:!l}:n)),y(i=>i.map(n=>n._id===t?{...n,isTopPick:!l}:n)),p({open:!0,message:r.message,severity:"error"})}finally{N(r=>{const i={...r};return delete i[s],i})}},[C,v]),Ce=u.useCallback(async t=>{const s=`${t}-status`;if(v[s])return;const a=C.find(r=>r._id===t);if(!a)return;const l=!a.isActive;N(r=>({...r,[s]:!0})),b(r=>r.map(i=>i._id===t?{...i,isActive:l}:i)),y(r=>r.map(i=>i._id===t?{...i,isActive:l}:i));try{const r=await $(`${T}/${t}/toggle-active`,P("PATCH"));if(!r.success)throw new Error(r.message||"Failed");p({open:!0,message:r.data.isActive?"Activated":"Deactivated",severity:"success"})}catch(r){b(i=>i.map(n=>n._id===t?{...n,isActive:!l}:n)),y(i=>i.map(n=>n._id===t?{...n,isActive:!l}:n)),p({open:!0,message:r.message,severity:"error"})}finally{N(r=>{const i={...r};return delete i[s],i})}},[C,v]),we=t=>{J(t),D(!0)},Se=async()=>{try{await $(`${T}/${w._id}`,P("DELETE")),b(t=>t.filter(s=>s._id!==w._id)),y(t=>t.filter(s=>s._id!==w._id)),p({open:!0,message:`${w.title} deleted`,severity:"success"})}catch(t){p({open:!0,message:t.message,severity:"error"})}finally{D(!1),J(null)}},R=C.filter(t=>`${t.title} ${t.subtitle} ${t.providerName}`.toLowerCase().includes(Y.toLowerCase())),ke=()=>{const t=["Sl","Package","Subtitle","Type","Price (INR)","Provider","Provider Email","Includes","Top-Pick","Status"],s=R.map(n=>[n.id,`"${n.title}"`,`"${n.subtitle}"`,n.cateringType,I(n.price),`"${n.providerName}"`,`"${n.providerEmail}"`,`"${n.includes}"`,n.isTopPick?"Yes":"No",n.isActive?"Active":"Inactive"]),a=[t.join(","),...s.map(n=>n.join(","))].join(`
`),l=new Blob([a],{type:"text/csv;charset=utf-8;"}),r=URL.createObjectURL(l),i=document.createElement("a");i.href=r,i.download=`catering_${new Date().toISOString().split("T")[0]}.csv`,i.click(),z(null),p({open:!0,message:"CSV exported",severity:"success"})},Pe=()=>{const s=`<table border="1"><thead><tr>${["Sl","Package","Subtitle","Type","Price (INR)","Provider","Provider Email","Includes","Top-Pick","Status"].map(i=>`<th>${i}</th>`).join("")}</tr></thead><tbody>${R.map(i=>`<tr>
      <td>${i.id}</td><td>${i.title}</td><td>${i.subtitle}</td><td>${i.cateringType}</td><td>${I(i.price)}</td>
      <td>${i.providerName}</td><td>${i.providerEmail}</td><td>${i.includes}</td>
      <td>${i.isTopPick?"Yes":"No"}</td><td>${i.isActive?"Active":"Inactive"}</td>
    </tr>`).join("")}</tbody></table>`,a=new Blob([s],{type:"application/vnd.ms-excel"}),l=URL.createObjectURL(a),r=document.createElement("a");r.href=l,r.download=`catering_${new Date().toISOString().split("T")[0]}.xls`,r.click(),z(null),p({open:!0,message:"Excel exported",severity:"success"})},$e=t=>{je(t.rawCatering),_(!0)},ie=t=>{const s=t.rawCatering;ve(t),g({title:s.title||"",subtitle:s.subtitle||"",description:s.description||"",cateringType:s.cateringType||"",price:s.price||0,includes:s.includes||[],searchTags:s.searchTags||[],faqs:s.faqs||[],thumbnail:s.thumbnail||""}),ee(0),S(!0)},Ie=async()=>{try{Z(!0);const t={...m};t.includes&&(t.includes=t.includes.filter(a=>a.title&&a.items?.length));const s=await $(`${T}/${k._id}`,P("PUT",t));if(s.success){const a=te(s.data,k.id-1);b(l=>l.map(r=>r._id===k._id?a:r)),y(l=>l.map(r=>r._id===k._id?a:r)),p({open:!0,message:"Catering updated",severity:"success"}),S(!1)}}catch(t){p({open:!0,message:t.message||"Update failed",severity:"error"})}finally{Z(!1)}},re=(t,s,a)=>{g(l=>({...l,includes:l.includes.map((r,i)=>i===t?{...r,[s]:a}:r)}))},Ae=()=>g(t=>({...t,includes:[...t.includes||[],{title:"",items:[]}]})),Ee=t=>g(s=>({...s,includes:s.includes.filter((a,l)=>l!==t)})),W={total:E.length,active:E.filter(t=>t.isActive).length,inactive:E.filter(t=>!t.isActive).length,topPick:E.filter(t=>t.isTopPick).length};return e.jsxs(ze,{component:_e,sx:{maxWidth:"100%",overflowX:"auto"},children:[e.jsxs(x,{sx:{display:"flex",flexWrap:"wrap",justifyContent:"space-between",p:2,bgcolor:"#f5f5f5",gap:1},children:[e.jsxs(x,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:[e.jsxs(x,{sx:{bgcolor:"#e3f2fd",p:1,borderRadius:1},children:["Total: ",W.total]}),e.jsxs(x,{sx:{bgcolor:"#fff3e0",p:1,borderRadius:1},children:["Active: ",W.active]}),e.jsxs(x,{sx:{bgcolor:"#e0f7fa",p:1,borderRadius:1},children:["Inactive: ",W.inactive]}),e.jsxs(x,{sx:{bgcolor:"#fce4ec",p:1,borderRadius:1},children:["Top-Pick: ",W.topPick]})]}),e.jsx(j,{variant:"contained",color:"secondary",size:"small",onClick:()=>se(!0),disabled:V,children:V?"Loading...":"Fetch Top-Picks"})]}),e.jsxs(x,{sx:{p:2,display:"flex",flexWrap:"wrap",justifyContent:"space-between",alignItems:"center",gap:1,bgcolor:"#f5f5f5"},children:[e.jsx(f,{placeholder:"Search Package / Provider",size:"small",value:Y,onChange:t=>pe(t.target.value),InputProps:{startAdornment:e.jsx(Be,{position:"start",children:"Search"})},sx:{bgcolor:"white",minWidth:220}}),e.jsx(j,{variant:"contained",color:"primary",size:"small",endIcon:e.jsx(Le,{}),onClick:t=>z(t.currentTarget),children:"Export"}),e.jsxs(Re,{anchorEl:X,open:ge,onClose:()=>z(null),children:[e.jsx(ae,{onClick:Pe,children:"Excel"}),e.jsx(ae,{onClick:ke,children:"CSV"})]})]}),V?e.jsxs(x,{sx:{p:3,display:"flex",alignItems:"center",gap:1},children:[e.jsx(O,{size:20}),e.jsx(o,{children:"Loading caterings..."})]}):e.jsx(x,{sx:{maxHeight:560,overflowY:"auto"},children:e.jsxs(We,{stickyHeader:!0,sx:{minWidth:650},children:[e.jsx(Oe,{children:e.jsxs(F,{sx:{bgcolor:"#f5f5f5"},children:[e.jsx(d,{children:"Sl"}),e.jsx(d,{children:"Package"}),e.jsx(d,{children:"Subtitle"}),e.jsx(d,{children:"Type"}),e.jsx(d,{children:"Price (INR)"}),e.jsx(d,{children:"Provider"}),e.jsx(d,{children:"Includes"}),e.jsx(d,{children:"Top-Pick"}),e.jsx(d,{children:"Status"}),e.jsx(d,{children:"Actions"})]})}),e.jsx(Ve,{children:R.length===0?e.jsx(F,{children:e.jsx(d,{colSpan:10,align:"center",children:e.jsx(o,{color:"textSecondary",children:"No catering packages found"})})}):R.map(t=>{const s=`${t._id}-topPick`,a=`${t._id}-status`;return e.jsxs(F,{hover:!0,children:[e.jsx(d,{children:t.id}),e.jsx(d,{sx:{maxWidth:180,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:t.title}),e.jsx(d,{children:t.subtitle}),e.jsx(d,{children:t.cateringType}),e.jsx(d,{children:I(t.price)}),e.jsx(d,{children:t.providerName}),e.jsx(d,{sx:{maxWidth:250,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:t.includes}),e.jsxs(d,{children:[e.jsx(ne,{size:"small",checked:t.isTopPick,onChange:()=>Te(t._id),disabled:v[s]}),v[s]&&e.jsx(O,{size:14,sx:{ml:.5}})]}),e.jsxs(d,{children:[e.jsx(ne,{size:"small",checked:t.isActive,onChange:()=>Ce(t._id),disabled:v[a]}),v[a]&&e.jsx(O,{size:14,sx:{ml:.5}})]}),e.jsxs(d,{sx:{whiteSpace:"nowrap"},children:[e.jsx(A,{size:"small",color:"info",onClick:()=>$e(t),title:"View",children:e.jsx(Ue,{})}),e.jsx(A,{size:"small",color:"primary",onClick:()=>ie(t),title:"Edit",children:e.jsx(le,{})}),e.jsx(A,{size:"small",color:"error",onClick:()=>we(t),title:"Delete",children:e.jsx(oe,{})})]})]},t._id)})})]})}),e.jsxs(q,{open:me,onClose:()=>_(!1),maxWidth:"lg",fullWidth:!0,children:[e.jsx(H,{sx:{bgcolor:"primary.main",color:"white"},children:e.jsx(o,{variant:"h6",children:c?.title})}),e.jsx(M,{dividers:!0,children:c&&e.jsxs(h,{container:!0,spacing:3,children:[e.jsxs(h,{item:!0,xs:12,md:6,children:[e.jsxs(o,{variant:"subtitle2",color:"textSecondary",gutterBottom:!0,children:[e.jsx(Fe,{fontSize:"small"})," Package"]}),e.jsx(o,{paragraph:!0,children:c.title}),e.jsx(o,{variant:"subtitle2",color:"textSecondary",gutterBottom:!0,children:"Subtitle"}),e.jsx(o,{paragraph:!0,children:c.subtitle||"—"}),e.jsxs(o,{variant:"subtitle2",color:"textSecondary",gutterBottom:!0,children:[e.jsx(qe,{fontSize:"small"})," Price (INR)"]}),e.jsxs(o,{children:["₹",I(c.price)]}),e.jsxs(o,{variant:"subtitle2",color:"textSecondary",gutterBottom:!0,children:[e.jsx(He,{fontSize:"small"})," Type"]}),e.jsx(o,{children:c.cateringType||"—"})]}),e.jsxs(h,{item:!0,xs:12,md:6,children:[e.jsxs(o,{variant:"subtitle2",color:"textSecondary",gutterBottom:!0,children:[e.jsx(Me,{fontSize:"small"})," Provider"]}),e.jsxs(o,{children:[c.provider?.firstName," ",c.provider?.lastName]}),e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Ge,{fontSize:"small"})," ",c.provider?.phone||"—"]}),e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Ke,{fontSize:"small"})," ",c.provider?.email||"—"]}),c.provider?.website&&e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Ye,{fontSize:"small"})," ",e.jsx("a",{href:c.provider.website,target:"_blank",rel:"noopener noreferrer",children:c.provider.website})]})]}),e.jsxs(h,{item:!0,xs:12,children:[e.jsx(Je,{sx:{my:2}}),e.jsx(o,{variant:"subtitle2",color:"textSecondary",gutterBottom:!0,children:"Includes"}),e.jsx(ce,{dense:!0,children:c.includes?.map((t,s)=>e.jsx(de,{disableGutters:!0,children:e.jsx(ue,{primary:e.jsx("strong",{children:t.title}),secondary:t.items.join(", ")})},s))})]}),c.searchTags?.length>0&&e.jsxs(h,{item:!0,xs:12,children:[e.jsx(o,{variant:"subtitle2",color:"textSecondary",gutterBottom:!0,children:"Search Tags"}),e.jsx(x,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:c.searchTags.map(t=>e.jsx(he,{label:t,size:"small",variant:"outlined"},t))})]}),c.description&&e.jsxs(h,{item:!0,xs:12,children:[e.jsx(o,{variant:"subtitle2",color:"textSecondary",gutterBottom:!0,children:"Description"}),e.jsx(o,{paragraph:!0,children:c.description})]}),c.faqs?.length>0&&e.jsxs(h,{item:!0,xs:12,children:[e.jsx(o,{variant:"subtitle2",color:"textSecondary",gutterBottom:!0,children:"FAQs"}),e.jsx(ce,{dense:!0,children:c.faqs.map((t,s)=>e.jsx(de,{children:e.jsx(ue,{primary:t.question,secondary:t.answer})},s))})]})]})}),e.jsxs(G,{children:[e.jsx(j,{onClick:()=>_(!1),variant:"outlined",children:"Close"}),e.jsx(j,{onClick:()=>{_(!1),ie({rawCatering:c})},variant:"contained",startIcon:e.jsx(le,{}),children:"Edit"})]})]}),e.jsxs(q,{open:fe,onClose:()=>S(!1),maxWidth:"lg",fullWidth:!0,children:[e.jsxs(H,{sx:{bgcolor:"primary.main",color:"white",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(o,{variant:"h6",children:["Edit Catering: ",k?.title]}),e.jsx(A,{size:"small",onClick:()=>S(!1),sx:{color:"white"},children:e.jsx(Qe,{})})]}),e.jsxs(M,{dividers:!0,sx:{p:0},children:[e.jsxs(Xe,{value:L,onChange:(t,s)=>ee(s),sx:{borderBottom:1,borderColor:"divider"},children:[e.jsx(K,{label:"Basic"}),e.jsx(K,{label:"Includes"}),e.jsx(K,{label:"Other"})]}),e.jsxs(x,{sx:{p:3},children:[L===0&&e.jsxs(h,{container:!0,spacing:2,children:[e.jsx(h,{item:!0,xs:12,md:6,children:e.jsx(f,{fullWidth:!0,label:"Title",value:m.title||"",onChange:t=>g(s=>({...s,title:t.target.value}))})}),e.jsx(h,{item:!0,xs:12,md:6,children:e.jsx(f,{fullWidth:!0,label:"Subtitle",value:m.subtitle||"",onChange:t=>g(s=>({...s,subtitle:t.target.value}))})}),e.jsx(h,{item:!0,xs:12,children:e.jsx(f,{fullWidth:!0,label:"Description",multiline:!0,rows:3,value:m.description||"",onChange:t=>g(s=>({...s,description:t.target.value}))})}),e.jsx(h,{item:!0,xs:12,md:6,children:e.jsx(f,{fullWidth:!0,label:"Type",value:m.cateringType||"",onChange:t=>g(s=>({...s,cateringType:t.target.value}))})}),e.jsx(h,{item:!0,xs:12,md:6,children:e.jsx(f,{fullWidth:!0,label:"Price (AED)",type:"number",value:m.price||"",onChange:t=>g(s=>({...s,price:Number(t.target.value)})),helperText:`≈ ₹${I(m.price||0)}`})})]}),L===1&&e.jsxs(x,{children:[e.jsx(j,{variant:"outlined",size:"small",onClick:Ae,sx:{mb:2},children:"Add Include"}),m.includes?.map((t,s)=>e.jsx(x,{sx:{border:"1px solid #ddd",borderRadius:1,p:2,mb:2},children:e.jsxs(h,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(h,{item:!0,xs:12,md:4,children:e.jsx(f,{fullWidth:!0,label:"Title",size:"small",value:t.title||"",onChange:a=>re(s,"title",a.target.value)})}),e.jsx(h,{item:!0,xs:12,md:6,children:e.jsx(f,{fullWidth:!0,label:"Items (comma-separated)",size:"small",value:t.items?.join(", ")||"",onChange:a=>re(s,"items",a.target.value.split(",").map(l=>l.trim()).filter(Boolean))})}),e.jsx(h,{item:!0,xs:12,md:2,children:e.jsx(A,{color:"error",onClick:()=>Ee(s),size:"small",children:e.jsx(oe,{})})})]})},s))]}),L===2&&e.jsx(h,{container:!0,spacing:2,children:e.jsx(h,{item:!0,xs:12,children:e.jsx(Ze,{multiple:!0,freeSolo:!0,options:[],value:m.searchTags||[],onChange:(t,s)=>g(a=>({...a,searchTags:s})),renderTags:(t,s)=>t.map((a,l)=>e.jsx(he,{label:a,...s(l)},l)),renderInput:t=>e.jsx(f,{...t,label:"Search Tags"})})})})]})]}),e.jsxs(G,{sx:{p:2,justifyContent:"space-between"},children:[e.jsx(j,{onClick:()=>S(!1),variant:"outlined",disabled:B,children:"Cancel"}),e.jsx(j,{onClick:Ie,variant:"contained",startIcon:B?e.jsx(O,{size:16}):e.jsx(et,{}),disabled:B,children:B?"Saving...":"Save Changes"})]})]}),e.jsxs(q,{open:xe,onClose:()=>D(!1),children:[e.jsx(H,{color:"error",children:"Confirm Delete"}),e.jsx(M,{children:e.jsxs(tt,{children:["Delete ",e.jsx("strong",{children:w?.title}),"? This cannot be undone."]})}),e.jsxs(G,{children:[e.jsx(j,{onClick:()=>D(!1),variant:"outlined",children:"Cancel"}),e.jsx(j,{onClick:Se,variant:"contained",color:"error",children:"Delete"})]})]}),e.jsx(st,{open:U.open,autoHideDuration:4e3,onClose:()=>p(t=>({...t,open:!1})),anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(it,{onClose:()=>p(t=>({...t,open:!1})),severity:U.severity,variant:"filled",children:U.message})})]})};export{nt as default};
