import{r as u,a as nt,j as e,B as c,S as Q,C as U,T as l,Z as Te,A as We,d as j,q as De,m as Ee,g as w,M as b,c as Z,a6 as Pe,o as $e,b as it,l as lt,a7 as Re,a8 as Fe,D as ze,J as dt,K as ct,N as ut,Q as ht,U as xe,V as v,W as gt,a3 as me,X as pt,Y as xt,_ as Me,$ as Ne,a0 as Oe,G as I,a1 as Be}from"./index-Bht4W_XB.js";import{C as Ue}from"./CloudUpload-CFRu4ws6.js";import{S as mt}from"./Search-BKOf03pp.js";import{E as ft}from"./ExpandMore-CwoOqDO-.js";import{E as yt}from"./FileDownload-dUyc0m2Q.js";import{E as jt}from"./TableView-6wH7uzfJ.js";import{C as bt}from"./Description-Bu4r0Py_.js";const z="https://api.bookmyevent.ae/api",ee="static_transport_123456789012345678901234",fe={_id:ee,title:"Transport",name:"Transport"};function Dt(){const[f,vt]=u.useState(0),[E,Le]=u.useState(""),[L,te]=u.useState(null),[ye,re]=u.useState(null),[M,je]=u.useState([]),[P,ae]=u.useState(!0),[A,N]=u.useState(null),[H,se]=u.useState("all"),[h,V]=u.useState({name:"",description:"",parentCategory:"",module:ee,displayOrder:0,isActive:!0,isFeatured:!1,metaTitle:"",metaDescription:""}),[S,_e]=u.useState([]),[x,k]=u.useState(!0),[$,C]=u.useState(null),[oe,be]=u.useState({open:!1,message:"",severity:"success"}),[J,G]=u.useState({open:!1,categoryId:null,categoryName:""}),[ve,Ce]=u.useState(null),He=!!ve,m=nt(),_=u.useRef(null),ne=u.useRef(null),[R,O]=u.useState({open:!1,categoryId:null,loading:!1}),[g,ie]=u.useState({name:"",description:"",parentCategory:"",module:"",displayOrder:0,isActive:!0,isFeatured:!1,metaTitle:"",metaDescription:""}),[we,Se]=u.useState(null),[le,Y]=u.useState(null),[Ct,de]=u.useState(null),y=[{key:"default",label:"Default"},{key:"english",label:"English(EN)"},{key:"arabic",label:"Arabic - العربية(AR)"}],D=()=>localStorage.getItem("token")||sessionStorage.getItem("token"),Ve=()=>{const t=localStorage.getItem("user")||sessionStorage.getItem("user");if(!t)return null;try{return JSON.parse(t).role}catch{return null}},ce=()=>{const t=localStorage.getItem("user")||sessionStorage.getItem("user");if(!t)return null;try{return JSON.parse(t)._id}catch{return null}},ue=u.useCallback(async()=>{const t=D();if(!t){N("You are not authenticated. Please log in."),ae(!1);return}ae(!0),N(null);try{const r=await fetch(`${z}/modules`,{headers:{Authorization:`Bearer ${t}`,Accept:"application/json"}});if(r.status===401){N("Session expired. Please log in again."),m("/login");return}if(!r.ok){const i=await r.text();throw new Error(`HTTP error! status: ${r.status}: ${i}`)}const a=await r.json();let s=[];Array.isArray(a)?s=a:Array.isArray(a.modules)?s=a.modules:a.data&&Array.isArray(a.data.modules)?s=a.data.modules:a.data&&Array.isArray(a.data)&&(s=a.data);const n=s.find(i=>(i.title||i.name||"").toLowerCase().includes("transport")),d=n?s:[fe,...s];je(d);const o=n||fe;V(i=>({...i,module:o._id})),se(o._id)}catch(r){console.error("fetchModules error:",r),N(r.message),p("Failed to fetch modules – using static Transport","warning"),je([fe]),V(a=>({...a,module:ee})),se(ee)}finally{ae(!1)}},[m]),F=u.useCallback(async()=>{const t=D();if(!t){C("You are not authenticated. Please log in."),k(!1);return}k(!0),C(null);try{const r=`${z}/categories?search=${encodeURIComponent(E)}`,a=await fetch(r,{headers:{Authorization:`Bearer ${t}`,Accept:"application/json"}});if(a.status===401){C("Session expired. Please log in again."),m("/login");return}if(a.status===403){C("Access denied. You don't have permission to view categories."),m("/dashboard");return}if(!a.ok){const o=await a.text();throw new Error(`HTTP error! status: ${a.status}: ${o}`)}const s=await a.json();let n=[];Array.isArray(s)?n=s:Array.isArray(s.categories)?n=s.categories:s.data&&Array.isArray(s.data.categories)?n=s.data.categories:s.data&&Array.isArray(s.data)&&(n=s.data);const d=n.map(o=>{let i="";return o.image&&(o.image.startsWith("http://")||o.image.startsWith("https://")?i=o.image:o.image.startsWith("/uploads")||o.image.startsWith("uploads")?i=`https://api.bookmyevent.ae${o.image.startsWith("/")?o.image:`/${o.image}`}`:i=`https://api.bookmyevent.ae/${o.image}`),{id:o._id,names:{default:o.title||o.name||"",english:o.title||o.name||"",arabic:o.title||o.name||""},status:o.isActive!==void 0?o.isActive:!0,image:i,module:o.module||null,parentCategory:o.parentCategory||null,raw:o}});_e(d)}catch(r){console.error("fetchCategories error:",r),C(r.message),p(`Failed to fetch categories: ${r.message}`,"error")}finally{k(!1)}},[E,m]);u.useEffect(()=>{const t=Ve();if(!D()){C("You are not authenticated. Please log in."),k(!1);return}if(!["admin","manager","superadmin"].includes(t)){C("Access denied. Admin, Manager, or Superadmin role required."),k(!1),m("/dashboard");return}ue(),F()},[ue,F,m]);const q=(t,r)=>{V(a=>({...a,[t]:r}))},Je=t=>{const r=t.target.files[0];if(!r)return;if(!r.type.startsWith("image/")){p("Please select a valid image file (JPEG, PNG, GIF, WebP, SVG)","error");return}if(r.size>5*1024*1024){p("File size should be less than 5MB","error");return}te(r);const a=new FileReader;a.onload=s=>re(s.target.result),a.readAsDataURL(r)},ke=()=>{V(t=>({...t,name:"",description:"",parentCategory:"",module:t.module||(M.length>0?M[0]._id:""),displayOrder:0,isActive:!0,isFeatured:!1,metaTitle:"",metaDescription:""})),te(null),re(null),_.current&&(_.current.value="")},Ge=async()=>{const t=D();if(!t){C("You are not authenticated. Please log in."),m("/login");return}if(!h.name.trim()){p("Please enter a category title in Default","error");return}if(!h.module||!/^[0-9a-fA-F]{24}$/.test(h.module)){p("Please select a valid module","error");return}if(!L){p("Please upload an image","error");return}k(!0);try{const r=new FormData;r.append("title",h.name.trim()),r.append("module",h.module),h.description.trim()&&r.append("description",h.description.trim()),h.parentCategory&&r.append("parentCategory",h.parentCategory),r.append("displayOrder",h.displayOrder),r.append("isActive",h.isActive),r.append("isFeatured",h.isFeatured),h.metaTitle.trim()&&r.append("metaTitle",h.metaTitle.trim()),h.metaDescription.trim()&&r.append("metaDescription",h.metaDescription.trim()),r.append("createdBy",ce()),r.append("image",L);const a=await fetch(`${z}/categories`,{method:"POST",headers:{Authorization:`Bearer ${t}`},body:r});if(!a.ok){let d="Failed to add category";const o=a.status;try{const i=await a.text();let W;try{W=JSON.parse(i),d=W.error||d}catch{d=i||d}if(o===401){C("Session expired. Please log in again."),m("/login");return}if(o===403){C("Access denied. You don't have permission to create categories."),m("/dashboard");return}o===502&&(d="Server error: Unable to connect to the backend service. Please try again later.")}catch{d="Failed to parse server response. Please try again."}throw new Error(d)}const s=await await a.json(),n=s.data?.category||s.category||s;p(`Category "${n.title||n.name}" added successfully!`,"success"),ke(),F()}catch(r){console.error("Add error:",r);const a=r.message.includes("Failed to fetch")?"Network error: Unable to reach the server. Please check your connection.":r.message||"Failed to add category";p(a,"error")}finally{k(!1)}},Ye=async t=>{const r=D();if(!r){m("/login");return}O(a=>({...a,open:!0,loading:!0,categoryId:t}));try{const a=await fetch(`${z}/categories/${t}`,{headers:{Authorization:`Bearer ${r}`}});if(!a.ok)throw new Error("Failed to fetch category details");const s=await a.json(),n=s.data||s;if(ie({name:n.title||"",description:n.description||"",parentCategory:n.parentCategory?._id||n.parentCategory||"",module:n.module?._id||n.module||"",displayOrder:n.displayOrder||0,isActive:n.isActive!==void 0?n.isActive:!0,isFeatured:n.isFeatured!==void 0?n.isFeatured:!1,metaTitle:n.metaTitle||"",metaDescription:n.metaDescription||""}),n.image){let d="";n.image.startsWith("http")?d=n.image:d=`https://api.bookmyevent.ae${n.image.startsWith("/")?n.image:`/${n.image}`}`,de(d),Y(d)}else de(null),Y(null)}catch(a){console.error("Fetch category error:",a),p(`Failed to load category: ${a.message}`,"error"),O(s=>({...s,open:!1}))}finally{O(a=>({...a,loading:!1}))}},K=()=>{O({open:!1,categoryId:null,loading:!1}),ie({name:"",description:"",parentCategory:"",module:"",displayOrder:0,isActive:!0,isFeatured:!1,metaTitle:"",metaDescription:""}),Se(null),Y(null),de(null),ne.current&&(ne.current.value="")},T=(t,r)=>{ie(a=>{const s={...a,[t]:r};return t==="module"&&(s.parentCategory=""),s})},qe=t=>{const r=t.target.files[0];if(!r)return;if(!r.type.startsWith("image/")){p("Please select a valid image file","error");return}Se(r);const a=new FileReader;a.onload=s=>Y(s.target.result),a.readAsDataURL(r)},Ke=async()=>{const t=D();if(t){if(!g.name.trim()){p("Please enter a category title","error");return}O(r=>({...r,loading:!0}));try{const r=new FormData;r.append("title",g.name.trim()),r.append("module",g.module),r.append("description",g.description),r.append("parentCategory",g.parentCategory||""),r.append("displayOrder",g.displayOrder),r.append("isActive",g.isActive),r.append("isFeatured",g.isFeatured),r.append("metaTitle",g.metaTitle),r.append("metaDescription",g.metaDescription),r.append("updatedBy",ce()),we&&r.append("image",we);const a=await fetch(`${z}/categories/${R.categoryId}`,{method:"PUT",headers:{Authorization:`Bearer ${t}`},body:r});if(!a.ok){const s=await a.json();throw new Error(s.error||"Failed to update category")}p("Category updated successfully!","success"),K(),F()}catch(r){console.error("Update error:",r),p(r.message,"error")}finally{O(r=>({...r,loading:!1}))}}},Xe=t=>Ye(t),Qe=t=>{const r=S.find(a=>a.id===t);G({open:!0,categoryId:t,categoryName:r?.names?.default||""})},Ze=async()=>{const t=D();if(!t){m("/login");return}k(!0);try{const r=await fetch(`${z}/categories/${J.categoryId}`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`}});if(!r.ok){const a=await r.text();let s={error:a};try{s=JSON.parse(a)}catch{}throw new Error(s.error||`HTTP ${r.status}`)}p(`Category "${J.categoryName}" deleted!`,"success"),G({open:!1,categoryId:null,categoryName:""}),F()}catch(r){p(`Delete failed: ${r.message}`,"error")}finally{k(!1)}},et=async t=>{const r=D();if(!r){m("/login");return}const a=S.find(d=>d.id===t);if(!a)return;const s=a.status?`/categories/${t}/block`:`/categories/${t}/reactivate`,n=a.status?"blocked":"reactivated";k(!0);try{const d=await fetch(`${z}${s}`,{method:"PATCH",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"},body:JSON.stringify({updatedBy:ce()})});if(!d.ok){const o=await d.text();let i={error:o};try{i=JSON.parse(o)}catch{}throw new Error(i.error||`HTTP ${d.status}`)}p(`Category "${a.names.default}" ${n}`,"info"),F()}catch(d){p(`Status change failed: ${d.message}`,"error")}finally{k(!1)}},p=(t,r="success")=>{be({open:!0,message:t,severity:r})},Ie=()=>be(t=>({...t,open:!1})),tt=()=>m("/login"),rt=()=>m("/dashboard"),Ae=()=>{ue(),F()},X=()=>y[f].key,B=S.filter(t=>{const r=X(),a=t.names[r].toLowerCase().includes(E.toLowerCase());if(H==="all")return a;const s=t.module?._id===H||t.parentCategory&&S.find(n=>n.id===t.parentCategory)?.module?._id===H;return a&&s}).sort((t,r)=>!t.parentCategory&&r.parentCategory?-1:t.parentCategory&&!r.parentCategory?1:0),at=t=>Ce(t.currentTarget),he=()=>Ce(null),st=()=>{const t=X(),r=["SI","ID",`Name (${t})`,"Module","Parent","Status"],a=B.map((i,W)=>{const ge=i.parentCategory&&S.find(pe=>pe.id===i.parentCategory)?.names.default||"—";return[W+1,i.id,i.names[t],i.module?.title||(i.parentCategory?"—":"N/A"),ge,i.status?"Active":"Inactive"]});let s=r.join(",")+`
`+a.map(i=>i.map(W=>`"${W}"`).join(",")).join(`
`);const n=new Blob([s],{type:"text/csv;charset=utf-8;"}),d=URL.createObjectURL(n),o=document.createElement("a");o.href=d,o.download=`categories_${t}_${new Date().toISOString().split("T")[0]}.csv`,o.click(),URL.revokeObjectURL(d),he(),p("CSV downloaded","success")},ot=()=>{const t=X(),r=["SI","ID",`Name (${t})`,"Module","Parent","Status"],a=B.map((i,W)=>{const ge=i.parentCategory&&S.find(pe=>pe.id===i.parentCategory)?.names.default||"—";return[W+1,i.id,i.names[t],i.module?.title||(i.parentCategory?"—":"N/A"),ge,i.status?"Active":"Inactive"]});let s=r.join("	")+`
`+a.map(i=>i.join("	")).join(`
`);const n=new Blob([s],{type:"application/vnd.ms-excel;charset=utf-8;"}),d=URL.createObjectURL(n),o=document.createElement("a");o.href=d,o.download=`categories_${t}_${new Date().toISOString().split("T")[0]}.xls`,o.click(),URL.revokeObjectURL(d),he(),p("Excel downloaded","success")};return x&&S.length===0&&P?e.jsx(c,{sx:{p:2,display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px"},children:e.jsxs(Q,{alignItems:"center",spacing:2,children:[e.jsx(U,{}),e.jsx(l,{children:"Loading categories and modules..."})]})}):e.jsxs(c,{sx:{width:"100%",minHeight:"100vh",backgroundColor:"#f5f5f5",p:{xs:2,sm:3}},children:[e.jsx(Te,{open:!!$||!!A,autoHideDuration:null,onClose:()=>{C(null),N(null)},children:e.jsx(We,{severity:"error",onClose:()=>{C(null),N(null)},action:e.jsxs(Q,{direction:"row",spacing:1,children:[($?.includes("not authenticated")||A?.includes("not authenticated"))&&e.jsx(j,{color:"inherit",size:"small",onClick:tt,children:"Login"}),($?.includes("Access denied")||A?.includes("Access denied"))&&e.jsx(j,{color:"inherit",size:"small",onClick:rt,children:"Dashboard"}),!($?.includes("not authenticated")||$?.includes("Access denied"))&&!(A?.includes("not authenticated")||A?.includes("Access denied"))&&e.jsx(j,{color:"inherit",size:"small",onClick:Ae,children:"Retry"})]}),children:$||A})}),e.jsx(c,{sx:{display:"flex",justifyContent:"center",mb:4},children:e.jsx(De,{sx:{width:"100%",maxWidth:"1400px",boxShadow:3,borderRadius:3},children:e.jsxs(Ee,{sx:{p:{xs:2,sm:4}},children:[e.jsxs(l,{variant:"subtitle1",sx:{mb:1,fontWeight:500},children:["Title (",y[f].label,") ",e.jsx("span",{style:{color:"#f44336"},children:"*"})]}),e.jsx(w,{fullWidth:!0,value:y[f].key==="default"?h.name:"",onChange:t=>y[f].key==="default"&&q("name",t.target.value),placeholder:`Enter title in ${y[f].label}`,variant:"outlined",disabled:y[f].key!=="default",sx:{mb:4,"& .MuiOutlinedInput-root":{direction:y[f].key==="arabic"?"rtl":"ltr"}}}),e.jsx(l,{variant:"subtitle1",sx:{mb:1,fontWeight:500},children:"Parent Category"}),e.jsxs(w,{select:!0,fullWidth:!0,value:h.parentCategory,onChange:t=>q("parentCategory",t.target.value),SelectProps:{displayEmpty:!0,renderValue:t=>t?S.find(a=>a.id===t)?.names.default||t:e.jsx("em",{children:"None"})},variant:"outlined",sx:{mb:4},children:[e.jsx(b,{value:"",children:e.jsx("em",{children:"None"})}),S.filter(t=>!t.parentCategory&&t.module?._id===h.module).map(t=>e.jsx(b,{value:t.id,children:t.names.default},t.id))]}),e.jsxs(l,{variant:"subtitle1",sx:{mb:1,fontWeight:500},children:["Module ",e.jsx("span",{style:{color:"#f44336"},children:"*"})]}),e.jsxs(w,{select:!0,fullWidth:!0,value:h.module,onChange:t=>{const r=t.target.value;q("module",r),q("parentCategory","")},variant:"outlined",disabled:P||!!A,sx:{mb:4},children:[P&&e.jsx(b,{value:"",children:"Loading..."}),A&&e.jsx(b,{value:"",children:"Error loading"}),M.length===0&&!P&&e.jsx(b,{value:"",children:"No modules"}),M.map(t=>e.jsx(b,{value:t._id,children:t.title||t.name||"Unnamed"},t._id))]}),e.jsxs(l,{variant:"subtitle1",sx:{mb:1,fontWeight:500},children:["Image ",e.jsx("span",{style:{color:"#f44336"},children:"*"})," ",e.jsx("span",{style:{color:"#e91e63",fontSize:"0.875rem"},children:"(Ratio 3:2)"})]}),e.jsxs(c,{sx:{display:"flex",gap:3,mb:4,flexDirection:{xs:"column",sm:"row"}},children:[e.jsxs(c,{children:[e.jsx("input",{id:"img-input",type:"file",accept:"image/*",onChange:Je,ref:_,style:{display:"none"}}),e.jsx("label",{htmlFor:"img-input",children:e.jsxs(j,{component:"span",variant:"outlined",sx:{width:{xs:"100%",sm:240},height:{xs:100,sm:140},border:"2px dashed #e0e0e0",borderRadius:2,display:"flex",flexDirection:"column",gap:1,color:"text.secondary",textTransform:"none","&:hover":{borderColor:"#2196f3",backgroundColor:"#e3f2fd",border:"2px dashed #2196f3"}},children:[e.jsx(Ue,{sx:{fontSize:40,color:"#bdbdbd"}}),e.jsx(l,{variant:"body2",color:"text.secondary",children:L?"Change Image":"Upload Image"})]})})]}),ye&&e.jsxs(c,{sx:{position:"relative"},children:[e.jsxs(c,{sx:{width:{xs:"100%",sm:240},height:{xs:160,sm:140},border:"2px solid #e0e0e0",borderRadius:2,overflow:"hidden"},children:[e.jsx("img",{src:ye,alt:"preview",style:{width:"100%",height:"100%",objectFit:"cover"}}),e.jsx(Z,{size:"small",onClick:()=>{re(null),te(null),_.current&&(_.current.value="")},sx:{position:"absolute",top:8,right:8,backgroundColor:"rgba(0,0,0,0.5)",color:"white","&:hover":{backgroundColor:"rgba(0,0,0,0.7)"}},children:e.jsx(Pe,{fontSize:"small"})})]}),e.jsx(l,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:L?.name})]})]}),e.jsxs(c,{sx:{display:"flex",flexWrap:"wrap",justifyContent:{xs:"center",sm:"flex-end"},gap:2},children:[e.jsx(j,{variant:"outlined",onClick:ke,disabled:x||P,sx:{px:4,py:1.5,textTransform:"none",borderColor:"#e0e0e0",color:"#666","&:hover":{borderColor:"#bdbdbd",backgroundColor:"#f5f5f5"}},children:"Reset"}),e.jsx(j,{variant:"contained",onClick:Ge,disabled:!h.name.trim()||!h.module||!/^[0-9a-fA-F]{24}$/.test(h.module)||!L||x||P,sx:{px:4,py:1.5,backgroundColor:"#00695c",textTransform:"none","&:hover":{backgroundColor:"#004d40"},"&:disabled":{backgroundColor:"#e0e0e0",color:"#999"}},children:x?e.jsx(U,{size:20,color:"inherit"}):"Add"})]})]})})}),e.jsx(c,{sx:{display:"flex",justifyContent:"center"},children:e.jsx(De,{sx:{width:"100%",maxWidth:"1400px",boxShadow:3,borderRadius:3},children:e.jsxs(Ee,{sx:{p:{xs:2,sm:3}},children:[e.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",flexWrap:"wrap",gap:2,mb:3},children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(l,{variant:"h6",fontWeight:600,children:"Category List"}),e.jsx($e,{label:B.length,size:"small",sx:{backgroundColor:"#e3f2fd",color:"#2196f3",fontWeight:600}}),e.jsx($e,{label:`Language: ${y[f].label}`,size:"small",sx:{backgroundColor:"#e8f5e8",color:"#2e7d32",fontWeight:500}})]}),e.jsxs(c,{sx:{display:"flex",flexWrap:"wrap",gap:2,alignItems:"center"},children:[e.jsxs(w,{select:!0,size:"small",value:H,onChange:t=>se(t.target.value),sx:{minWidth:{xs:"100%",sm:200}},disabled:x||P,children:[e.jsx(b,{value:"all",children:"All Modules"}),M.map(t=>e.jsx(b,{value:t._id,children:t.title||t.name||"Unnamed"},t._id))]}),e.jsx(w,{size:"small",placeholder:`Search in ${y[f].label}`,value:E,onChange:t=>Le(t.target.value),sx:{minWidth:{xs:"100%",sm:250,md:300},"& .MuiOutlinedInput-root":{direction:y[f].key==="arabic"?"rtl":"ltr"}},InputProps:{startAdornment:e.jsx(it,{position:"start",children:e.jsx(mt,{sx:{color:"#bdbdbd"}})})},disabled:x}),e.jsx(j,{variant:"outlined",startIcon:e.jsx(yt,{}),endIcon:e.jsx(ft,{}),onClick:at,sx:{textTransform:"none",borderColor:"#e0e0e0",color:"#2196f3","&:hover":{borderColor:"#2196f3",backgroundColor:"#e3f2fd"}},disabled:x||B.length===0,children:"Export"}),e.jsxs(lt,{anchorEl:ve,open:He,onClose:he,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},sx:{"& .MuiPaper-root":{minWidth:180,boxShadow:"0 4px 20px rgba(0,0,0,0.1)",borderRadius:2,mt:1}},children:[e.jsxs(b,{onClick:ot,sx:{py:1.5,px:2},children:[e.jsx(Re,{children:e.jsx(jt,{sx:{color:"#1976d2"}})}),e.jsx(Fe,{primary:"Export to Excel",primaryTypographyProps:{fontWeight:500}})]}),e.jsx(ze,{}),e.jsxs(b,{onClick:st,sx:{py:1.5,px:2},children:[e.jsx(Re,{children:e.jsx(bt,{sx:{color:"#2e7d32"}})}),e.jsx(Fe,{primary:"Export to CSV",primaryTypographyProps:{fontWeight:500}})]})]})]})]}),x&&S.length>0&&e.jsx(c,{display:"flex",justifyContent:"center",p:2,children:e.jsx(U,{size:24})}),e.jsx(dt,{component:ct,sx:{overflowX:"auto"},children:e.jsxs(ut,{size:"small",children:[e.jsx(ht,{sx:{backgroundColor:"#fafafa"},children:e.jsxs(xe,{children:[e.jsx(v,{sx:{fontWeight:600,color:"#666"},children:"SI"}),e.jsx(v,{sx:{fontWeight:600,color:"#666"},children:"Image"}),e.jsxs(v,{sx:{fontWeight:600,color:"#666",direction:y[f].key==="arabic"?"rtl":"ltr"},children:["Name (",y[f].label,")"]}),e.jsx(v,{sx:{fontWeight:600,color:"#666"},children:"Module"}),e.jsx(v,{sx:{fontWeight:600,color:"#666"},children:"Status"}),e.jsx(v,{sx:{fontWeight:600,color:"#666"},children:"Action"})]})}),e.jsx(gt,{children:B.length>0?B.map((t,r)=>{const a=X(),s=!!t.parentCategory;return e.jsxs(xe,{sx:{"&:hover":{backgroundColor:"#f9f9f9"},backgroundColor:s?"#fafafa":"inherit"},children:[e.jsx(v,{children:r+1}),e.jsx(v,{children:t.image?e.jsx(c,{sx:{width:50,height:35,borderRadius:1,overflow:"hidden",border:"1px solid #e0e0e0"},children:e.jsx("img",{src:t.image,alt:t.names[a],style:{width:"100%",height:"100%",objectFit:"cover"},onError:n=>{n.target.style.display="none",n.target.parentElement.innerHTML='<div style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:#f5f5f5;font-size:10px;color:#999;">Error</div>'}})}):e.jsx(c,{sx:{width:50,height:35,borderRadius:1,backgroundColor:"#f5f5f5",display:"flex",alignItems:"center",justifyContent:"center",border:"1px solid #e0e0e0"},children:e.jsx(l,{variant:"caption",color:"text.secondary",children:"No Image"})})}),e.jsx(v,{sx:{fontWeight:500,direction:y[f].key==="arabic"?"rtl":"ltr",pl:s?4:2},children:e.jsxs(l,{variant:"body2",sx:{wordBreak:"break-word"},children:[s&&e.jsx("span",{style:{opacity:.6,marginRight:4},children:"—"}),t.names[a]]})}),e.jsx(v,{children:e.jsx(l,{variant:"body2",children:t.module?t.module.title||"N/A":s?"—":"None"})}),e.jsx(v,{children:e.jsx(me,{checked:t.status,onChange:()=>et(t.id),sx:{"& .MuiSwitch-switchBase.Mui-checked":{color:"#2196f3"},"& .MuiSwitch-switchBase.Mui-checked + .MuiSwitch-track":{backgroundColor:"#2196f3"}},disabled:x})}),e.jsx(v,{children:e.jsxs(c,{sx:{display:"flex",gap:1},children:[e.jsx(Z,{size:"small",onClick:()=>Xe(t.id),sx:{color:"#2196f3"},disabled:x,children:e.jsx(pt,{fontSize:"small"})}),e.jsx(Z,{size:"small",onClick:()=>Qe(t.id),sx:{color:"#f44336"},disabled:x,children:e.jsx(xt,{fontSize:"small"})})]})})]},t.id)}):e.jsx(xe,{children:e.jsx(v,{colSpan:6,sx:{textAlign:"center",py:4,color:"#999"},children:e.jsxs(Q,{spacing:2,alignItems:"center",children:[e.jsx(l,{variant:"h6",color:"textSecondary",children:x?"Loading...":E?`No results for "${E}" in ${y[f].label}`:"No categories available."}),$||A?e.jsx(j,{variant:"outlined",onClick:Ae,children:"Retry"}):!x&&!E&&e.jsx(l,{variant:"body2",color:"textSecondary",children:"Create your first category using the form above"})]})})})})]})})]})})}),e.jsxs(Me,{open:R.open,onClose:K,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:3,boxShadow:"0 8px 32px rgba(0,0,0,0.1)"}},TransitionProps:{timeout:400},children:[e.jsxs(Ne,{sx:{m:0,p:2,display:"flex",alignItems:"center",justifyContent:"space-between",borderBottom:"1px solid #eee",bgcolor:"#fafafa"},children:[e.jsx(l,{variant:"h6",fontWeight:700,color:"primary",children:"Edit Category"}),e.jsx(Z,{onClick:K,sx:{color:"#999","&:hover":{color:"#f44336"}},children:e.jsx(Pe,{})})]}),e.jsx(Oe,{sx:{p:4},children:R.loading?e.jsxs(c,{sx:{display:"flex",flexDirection:"column",alignItems:"center",py:8,gap:2},children:[e.jsx(U,{size:48,thickness:4}),e.jsx(l,{variant:"body1",color:"textSecondary",fontWeight:500,children:"Fetching category details..."})]}):e.jsxs(Q,{spacing:4,sx:{mt:1},children:[e.jsxs(c,{children:[e.jsxs(l,{variant:"subtitle2",sx:{mb:2,color:"#666",fontWeight:600,display:"flex",alignItems:"center",gap:1},children:[e.jsx(c,{component:"span",sx:{width:4,height:16,bgcolor:"primary.main",borderRadius:1}}),"Basic Information"]}),e.jsxs(I,{container:!0,spacing:3,children:[e.jsxs(I,{item:!0,xs:12,children:[e.jsx(l,{variant:"body2",gutterBottom:!0,fontWeight:500,children:"Category Title *"}),e.jsx(w,{fullWidth:!0,value:g.name,onChange:t=>T("name",t.target.value),placeholder:"e.g. Premium Venues",size:"small",variant:"outlined"})]}),e.jsxs(I,{item:!0,xs:12,children:[e.jsx(l,{variant:"body2",gutterBottom:!0,fontWeight:500,children:"Description"}),e.jsx(w,{fullWidth:!0,multiline:!0,rows:3,value:g.description,onChange:t=>T("description",t.target.value),placeholder:"Provide a brief description of this category..."})]})]})]}),e.jsxs(c,{children:[e.jsxs(l,{variant:"subtitle2",sx:{mb:2,color:"#666",fontWeight:600,display:"flex",alignItems:"center",gap:1},children:[e.jsx(c,{component:"span",sx:{width:4,height:16,bgcolor:"primary.main",borderRadius:1}}),"Associations"]}),e.jsxs(I,{container:!0,spacing:3,children:[e.jsxs(I,{item:!0,xs:12,sm:6,children:[e.jsx(l,{variant:"body2",gutterBottom:!0,fontWeight:500,children:"Module *"}),e.jsx(w,{select:!0,fullWidth:!0,size:"small",value:g.module,onChange:t=>T("module",t.target.value),children:M.map(t=>e.jsx(b,{value:t._id,children:t.title||t.name},t._id))})]}),e.jsxs(I,{item:!0,xs:12,sm:6,children:[e.jsx(l,{variant:"body2",gutterBottom:!0,fontWeight:500,children:"Parent Category"}),e.jsxs(w,{select:!0,fullWidth:!0,size:"small",value:g.parentCategory,onChange:t=>T("parentCategory",t.target.value),children:[e.jsx(b,{value:"",children:e.jsx("em",{children:"None (Root Category)"})}),S.filter(t=>!t.parentCategory&&t.module?._id===g.module&&t.id!==R.categoryId).map(t=>e.jsx(b,{value:t.id,children:t.names.default},t.id))]})]})]})]}),e.jsxs(c,{children:[e.jsxs(l,{variant:"subtitle2",sx:{mb:2,color:"#666",fontWeight:600,display:"flex",alignItems:"center",gap:1},children:[e.jsx(c,{component:"span",sx:{width:4,height:16,bgcolor:"primary.main",borderRadius:1}}),"Media & Visuals"]}),e.jsxs(c,{sx:{display:"flex",gap:4,alignItems:"flex-start"},children:[e.jsx(c,{sx:{width:180,height:120,border:"1px solid #e0e0e0",borderRadius:2,overflow:"hidden",backgroundColor:"#f9f9f9",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"inset 0 2px 4px rgba(0,0,0,0.05)"},children:le?e.jsx("img",{src:le,alt:"Preview",style:{width:"100%",height:"100%",objectFit:"cover"}}):e.jsx(l,{variant:"caption",color:"textSecondary",children:"No Image Selected"})}),e.jsxs(c,{sx:{flex:1},children:[e.jsx("input",{type:"file",id:"edit-img-input",style:{display:"none"},accept:"image/*",onChange:qe,ref:ne}),e.jsx("label",{htmlFor:"edit-img-input",children:e.jsx(j,{component:"span",variant:"soft",size:"medium",startIcon:e.jsx(Ue,{}),sx:{textTransform:"none",bgcolor:"#e3f2fd",color:"#1976d2","&:hover":{bgcolor:"#bbdefb"}},children:le?"Replace Image":"Upload Image"})}),e.jsxs(l,{variant:"caption",display:"block",color:"textSecondary",sx:{mt:1.5,lineHeight:1.6},children:["Recommended: ",e.jsx("strong",{children:"600x400px"})," (3:2 ratio).",e.jsx("br",{}),"Max file size: 5MB. Supports JPG, PNG, WebP."]})]})]})]}),e.jsx(ze,{sx:{borderStyle:"dashed"}}),e.jsxs(c,{children:[e.jsxs(l,{variant:"subtitle2",sx:{mb:2,color:"#666",fontWeight:600,display:"flex",alignItems:"center",gap:1},children:[e.jsx(c,{component:"span",sx:{width:4,height:16,bgcolor:"primary.main",borderRadius:1}}),"Settings & SEO"]}),e.jsxs(I,{container:!0,spacing:3,children:[e.jsxs(I,{item:!0,xs:12,sm:4,children:[e.jsx(l,{variant:"body2",gutterBottom:!0,fontWeight:500,children:"Display Order"}),e.jsx(w,{fullWidth:!0,type:"number",size:"small",value:g.displayOrder,onChange:t=>T("displayOrder",t.target.value)})]}),e.jsxs(I,{item:!0,xs:12,sm:8,sx:{display:"flex",gap:6,alignItems:"center",height:"100%",pt:2.5},children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(l,{variant:"body2",fontWeight:500,children:"Active Status"}),e.jsx(me,{checked:g.isActive,onChange:t=>T("isActive",t.target.checked),size:"medium"})]}),e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(l,{variant:"body2",fontWeight:500,children:"Featured"}),e.jsx(me,{checked:g.isFeatured,onChange:t=>T("isFeatured",t.target.checked),color:"secondary",size:"medium"})]})]}),e.jsxs(I,{item:!0,xs:12,sm:6,children:[e.jsx(l,{variant:"body2",gutterBottom:!0,fontWeight:500,children:"Meta Title (SEO)"}),e.jsx(w,{fullWidth:!0,size:"small",value:g.metaTitle,onChange:t=>T("metaTitle",t.target.value),placeholder:"Title for search engines"})]}),e.jsxs(I,{item:!0,xs:12,sm:6,children:[e.jsx(l,{variant:"body2",gutterBottom:!0,fontWeight:500,children:"Meta Description (SEO)"}),e.jsx(w,{fullWidth:!0,size:"small",value:g.metaDescription,onChange:t=>T("metaDescription",t.target.value),placeholder:"Short summary for search results"})]})]})]})]})}),e.jsxs(Be,{sx:{p:3,borderTop:"1px solid #eee",bgcolor:"#fafafa"},children:[e.jsx(j,{onClick:K,variant:"outlined",sx:{textTransform:"none",px:4,borderRadius:2,borderColor:"#ddd",color:"#666"},disabled:R.loading,children:"Cancel"}),e.jsx(j,{onClick:Ke,variant:"contained",color:"primary",sx:{textTransform:"none",px:5,borderRadius:2,boxShadow:"0 4px 12px rgba(25, 118, 210, 0.2)",fontWeight:600},disabled:R.loading||!g.name.trim(),children:R.loading?e.jsx(U,{size:20,color:"inherit"}):"Save Changes"})]})]}),e.jsxs(Me,{open:J.open,onClose:()=>G({open:!1,categoryId:null,categoryName:""}),maxWidth:"sm",fullWidth:!0,children:[e.jsx(Ne,{sx:{fontWeight:600},children:"Confirm Delete"}),e.jsx(Oe,{children:e.jsxs(l,{children:['Are you sure you want to delete "',J.categoryName,'"? This cannot be undone.']})}),e.jsxs(Be,{sx:{p:3,gap:1},children:[e.jsx(j,{onClick:()=>G({open:!1,categoryId:null,categoryName:""}),variant:"outlined",sx:{textTransform:"none"},disabled:x,children:"Cancel"}),e.jsx(j,{onClick:Ze,variant:"contained",color:"error",sx:{textTransform:"none"},disabled:x,children:x?e.jsx(U,{size:20,color:"inherit"}):"Delete"})]})]}),e.jsx(Te,{open:oe.open,autoHideDuration:4e3,onClose:Ie,anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(We,{onClose:Ie,severity:oe.severity,variant:"filled",sx:{width:"100%"},children:oe.message})})]})}export{Dt as default};
