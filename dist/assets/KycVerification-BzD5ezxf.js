import{h as I,j as e,u as se,r as l,B as o,K as ie,S as d,T as s,d as p,G as m,k as _,q as oe,a4 as ne,a2 as y,g as $,N as re,Q as le,U as v,V as c,W as ce,C as L,y as R,c as k,_ as z,$ as q,a0 as Y,n as W,a1 as G,a6 as de,o as he}from"./index-D781LPqD.js";import{C as V}from"./CheckCircle-ChhpX31t.js";import{T as xe,P as O,C as pe,a as Q}from"./TrendingUp-C0Wg1K_F.js";import{V as ue}from"./Visibility-BzxIXKM3.js";import{S as me}from"./Search-QpPOBNxK.js";import{E as ge}from"./FileDownload-B_lnBiKu.js";import{C as fe}from"./Description-UmF_S9X5.js";import{u as T,w as je}from"./xlsx-eY9-kAPw.js";const be=I(e.jsx("path",{d:"M4 10h3v7H4zm6.5 0h3v7h-3zM2 19h20v3H2zm15-9h3v7h-3zm-5-9L2 6v2h20V6z"})),ye=I(e.jsx("path",{d:"M12 7V3H2v18h20V7zM6 19H4v-2h2zm0-4H4v-2h2zm0-4H4V9h2zm0-4H4V5h2zm4 12H8v-2h2zm0-4H8v-2h2zm0-4H8V9h2zm0-4H8V5h2zm10 12h-8v-2h2v-2h-2v-2h2v-2h-2V9h8zm-2-8h-2v2h2zm0 4h-2v2h2z"})),ve=I(e.jsx("path",{d:"M12 1 3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5zm-2 16-4-4 1.41-1.41L10 14.17l6.59-6.59L18 9z"})),J=I([e.jsx("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"},"0"),e.jsx("path",{d:"M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"},"1")]),Ae=()=>{const x=se(),[h,Z]=l.useState([]),[g,X]=l.useState(""),[ke,Ie]=l.useState("all"),[a,f]=l.useState({open:!1,data:null}),[j,u]=l.useState({open:!1,data:null,action:""}),[C,A]=l.useState(""),[ee,N]=l.useState(!1),[P,F]=l.useState(!1),[w,te]=l.useState(0),[H,b]=l.useState({open:!1,imageUrl:""}),U=()=>localStorage.getItem("token")||sessionStorage.getItem("token")||"";l.useEffect(()=>{M()},[]);const M=async()=>{N(!0);try{const i=await(await fetch("https://api.bookmyevent.ae/api/admin/kyc",{headers:{Authorization:`Bearer ${U()}`}})).json();if(i.success){const n=i.data.filter(r=>r.kycDetails?.status!=="not_submitted");Z(n)}}catch(t){console.error("Fetch KYC error:",t)}finally{N(!1)}},D=async(t,i)=>{F(!0);try{const r=await(await fetch("https://api.bookmyevent.ae/api/admin/kyc/status",{method:"PUT",headers:{Authorization:`Bearer ${U()}`,"Content-Type":"application/json"},body:JSON.stringify({userId:t,status:i,rejectionReason:i==="rejected"?C:""})})).json();r.success?(M(),u({open:!1,data:null,action:""}),f({open:!1,data:null}),A("")):alert(r.message||"Failed to update status")}catch(n){console.error("Update status error:",n),alert("Error updating status")}finally{F(!1)}},B=t=>{const i={pending:{label:"Pending",color:"warning",icon:e.jsx(O,{fontSize:"small"})},verified:{label:"Verified",color:"success",icon:e.jsx(V,{fontSize:"small"})},rejected:{label:"Rejected",color:"error",icon:e.jsx(Q,{fontSize:"small"})}},n=i[t]||i.pending;return e.jsx(he,{label:n.label,color:n.color,size:"small",icon:n.icon,sx:{fontWeight:600,px:1}})},E=l.useMemo(()=>h.filter(t=>{const i=`${t.userId?.firstName||""} ${t.userId?.lastName||""}`.toLowerCase(),n=(t.userId?.email||"").toLowerCase(),r=i.includes(g.toLowerCase())||n.includes(g.toLowerCase()),K=["all","pending","verified","rejected"][w],ae=K==="all"||t.kycDetails?.status===K;return r&&ae}),[h,g,w]),S=l.useMemo(()=>({total:h.length,pending:h.filter(t=>t.kycDetails?.status==="pending").length,verified:h.filter(t=>t.kycDetails?.status==="verified").length}),[h]);return e.jsxs(o,{sx:{p:{xs:2,md:4},background:"#f4f7fe",minHeight:"100vh"},children:[e.jsxs(ie,{elevation:0,sx:{p:4,mb:4,borderRadius:4,background:`linear-gradient(45deg, ${x.palette.primary.main}, ${x.palette.primary.dark})`,color:"white"},children:[e.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",flexWrap:"wrap",gap:2},children:[e.jsxs(o,{children:[e.jsxs(d,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(ve,{sx:{fontSize:32}}),e.jsx(s,{variant:"h4",fontWeight:800,letterSpacing:-.5,color:"white",children:"KYC Verification"})]}),e.jsx(s,{variant:"body1",sx:{opacity:.95,color:"white",mt:.5},children:"Review and approve vendor identity documents"})]}),e.jsx(p,{variant:"contained",startIcon:e.jsx(ge,{}),onClick:()=>{const t=h.map(r=>({Vendor:`${r.userId?.firstName} ${r.userId?.lastName}`,Email:r.userId?.email,Phone:r.userId?.phone,Status:r.kycDetails?.status,SubmittedAt:r.kycDetails?.submittedAt})),i=T.json_to_sheet(t),n=T.book_new();T.book_append_sheet(n,i,"KYC Requests"),je(n,"KYC_Verification_Report.xlsx")},sx:{bgcolor:"white",color:x.palette.primary.main,fontWeight:700,"&:hover":{bgcolor:"#f0f0f0"}},children:"Export Report"})]}),e.jsx(m,{container:!0,spacing:3,sx:{mt:3},children:[{label:"Total Requests",value:S.total,icon:e.jsx(xe,{}),color:"#2196f3"},{label:"Pending Verification",value:S.pending,icon:e.jsx(O,{}),color:"#ff9800"},{label:"Verified Vendors",value:S.verified,icon:e.jsx(V,{}),color:"#4caf50"}].map((t,i)=>e.jsx(m,{item:!0,xs:12,sm:4,children:e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:2,p:2,borderRadius:3,bgcolor:"rgba(255,255,255,0.2)",backdropFilter:"blur(10px)"},children:[e.jsx(_,{sx:{bgcolor:"white",color:t.color,width:56,height:56},children:t.icon}),e.jsxs(o,{children:[e.jsx(s,{variant:"caption",sx:{opacity:.95,color:"white",fontWeight:600},children:t.label}),e.jsx(s,{variant:"h5",fontWeight:700,color:"white",children:t.value})]})]})},i))})]}),e.jsxs(oe,{elevation:0,sx:{borderRadius:4,border:"1px solid",borderColor:"divider"},children:[e.jsx(o,{sx:{borderBottom:1,borderColor:"divider",px:2},children:e.jsxs(ne,{value:w,onChange:(t,i)=>te(i),sx:{"& .MuiTab-root":{fontWeight:600,py:2,color:"text.secondary","&.Mui-selected":{color:"primary.main"}}},children:[e.jsx(y,{label:"All Requests"}),e.jsx(y,{label:"Pending"}),e.jsx(y,{label:"Verified"}),e.jsx(y,{label:"Rejected"})]})}),e.jsx(o,{sx:{p:3,display:"flex",gap:2,flexWrap:"wrap",alignItems:"center",bgcolor:"#fafafa"},children:e.jsx($,{size:"small",placeholder:"Search vendor name or email...",value:g,onChange:t=>X(t.target.value),InputProps:{startAdornment:e.jsx(me,{sx:{mr:1,color:"text.secondary"}})},sx:{flexGrow:1,maxWidth:400,bgcolor:"white"}})}),e.jsxs(re,{children:[e.jsx(le,{sx:{bgcolor:"#f8f9fc"},children:e.jsxs(v,{children:[e.jsx(c,{sx:{fontWeight:700},children:"Vendor"}),e.jsx(c,{sx:{fontWeight:700},children:"Document Type"}),e.jsx(c,{sx:{fontWeight:700},children:"Submitted On"}),e.jsx(c,{sx:{fontWeight:700},children:"Status"}),e.jsx(c,{align:"right",sx:{fontWeight:700},children:"Actions"})]})}),e.jsx(ce,{children:ee?e.jsx(v,{children:e.jsx(c,{colSpan:5,align:"center",sx:{py:10},children:e.jsx(L,{})})}):E.length===0?e.jsx(v,{children:e.jsx(c,{colSpan:5,align:"center",sx:{py:10},children:e.jsx(s,{color:"text.secondary",variant:"h6",children:"No KYC requests found"})})}):E.map(t=>e.jsxs(v,{hover:!0,children:[e.jsx(c,{children:e.jsxs(d,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(_,{src:t.profilePhoto||"",sx:{width:45,height:45,bgcolor:"primary.light",color:"primary.main",fontWeight:700},children:t.userId?.firstName?t.userId.firstName[0]:"V"}),e.jsxs(o,{children:[e.jsxs(s,{variant:"body2",fontWeight:700,children:[t.userId?.firstName," ",t.userId?.lastName]}),e.jsx(s,{variant:"caption",color:"text.secondary",children:t.userId?.email})]})]})}),e.jsx(c,{children:e.jsx(s,{variant:"body2",children:t.kycDetails?.documentInfo?.documentType||"N/A"})}),e.jsx(c,{children:e.jsxs(d,{direction:"row",spacing:1,alignItems:"center",color:"text.secondary",children:[e.jsx(pe,{sx:{fontSize:14}}),e.jsx(s,{variant:"caption",children:t.kycDetails?.submittedAt?new Date(t.kycDetails.submittedAt).toLocaleDateString():"N/A"})]})}),e.jsx(c,{children:B(t.kycDetails?.status)}),e.jsx(c,{align:"right",children:e.jsxs(d,{direction:"row",spacing:1,justifyContent:"flex-end",children:[e.jsx(R,{title:"View Details",children:e.jsx(k,{onClick:()=>f({open:!0,data:t}),size:"small",color:"primary",children:e.jsx(ue,{fontSize:"small"})})}),t.kycDetails?.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx(R,{title:"Verify",children:e.jsx(k,{color:"success",size:"small",onClick:()=>D(t.userId?._id,"verified"),children:e.jsx(V,{fontSize:"small"})})}),e.jsx(R,{title:"Reject",children:e.jsx(k,{color:"error",size:"small",onClick:()=>u({open:!0,data:t,action:"reject"}),children:e.jsx(Q,{fontSize:"small"})})})]})]})})]},t._id))})]})]}),e.jsxs(z,{open:a.open,onClose:()=>f({open:!1}),fullWidth:!0,maxWidth:"md",PaperProps:{sx:{borderRadius:4}},children:[e.jsxs(q,{sx:{fontWeight:800,px:3,pt:3},children:["KYC Application Details",e.jsx(s,{variant:"body2",color:"text.secondary",children:"Review vendor documents and information for verification"})]}),e.jsx(Y,{sx:{px:3},children:a.data&&e.jsxs(m,{container:!0,spacing:3,sx:{mt:.5},children:[e.jsx(m,{item:!0,xs:12,md:5,children:e.jsxs(d,{spacing:3,children:[e.jsxs(o,{sx:{p:2,borderRadius:3,border:"1px solid #eee",bgcolor:"#fafafa"},children:[e.jsxs(d,{direction:"row",spacing:1,alignItems:"center",mb:1,children:[e.jsx(ye,{color:"primary",fontSize:"small"}),e.jsx(s,{variant:"subtitle2",fontWeight:700,children:"Personal Info"})]}),e.jsxs(s,{variant:"body2",children:[e.jsx("strong",{children:"Full Name:"})," ",a.data.kycDetails?.personalInfo?.fullName]}),e.jsxs(s,{variant:"body2",children:[e.jsx("strong",{children:"Email:"})," ",a.data.kycDetails?.personalInfo?.email]}),e.jsxs(s,{variant:"body2",children:[e.jsx("strong",{children:"Address:"})," ",a.data.kycDetails?.personalInfo?.address]})]}),e.jsxs(o,{sx:{p:2,borderRadius:3,border:"1px solid #eee",bgcolor:"#f8f9fe"},children:[e.jsxs(d,{direction:"row",spacing:1,alignItems:"center",mb:1,children:[e.jsx(be,{color:"primary",fontSize:"small"}),e.jsx(s,{variant:"subtitle2",fontWeight:700,children:"Bank Details"})]}),e.jsxs(s,{variant:"body2",children:[e.jsx("strong",{children:"Holder:"})," ",a.data.kycDetails?.bankDetails?.accountHolder]}),e.jsxs(s,{variant:"body2",children:[e.jsx("strong",{children:"Account:"})," ",a.data.kycDetails?.bankDetails?.accountNumber]}),e.jsxs(s,{variant:"body2",children:[e.jsx("strong",{children:"IFSC:"})," ",a.data.kycDetails?.bankDetails?.ifsc]}),e.jsxs(s,{variant:"body2",children:[e.jsx("strong",{children:"Bank:"})," ",a.data.kycDetails?.bankDetails?.bankName]})]}),e.jsxs(o,{sx:{p:2,borderRadius:3,bgcolor:a.data.kycDetails?.status==="verified"?W(x.palette.success.main,.1):a.data.kycDetails?.status==="rejected"?W(x.palette.error.main,.1):W(x.palette.warning.main,.1),border:"1px solid",borderColor:a.data.kycDetails?.status==="verified"?"success.main":a.data.kycDetails?.status==="rejected"?"error.main":"warning.main"},children:[e.jsx(s,{variant:"caption",fontWeight:700,display:"block",children:"CURRENT STATUS"}),e.jsxs(d,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[B(a.data.kycDetails?.status),a.data.kycDetails?.status==="rejected"&&e.jsxs(s,{variant:"caption",color:"error",fontWeight:600,children:["Reason: ",a.data.kycDetails?.rejectionReason]})]})]})]})}),e.jsx(m,{item:!0,xs:12,md:7,children:e.jsxs(d,{spacing:2,children:[e.jsxs(d,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(fe,{color:"primary",fontSize:"small"}),e.jsx(s,{variant:"subtitle2",fontWeight:700,children:"Verification Documents"})]}),e.jsx(s,{variant:"caption",fontWeight:600,children:"FRONT IMAGE"}),e.jsx(o,{onClick:()=>a.data.kycDetails?.documentInfo?.frontImage&&b({open:!0,imageUrl:`https://api.bookmyevent.ae${a.data.kycDetails.documentInfo.frontImage}`}),sx:{width:"100%",height:200,borderRadius:3,overflow:"hidden",border:"1px solid #eee",display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"#f0f0f0",position:"relative",cursor:a.data.kycDetails?.documentInfo?.frontImage?"pointer":"default","&:hover .image-overlay":{opacity:1}},children:a.data.kycDetails?.documentInfo?.frontImage?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:`https://api.bookmyevent.ae${a.data.kycDetails.documentInfo.frontImage}`,alt:"Front",style:{width:"100%",height:"100%",objectFit:"contain"}}),e.jsxs(o,{className:"image-overlay",sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%",bgcolor:"rgba(0,0,0,0.4)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",color:"white",opacity:0,transition:"opacity 0.2s ease-in-out",gap:1},children:[e.jsx(J,{}),e.jsx(s,{variant:"caption",fontWeight:600,children:"Click to view full image"})]})]}):e.jsx(s,{variant:"caption",children:"No Image Uploaded"})}),e.jsx(s,{variant:"caption",fontWeight:600,children:"BACK IMAGE"}),e.jsx(o,{onClick:()=>a.data.kycDetails?.documentInfo?.backImage&&b({open:!0,imageUrl:`https://api.bookmyevent.ae${a.data.kycDetails.documentInfo.backImage}`}),sx:{width:"100%",height:200,borderRadius:3,overflow:"hidden",border:"1px solid #eee",display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"#f0f0f0",position:"relative",cursor:a.data.kycDetails?.documentInfo?.backImage?"pointer":"default","&:hover .image-overlay":{opacity:1}},children:a.data.kycDetails?.documentInfo?.backImage?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:`https://api.bookmyevent.ae${a.data.kycDetails.documentInfo.backImage}`,alt:"Back",style:{width:"100%",height:"100%",objectFit:"contain"}}),e.jsxs(o,{className:"image-overlay",sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%",bgcolor:"rgba(0,0,0,0.4)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",color:"white",opacity:0,transition:"opacity 0.2s ease-in-out",gap:1},children:[e.jsx(J,{}),e.jsx(s,{variant:"caption",fontWeight:600,children:"Click to view full image"})]})]}):e.jsx(s,{variant:"caption",children:"No Image Uploaded"})})]})})]})}),e.jsxs(G,{sx:{p:3},children:[e.jsx(p,{onClick:()=>f({open:!1}),variant:"outlined",sx:{borderRadius:2},children:"Close"}),a.data?.kycDetails?.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx(p,{color:"error",variant:"contained",onClick:()=>u({open:!0,data:a.data,action:"reject"}),sx:{borderRadius:2,color:"white"},children:"Reject"}),e.jsx(p,{color:"success",variant:"contained",onClick:()=>D(a.data.userId?._id,"verified"),sx:{borderRadius:2,color:"white"},children:"Approve KYC"})]})]})]}),e.jsxs(z,{open:j.open&&j.action==="reject",onClose:()=>u({open:!1,data:null,action:""}),fullWidth:!0,maxWidth:"xs",PaperProps:{sx:{borderRadius:4}},children:[e.jsx(q,{children:"Reject KYC Request"}),e.jsxs(Y,{children:[e.jsxs(s,{variant:"body2",sx:{mb:2},children:["Please provide a reason for rejecting the KYC submission for ",e.jsx("strong",{children:j.data?.kycDetails?.personalInfo?.fullName}),"."]}),e.jsx($,{fullWidth:!0,multiline:!0,rows:3,label:"Rejection Reason",placeholder:"e.g. Documents are blurry or invalid",value:C,onChange:t=>A(t.target.value)})]}),e.jsxs(G,{sx:{p:3},children:[e.jsx(p,{onClick:()=>u({open:!1,data:null,action:""}),children:"Cancel"}),e.jsx(p,{color:"error",variant:"contained",disabled:!C||P,onClick:()=>D(j.data.userId?._id,"rejected"),sx:{borderRadius:2,color:"white"},children:P?e.jsx(L,{size:24}):"Confirm Rejection"})]})]}),e.jsxs(z,{open:H.open,onClose:()=>b({open:!1,imageUrl:""}),maxWidth:"lg",PaperProps:{sx:{bgcolor:"transparent",boxShadow:"none",overflow:"hidden",position:"relative"}},children:[e.jsx(k,{onClick:()=>b({open:!1,imageUrl:""}),sx:{position:"absolute",right:16,top:16,color:"white",bgcolor:"rgba(0,0,0,0.5)","&:hover":{bgcolor:"rgba(0,0,0,0.7)"},zIndex:1},children:e.jsx(de,{})}),e.jsx(o,{component:"img",src:H.imageUrl,alt:"Full View",sx:{maxWidth:"100%",maxHeight:"90vh",objectFit:"contain",borderRadius:2,bgcolor:"white"}})]})]})};export{Ae as default};
