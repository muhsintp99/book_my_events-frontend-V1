import{a5 as K,a as Q,r as o,j as e,B as a,T as n,C as L,g as c,d as b,H as X,M as R,Z as ee,A as te}from"./index-D781LPqD.js";import{C as z}from"./CloudUpload-DIPcQBXH.js";function se(){const _=K(),y=Q(),{provider:t}=_.state||{},[r,j]=o.useState({storeName:"",storeAddress:"",minimumDeliveryTime:"",maximumDeliveryTime:"",zone:"",latitude:"",longitude:"",ownerFirstName:"",ownerLastName:"",ownerPhone:"",ownerEmail:"",businessTIN:"",tinExpireDate:""}),[N,I]=o.useState(null),[C,E]=o.useState(null),[m,S]=o.useState(null),[w,A]=o.useState({logo:null,coverImage:null,tinCertificate:null}),[W,k]=o.useState([]),[T,D]=o.useState(""),[$,h]=o.useState(!1),[B,p]=o.useState(""),[M,g]=o.useState("success"),[f,Z]=o.useState(!1),[H,U]=o.useState(!0),P="https://api.bookmyevent.ae/api";o.useEffect(()=>{if(!t||!t.id){p("No valid provider data provided. Redirecting to providers list..."),g("error"),h(!0),setTimeout(()=>y("/providers"),2e3);return}j({storeName:t.storeName||"",storeAddress:t.storeAddress||"",minimumDeliveryTime:t.minimumDeliveryTime||"",maximumDeliveryTime:t.maximumDeliveryTime||"",zone:t.zoneId||"",latitude:t.latitude||"",longitude:t.longitude||"",ownerFirstName:t.ownerFirstName||"",ownerLastName:t.ownerLastName||"",ownerPhone:t.ownerPhone||"",ownerEmail:t.ownerEmail||"",businessTIN:t.businessTIN||"",tinExpireDate:t.tinExpireDate||""}),D(t.zoneId||""),I(t.logo||null),E(t.coverImage||null),S(t.tinCertificate||null)},[t,y]);const O=async()=>{try{U(!0);const i=await fetch(`${P}/zones`);if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);const s=await i.json();if(s.success)k(s.data.zones||s.data||[]);else throw new Error(s.message||"Failed to fetch zones")}catch(i){console.error("Error fetching zones:",i),p(`Error fetching zones: ${i.message}`),g("error"),h(!0),k([{_id:"1",name:"Downtown Zone"},{_id:"2",name:"North Zone"},{_id:"3",name:"South Zone"},{_id:"4",name:"East Zone"},{_id:"5",name:"West Zone"},{_id:"6",name:"Airport Zone"},{_id:"7",name:"Industrial Zone"}])}finally{U(!1)}};o.useEffect(()=>{O()},[]);const F=(i,s)=>{const d=i.target.files[0];if(d){A({...w,[s]:d});const x=new FileReader;x.onload=v=>{switch(s){case"logo":I(v.target.result);break;case"coverImage":E(v.target.result);break;case"tin":S({name:d.name,size:(d.size/1024/1024).toFixed(2)+" MB",type:d.type});break}},x.readAsDataURL(d)}},V=i=>{const s=i.target.value;D(s),j({...r,zone:s})},l=i=>s=>{j({...r,[i]:s.target.value})},Y=()=>{const i=[];return r.storeName.trim()||i.push("Store name is required"),r.storeAddress.trim()||i.push("Store address is required"),r.businessTIN.trim()||i.push("Business TIN is required"),r.tinExpireDate||i.push("TIN expire date is required"),r.zone||i.push("Zone selection is required"),r.ownerEmail&&!/\S+@\S+\.\S+/.test(r.ownerEmail)&&i.push("Valid email is required"),r.latitude&&isNaN(parseFloat(r.latitude))&&i.push("Valid latitude is required"),r.longitude&&isNaN(parseFloat(r.longitude))&&i.push("Valid longitude is required"),i},G=async()=>{const i=Y();if(i.length>0){p(i.join(", ")),g("error"),h(!0);return}try{Z(!0);const s=new FormData;Object.keys(r).forEach(u=>{r[u]!==""&&r[u]!==null&&r[u]!==void 0&&s.append(u,r[u])}),Object.keys(w).forEach(u=>{w[u]&&s.append(u,w[u])});const d=localStorage.getItem("token");console.log("Updating provider with ID:",t.id),console.log("API URL:",`${P}/providers/${t.id}`),console.log("Form Data:",Object.fromEntries(s));const x=await fetch(`${P}/providers/${t.id}`,{method:"PUT",body:s,credentials:"include",headers:{Authorization:d?`Bearer ${d}`:""}});if(!x.ok)throw new Error(`HTTP error! status: ${x.status}`);const v=await x.json();if(v.success)p("Store updated successfully!"),g("success"),h(!0),setTimeout(()=>y("/providers",{state:{updatedProvider:{...r,id:t.id}}}),2e3);else throw new Error(v.message||"Failed to update store")}catch(s){console.error("Error updating store:",s);let d=s.message;s.message.includes("Failed to fetch")&&(d="Unable to connect to the server. Please check if the server is running or if the API URL is correct."),p(`Error updating store: ${d}`),g("error"),h(!0)}finally{Z(!1)}},J=()=>{j({storeName:t?.storeName||"",storeAddress:t?.storeAddress||"",minimumDeliveryTime:t?.minimumDeliveryTime||"",maximumDeliveryTime:t?.maximumDeliveryTime||"",zone:t?.zoneId||"",latitude:t?.latitude||"",longitude:t?.longitude||"",ownerFirstName:t?.ownerFirstName||"",ownerLastName:t?.ownerLastName||"",ownerPhone:t?.ownerPhone||"",ownerEmail:t?.ownerEmail||"",businessTIN:t?.businessTIN||"",tinExpireDate:t?.tinExpireDate||""}),D(t?.zoneId||""),I(t?.logo||null),E(t?.coverImage||null),S(t?.tinCertificate||null),A({logo:null,coverImage:null,tinCertificate:null})},q=()=>{h(!1)};return e.jsxs(a,{sx:{p:3,backgroundColor:"white",width:"100%"},children:[e.jsx(a,{sx:{display:"flex",alignItems:"center",mb:2},children:e.jsx(n,{variant:"h4",fontWeight:"bold",children:"Edit Store"})}),f&&e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(L,{size:20}),e.jsx(n,{children:"Updating store..."})]}),e.jsx(n,{variant:"subtitle2",color:"textSecondary",sx:{mb:2},children:"Default English(EN)"}),e.jsx(c,{fullWidth:!0,label:"Name (Default)",variant:"outlined",placeholder:"Store name",value:r.storeName,onChange:l("storeName"),sx:{mb:2},required:!0}),e.jsx(c,{fullWidth:!0,label:"Address (Default)",variant:"outlined",placeholder:"Store address",multiline:!0,rows:4,value:r.storeAddress,onChange:l("storeAddress"),sx:{mb:2},required:!0}),e.jsxs(a,{sx:{mt:3},children:[e.jsx(n,{variant:"h4",sx:{mb:2,fontWeight:"bold"},children:"Store Logo & Covers"}),e.jsxs(a,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(a,{sx:{border:"1px dashed grey",p:2,textAlign:"center"},children:[e.jsx(n,{variant:"caption",children:"Logo (1:1)"}),N&&e.jsxs(a,{sx:{mt:2,mb:2},children:[e.jsx("img",{src:N,alt:"Logo Preview",style:{maxWidth:"150px",maxHeight:"150px",objectFit:"cover",borderRadius:"8px"}}),e.jsx(n,{variant:"caption",display:"block",sx:{mt:1},children:"Logo Preview"})]}),e.jsxs(b,{variant:"outlined",component:"label",startIcon:e.jsx(z,{}),sx:{mt:1},children:[N?"Change Image":"Upload Image",e.jsx("input",{type:"file",hidden:!0,accept:"image/*",onChange:i=>F(i,"logo")})]})]}),e.jsxs(a,{sx:{border:"1px dashed grey",p:2,textAlign:"center"},children:[e.jsx(n,{variant:"caption",children:"Store Cover (2:1)"}),C&&e.jsxs(a,{sx:{mt:2,mb:2},children:[e.jsx("img",{src:C,alt:"Cover Preview",style:{maxWidth:"300px",maxHeight:"150px",objectFit:"cover",borderRadius:"8px"}}),e.jsx(n,{variant:"caption",display:"block",sx:{mt:1},children:"Cover Preview"})]}),e.jsxs(b,{variant:"outlined",component:"label",startIcon:e.jsx(z,{}),sx:{mt:1},children:[C?"Change Image":"Upload Image",e.jsx("input",{type:"file",hidden:!0,accept:"image/*",onChange:i=>F(i,"coverImage")})]})]})]})]}),e.jsxs(a,{sx:{mt:3},children:[e.jsx(n,{variant:"h4",fontWeight:"bold",sx:{mb:2},children:"Store Information"}),H?e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(L,{size:20}),e.jsx(n,{children:"Loading zones..."})]}):e.jsxs(X,{fullWidth:!0,variant:"outlined",displayEmpty:!0,value:T,onChange:V,sx:{mb:2},required:!0,children:[e.jsx(R,{value:"",disabled:!0,children:"Select zone *"}),W.map(i=>e.jsx(R,{value:i._id||i.id,children:i.name},i._id||i.id))]}),T&&e.jsx(a,{sx:{mb:2,p:2,backgroundColor:"#f5f5f5",borderRadius:1},children:e.jsxs(n,{variant:"body2",color:"primary",children:["Selected Zone: ",W.find(i=>i._id===T)?.name||"N/A"]})}),e.jsx(c,{fullWidth:!0,label:"Latitude",variant:"outlined",placeholder:"Ex: -94.22213",value:r.latitude,onChange:l("latitude"),sx:{mb:2},type:"number",inputProps:{step:"any"}}),e.jsx(c,{fullWidth:!0,label:"Longitude",variant:"outlined",placeholder:"Ex: 103.344322",value:r.longitude,onChange:l("longitude"),sx:{mb:2},type:"number",inputProps:{step:"any"}})]}),e.jsxs(a,{sx:{mt:3},children:[e.jsx(n,{variant:"h4",fontWeight:"bold",sx:{mb:2},children:"Owner Information"}),e.jsxs(a,{sx:{display:"flex",gap:2,mb:2,flexDirection:{xs:"column",sm:"row"}},children:[e.jsx(c,{fullWidth:!0,label:"First name",variant:"outlined",placeholder:"First name",value:r.ownerFirstName,onChange:l("ownerFirstName")}),e.jsx(c,{fullWidth:!0,label:"Last name",variant:"outlined",placeholder:"Last name",value:r.ownerLastName,onChange:l("ownerLastName")}),e.jsx(c,{fullWidth:!0,label:"Phone",variant:"outlined",placeholder:"+1",value:r.ownerPhone,onChange:l("ownerPhone")})]})]}),e.jsxs(a,{sx:{mt:3},children:[e.jsx(n,{variant:"h4",fontWeight:"bold",sx:{mb:2},children:"Account Information"}),e.jsxs(a,{sx:{display:"flex",gap:2,mb:2,flexDirection:{xs:"column",sm:"row"}},children:[e.jsx(c,{fullWidth:!0,label:"Email",variant:"outlined",placeholder:"Ex: ex@example.com",value:r.ownerEmail,onChange:l("ownerEmail"),type:"email"}),e.jsx(c,{fullWidth:!0,label:"Password",variant:"outlined",placeholder:"Leave blank to keep unchanged",type:"password",onChange:l("password")}),e.jsx(c,{fullWidth:!0,label:"Confirm password",variant:"outlined",placeholder:"Leave blank to keep unchanged",type:"password",onChange:l("confirmPassword")})]})]}),e.jsxs(a,{sx:{mt:3},children:[e.jsx(n,{variant:"h4",fontWeight:"bold",sx:{mb:2},children:"Business TIN"}),e.jsx(c,{fullWidth:!0,label:"Taxpayer Identification Number (TIN) *",variant:"outlined",placeholder:"Type Your Taxpayer Identification Number (TIN)",value:r.businessTIN,onChange:l("businessTIN"),sx:{mb:2},required:!0}),e.jsx(c,{fullWidth:!0,label:"Expire Date *",variant:"outlined",placeholder:"yyyy-mm-dd",value:r.tinExpireDate,onChange:l("tinExpireDate"),type:"date",sx:{mb:2},InputLabelProps:{shrink:!0},required:!0}),e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(n,{variant:"h4",children:"TIN Certificate"}),e.jsx(n,{variant:"caption",color:"textSecondary",children:"Pdf, doc, jpg. File size: max 2 MB"})]}),e.jsxs(a,{sx:{border:"1px dashed grey",p:2,textAlign:"center",mb:2},children:[m&&e.jsxs(a,{sx:{mb:2,p:2,backgroundColor:"#f5f5f5",borderRadius:1},children:[e.jsxs(n,{variant:"body2",fontWeight:"bold",children:["Selected File: ",m.name||"Existing File"]}),m.size&&e.jsxs(n,{variant:"caption",color:"textSecondary",children:["Size: ",m.size," | Type: ",m.type]})]}),e.jsxs(b,{variant:"outlined",component:"label",startIcon:e.jsx(z,{}),sx:{mt:1},children:[m?"Change File":"Select a file or Drag & Drop here",e.jsx("input",{type:"file",hidden:!0,accept:".pdf,.doc,.docx,.jpg,.jpeg,.png",onChange:i=>F(i,"tinCertificate")})]})]}),e.jsxs(a,{sx:{display:"flex",justifyContent:"flex-end",gap:2},children:[e.jsx(b,{variant:"outlined",onClick:J,disabled:f,children:"Reset"}),e.jsx(b,{variant:"contained",color:"primary",onClick:G,disabled:f,startIcon:f?e.jsx(L,{size:20}):null,children:f?"Updating...":"Update"})]})]}),e.jsx(ee,{open:$,autoHideDuration:4e3,onClose:q,anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(te,{onClose:q,severity:M,sx:{width:"100%"},children:B})})]})}export{se as default};
