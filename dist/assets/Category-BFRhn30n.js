import{r as g,a as lt,j as e,B as c,S as Y,C as _,T as d,Z as Ie,A as Ae,d as C,q as Te,m as Ee,a4 as dt,a2 as ct,g as S,M as I,_ as De,$ as We,c as Z,a6 as $e,a0 as Fe,G as A,D as Me,a3 as xe,a1 as Re,o as ze,b as ut,l as gt,a7 as Ne,a8 as Le,J as ht,K as mt,N as xt,Q as pt,U as pe,V as k,W as ft,X as yt,Y as bt}from"./index-Bht4W_XB.js";import{C as Be}from"./CloudUpload-CFRu4ws6.js";import{S as jt}from"./Search-BKOf03pp.js";import{E as vt}from"./ExpandMore-CwoOqDO-.js";import{E as Ct}from"./FileDownload-dUyc0m2Q.js";import{E as wt}from"./TableView-6wH7uzfJ.js";import{C as kt}from"./Description-Bu4r0Py_.js";const N="https://api.bookmyevent.ae/api";function $t(){const[j,Oe]=g.useState(0),[L,Ue]=g.useState(""),[G,ee]=g.useState(null),[fe,te]=g.useState(null),[E,_e]=g.useState([]),[F,re]=g.useState(!0),[w,M]=g.useState(null),[ae,se]=g.useState("all"),[m,J]=g.useState({name:"",description:"",parentCategory:"",module:"",displayOrder:0,isActive:!0,isFeatured:!1,metaTitle:"",metaDescription:""}),[B,He]=g.useState([]),[y,P]=g.useState(!0),[T,b]=g.useState(null),[x,oe]=g.useState({currentPage:1,totalPages:1,totalItems:0,itemsPerPage:10}),[ne,ye]=g.useState({open:!1,message:"",severity:"success"}),[V,q]=g.useState({open:!1,categoryId:null,categoryName:""}),[be,je]=g.useState(null),Ye=!!be,f=lt(),H=g.useRef(null),ie=g.useRef(null),[R,O]=g.useState({open:!1,categoryId:null,loading:!1}),[p,le]=g.useState({name:"",description:"",parentCategory:"",module:"",displayOrder:0,isActive:!0,isFeatured:!1,metaTitle:"",metaDescription:""}),[ve,Ce]=g.useState(null),[de,K]=g.useState(null),[Pt,ce]=g.useState(null),v=[{key:"default",label:"Default"},{key:"english",label:"English(EN)"},{key:"arabic",label:"Arabic - العربية(AR)"}],$=()=>{const t=localStorage.getItem("token")||sessionStorage.getItem("token");return console.log("Retrieved token:",t?"Token exists":"No token found"),t},Ge=()=>{const t=localStorage.getItem("user")||sessionStorage.getItem("user");if(!t)return console.log("No user data found in storage"),null;try{const r=JSON.parse(t);return console.log("User role:",r.role),r.role}catch(r){return console.error("Error parsing user data:",r),null}},ue=()=>{const t=localStorage.getItem("user")||sessionStorage.getItem("user");if(!t)return null;try{return JSON.parse(t)._id}catch(r){return console.error("Error parsing user data:",r),null}},Je=(t,r)=>Oe(r),ge=g.useCallback(async()=>{const t=$();if(!t){M("You are not authenticated. Please log in."),re(!1);return}re(!0),M(null);try{const r=await fetch(`${N}/modules`,{headers:{Authorization:`Bearer ${t}`,Accept:"application/json"}});if(r.status===401){M("Session expired. Please log in again."),f("/login");return}if(!r.ok){const o=await r.text();throw new Error(`HTTP error! status: ${r.status}: ${o}`)}const a=await r.json();console.log("Fetched modules:",a);let s=[];Array.isArray(a)?s=a:Array.isArray(a.modules)?s=a.modules:a.data&&Array.isArray(a.data.modules)?s=a.data.modules:a.data&&Array.isArray(a.data)&&(s=a.data),_e(s);const n=window.location.pathname;let u=null;n.includes("/catering")?u=s.find(o=>(o.title||o.name||"").toLowerCase().includes("catering")):n.includes("/auditorium")&&(u=s.find(o=>(o.title||o.name||"").toLowerCase().includes("auditorium"))),u?(J(o=>({...o,module:u._id})),se(u._id)):s.length>0?(J(o=>({...o,module:s[0]._id})),se(s[0]._id)):M("No modules available. Please create a module first.")}catch(r){console.error("Error fetching modules:",r),M(r.message),h("Failed to fetch modules","error")}finally{re(!1)}},[f]),z=g.useCallback(async()=>{const t=$();if(!t){b("You are not authenticated. Please log in."),P(!1);return}P(!0),b(null);try{const r=`${N}/categories?page=${x.currentPage}&limit=${x.itemsPerPage}&search=${encodeURIComponent(L)}`,a=await fetch(r,{headers:{Authorization:`Bearer ${t}`,Accept:"application/json"}});if(a.status===401){b("Session expired. Please log in again."),f("/login");return}if(a.status===403){b("Access denied. You don't have permission to view categories."),f("/dashboard");return}if(!a.ok){const l=await a.text();throw new Error(`HTTP error! status: ${a.status}: ${l}`)}const s=await a.json();console.log("Fetched categories:",s);let n=[];Array.isArray(s)?n=s:Array.isArray(s.categories)?n=s.categories:s.data&&Array.isArray(s.data.categories)?n=s.data.categories:s.data&&Array.isArray(s.data)&&(n=s.data);const u=n.map(l=>{let i="";return l.image&&(l.image.startsWith("http://")||l.image.startsWith("https://")?i=l.image:l.image.startsWith("/uploads")||l.image.startsWith("uploads")?i=`https://api.bookmyevent.ae${l.image.startsWith("/")?l.image:`/${l.image}`}`:i=`https://api.bookmyevent.ae/${l.image}`),console.log("Category image processing:",{original:l.image,final:i}),{id:l._id,names:{default:l.title||l.name||"",english:l.title||l.name||"",arabic:l.title||l.name||""},status:l.isActive!==void 0?l.isActive:!0,image:i,module:l.module||null}});He(u);const o=s.pagination||s.data&&s.data.pagination||{currentPage:x.currentPage,totalPages:Math.ceil(n.length/x.itemsPerPage),totalItems:n.length,itemsPerPage:x.itemsPerPage};oe({currentPage:o.currentPage,totalPages:o.totalPages,totalItems:o.totalItems,itemsPerPage:o.itemsPerPage})}catch(r){console.error("Error fetching categories:",r),b(r.message),h(`Failed to fetch categories: ${r.message}`,"error")}finally{P(!1)}},[L,x.currentPage,x.itemsPerPage,f]);g.useEffect(()=>{const t=Ge(),r=$();if(console.log("Initial check - Token:",r?"Exists":"Missing","Role:",t),!r){console.log("No token found - showing error but staying on page"),b("You are not authenticated. Please log in."),P(!1);return}if(!["admin","manager","superadmin"].includes(t)){console.log("Insufficient permissions - showing error but staying on page"),b("Access denied. Admin, Manager, or Superadmin role required."),P(!1),f("/dashboard");return}ge(),z()},[ge,z,f]);const we=(t,r)=>{J(a=>({...a,[t]:r}))},Ve=t=>{const r=t.target.files[0];if(r){if(!r.type.startsWith("image/")){h("Please select a valid image file (JPEG, PNG, GIF, WebP, SVG)","error");return}if(r.size>5*1024*1024){h("File size should be less than 5MB","error");return}ee(r);const a=new FileReader;a.onload=s=>{te(s.target.result)},a.readAsDataURL(r)}},qe=async()=>{const t=$();if(!t){b("You are not authenticated. Please log in."),f("/login");return}if(!m.name.trim()){h("Please enter a category title in Default language","error");return}if(!m.module||!/^[0-9a-fA-F]{24}$/.test(m.module)){h("Please select a valid module","error");return}P(!0);try{const r=new FormData;r.append("title",m.name.trim()),r.append("module",m.module),m.description.trim()&&r.append("description",m.description.trim()),m.parentCategory.trim()&&r.append("parentCategory",m.parentCategory.trim()),r.append("displayOrder",m.displayOrder),r.append("isActive",m.isActive),r.append("isFeatured",m.isFeatured),m.metaTitle.trim()&&r.append("metaTitle",m.metaTitle.trim()),m.metaDescription.trim()&&r.append("metaDescription",m.metaDescription.trim()),r.append("createdBy",ue()),r.append("image",G),console.log("Sending FormData with module:",m.module);const a=await fetch(`${N}/categories`,{method:"POST",headers:{Authorization:`Bearer ${t}`},body:r});if(!a.ok){let u="Failed to add category";const o=a.status;try{const l=await a.text();let i;try{i=JSON.parse(l),u=i.error||u}catch{u=l||u}if(o===401){b("Session expired. Please log in again."),f("/login");return}if(o===403){b("Access denied. You don't have permission to create categories."),f("/dashboard");return}if(o===502&&(u="Server error: Unable to connect to the backend service. Please try again later."),i?.error&&i.error.includes("Unexpected file field")){h(`Image upload failed: ${i.error}. Please ensure the file is sent with the field name 'image'.`,"error");return}if(i?.error&&i.error.includes("title is required")){h("A title is required for the category.","error");return}if(i?.error&&i.error.includes("Module")){h(i.error,"error");return}}catch{u="Failed to parse server response. Please try again."}throw new Error(u)}const s=await a.json(),n=s.data?.category||s.category;h(`Category "${n.title||n.name}" added successfully!`,"success"),ke(),z()}catch(r){console.error("Error adding category:",r);let a=r.message||"Failed to add category due to a network or server error. Please try again.";r.message.includes("Failed to fetch")&&(a="Network error: Unable to reach the server. Please check your connection or try again later."),h(a,"error")}finally{P(!1)}},ke=()=>{J(t=>({...t,name:"",description:"",parentCategory:"",module:t.module||(E.length>0?E[0]._id:""),displayOrder:0,isActive:!0,isFeatured:!1,metaTitle:"",metaDescription:""})),ee(null),te(null),H.current&&(H.current.value="")},Ke=async t=>{const r=$();if(!r){f("/login");return}O(a=>({...a,open:!0,loading:!0,categoryId:t}));try{const a=await fetch(`${N}/categories/${t}`,{headers:{Authorization:`Bearer ${r}`}});if(!a.ok)throw new Error("Failed to fetch category details");const s=await a.json(),n=s.data||s;if(le({name:n.title||"",description:n.description||"",parentCategory:n.parentCategory?._id||n.parentCategory||"",module:n.module?._id||n.module||"",displayOrder:n.displayOrder||0,isActive:n.isActive!==void 0?n.isActive:!0,isFeatured:n.isFeatured!==void 0?n.isFeatured:!1,metaTitle:n.metaTitle||"",metaDescription:n.metaDescription||""}),n.image){let u="";n.image.startsWith("http")?u=n.image:u=`https://api.bookmyevent.ae${n.image.startsWith("/")?n.image:`/${n.image}`}`,ce(u),K(u)}else ce(null),K(null)}catch(a){console.error("Fetch category error:",a),h(`Failed to load category: ${a.message}`,"error"),O(s=>({...s,open:!1}))}finally{O(a=>({...a,loading:!1}))}},X=()=>{O({open:!1,categoryId:null,loading:!1}),le({name:"",description:"",parentCategory:"",module:"",displayOrder:0,isActive:!0,isFeatured:!1,metaTitle:"",metaDescription:""}),Ce(null),K(null),ce(null),ie.current&&(ie.current.value="")},D=(t,r)=>{le(a=>{const s={...a,[t]:r};return t==="module"&&(s.parentCategory=""),s})},Xe=t=>{const r=t.target.files[0];if(!r)return;if(!r.type.startsWith("image/")){h("Please select a valid image file","error");return}Ce(r);const a=new FileReader;a.onload=s=>K(s.target.result),a.readAsDataURL(r)},Qe=async()=>{const t=$();if(t){if(!p.name.trim()){h("Please enter a category title","error");return}O(r=>({...r,loading:!0}));try{const r=new FormData;r.append("title",p.name.trim()),r.append("module",p.module),r.append("description",p.description),r.append("parentCategory",p.parentCategory||""),r.append("displayOrder",p.displayOrder),r.append("isActive",p.isActive),r.append("isFeatured",p.isFeatured),r.append("metaTitle",p.metaTitle),r.append("metaDescription",p.metaDescription),r.append("updatedBy",ue()),ve&&r.append("image",ve);const a=await fetch(`${N}/categories/${R.categoryId}`,{method:"PUT",headers:{Authorization:`Bearer ${t}`},body:r});if(!a.ok){const s=await a.json();throw new Error(s.error||"Failed to update category")}h("Category updated successfully!","success"),X(),z()}catch(r){console.error("Update error:",r),h(r.message,"error")}finally{O(r=>({...r,loading:!1}))}}},Ze=t=>Ke(t),et=t=>{const r=B.find(a=>a.id===t);q({open:!0,categoryId:t,categoryName:r?.names?.default||""})},tt=async()=>{const t=$();if(!t){b("You are not authenticated. Please log in."),f("/login");return}P(!0);try{const r=await fetch(`${N}/categories/${V.categoryId}`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`}});if(!r.ok){const a=await r.text();let s;try{s=JSON.parse(a)}catch{s={error:a||"Unknown error"}}if(r.status===401){b("Session expired. Please log in again."),f("/login");return}if(r.status===403){b("Access denied. You don't have permission to delete categories."),f("/dashboard");return}throw new Error(s.error||`HTTP error! status: ${r.status}`)}h(`Category "${V.categoryName}" deleted successfully!`,"success"),q({open:!1,categoryId:null,categoryName:""}),z()}catch(r){console.error("Error deleting category:",r),h(`Failed to delete category: ${r.message}`,"error")}finally{P(!1)}},rt=async t=>{const r=$();if(!r){b("You are not authenticated. Please log in."),f("/login");return}const a=B.find(o=>o.id===t);if(!a){h("Category not found","error");return}const s=a.status,n=s?`/categories/${t}/block`:`/categories/${t}/reactivate`,u=s?"blocked":"reactivated";P(!0);try{const o=await fetch(`${N}${n}`,{method:"PATCH",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"},body:JSON.stringify({updatedBy:ue()})});if(!o.ok){const W=await o.text();let me;try{me=JSON.parse(W)}catch{me={error:W||"Unknown error"}}if(o.status===401){b("Session expired. Please log in again."),f("/login");return}if(o.status===403){b(`Access denied. You don't have permission to ${u} categories.`),f("/dashboard");return}throw new Error(me.error||`HTTP error! status: ${o.status}`)}const l=await o.json(),i=l.data?.category||l.category;h(`Category "${i.title||i.name}" ${u} successfully`,"info"),z()}catch(o){console.error(`Error ${u} category:`,o),h(`Failed to ${u} category: ${o.message}`,"error")}finally{P(!1)}},h=(t,r="success")=>{ye({open:!0,message:t,severity:r})},Pe=()=>{ye(t=>({...t,open:!1}))},at=()=>{f("/login")},st=()=>{f("/dashboard")},Se=()=>{ge(),z()},Q=()=>v[j].key,U=B.filter(t=>{const r=Q(),a=t.names[r].toLowerCase().includes(L.toLowerCase()),s=ae==="all"||t.module?._id===ae;return a&&s}),ot=t=>{je(t.currentTarget)},he=()=>{je(null)},nt=()=>{const t=Q(),a=["SI","ID",`Name (${v[j].label})`,"Module","Status"],s=U.map((i,W)=>[W+1+(x.currentPage-1)*x.itemsPerPage,i.id,i.names[t],i.module?i.module.title||"N/A":"None",i.status?"Active":"Inactive"]);let n=a.join(",")+`
`;s.forEach(i=>{n+=i.map(W=>`"${W}"`).join(",")+`
`});const u=new Blob([n],{type:"text/csv;charset=utf-8;"}),o=document.createElement("a"),l=URL.createObjectURL(u);o.setAttribute("href",l),o.setAttribute("download",`categories_${t}_${new Date().toISOString().split("T")[0]}.csv`),o.style.visibility="hidden",document.body.appendChild(o),o.click(),document.body.removeChild(o),he(),h("CSV file downloaded successfully!","success")},it=()=>{const t=Q(),a=["SI","ID",`Name (${v[j].label})`,"Module","Status"],s=U.map((i,W)=>[W+1+(x.currentPage-1)*x.itemsPerPage,i.id,i.names[t],i.module?i.module.title||"N/A":"None",i.status?"Active":"Inactive"]);let n=a.join("	")+`
`;s.forEach(i=>{n+=i.join("	")+`
`});const u=new Blob([n],{type:"application/vnd.ms-excel;charset=utf-8;"}),o=document.createElement("a"),l=URL.createObjectURL(u);o.setAttribute("href",l),o.setAttribute("download",`categories_${t}_${new Date().toISOString().split("T")[0]}.xls`),o.style.visibility="hidden",document.body.appendChild(o),o.click(),document.body.removeChild(o),he(),h("Excel file downloaded successfully!","success")};return y&&B.length===0&&F?e.jsx(c,{sx:{p:2,display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px"},children:e.jsxs(Y,{alignItems:"center",spacing:2,children:[e.jsx(_,{}),e.jsx(d,{children:"Loading categories and modules..."})]})}):e.jsxs(c,{sx:{width:"100%",minHeight:"100vh",backgroundColor:"#f5f5f5",p:{xs:2,sm:3}},children:[e.jsx(Ie,{open:!!T||!!w,autoHideDuration:null,onClose:()=>{b(null),M(null)},children:e.jsx(Ae,{severity:"error",onClose:()=>{b(null),M(null)},action:e.jsxs(Y,{direction:"row",spacing:1,children:[(T||w)&&(T?.includes("not authenticated")||w?.includes("not authenticated"))&&e.jsx(C,{color:"inherit",size:"small",onClick:at,children:"Go to Login"}),(T||w)&&(T?.includes("Access denied")||w?.includes("Access denied"))&&e.jsx(C,{color:"inherit",size:"small",onClick:st,children:"Go to Dashboard"}),(T||w)&&!(T?.includes("not authenticated")||w?.includes("not authenticated"))&&!(T?.includes("Access denied")||w?.includes("Access denied"))&&e.jsx(C,{color:"inherit",size:"small",onClick:Se,children:"Retry"})]}),children:T||w})}),e.jsx(c,{sx:{display:"flex",justifyContent:"center",mb:4},children:e.jsx(Te,{sx:{width:"100%",maxWidth:"1400px",boxShadow:3,borderRadius:3},children:e.jsxs(Ee,{sx:{p:{xs:2,sm:4}},children:[e.jsx(dt,{value:j,onChange:Je,variant:"scrollable",scrollButtons:"auto",sx:{mb:4,borderBottom:1,borderColor:"divider","& .MuiTabs-indicator":{backgroundColor:"#2196f3"}},children:v.map(t=>e.jsx(ct,{label:t.label},t.key))}),e.jsxs(d,{variant:"subtitle1",sx:{mb:1,fontWeight:500},children:["Title (",v[j].label,") ",e.jsx("span",{style:{color:"#f44336"},children:"*"})]}),e.jsx(S,{fullWidth:!0,value:v[j].key==="default"?m.name:"",onChange:t=>v[j].key==="default"&&we("name",t.target.value),placeholder:`Enter category title in ${v[j].label}`,variant:"outlined",disabled:v[j].key!=="default",sx:{mb:4,"& .MuiOutlinedInput-root":{direction:v[j].key==="arabic"?"rtl":"ltr"}}}),e.jsxs(d,{variant:"subtitle1",sx:{mb:1,fontWeight:500},children:["Module ",e.jsx("span",{style:{color:"#f44336"},children:"*"})]}),e.jsx(S,{select:!0,fullWidth:!0,value:m.module,onChange:t=>we("module",t.target.value),placeholder:"Select a module",variant:"outlined",disabled:F||w||E.length===0,sx:{mb:4,"& .MuiOutlinedInput-root":{backgroundColor:F||w||E.length===0?"#f5f5f5":"white"}},children:F?e.jsx(I,{value:"",children:"Loading modules..."}):w?e.jsx(I,{value:"",children:"Error loading modules"}):E.length===0?e.jsx(I,{value:"",children:"No modules available"}):E.map(t=>e.jsx(I,{value:t._id,children:t.title||t.name||"Unnamed Module"},t._id))}),e.jsxs(De,{open:R.open,onClose:X,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:3,boxShadow:"0 8px 32px rgba(0,0,0,0.1)"}},TransitionProps:{timeout:400},children:[e.jsxs(We,{sx:{m:0,p:2,display:"flex",alignItems:"center",justifyContent:"space-between",borderBottom:"1px solid #eee",bgcolor:"#fafafa"},children:[e.jsx(d,{variant:"h6",fontWeight:700,color:"primary",children:"Edit Category"}),e.jsx(Z,{onClick:X,sx:{color:"#999","&:hover":{color:"#f44336"}},children:e.jsx($e,{})})]}),e.jsx(Fe,{sx:{p:4},children:R.loading?e.jsxs(c,{sx:{display:"flex",flexDirection:"column",alignItems:"center",py:8,gap:2},children:[e.jsx(_,{size:48,thickness:4}),e.jsx(d,{variant:"body1",color:"textSecondary",fontWeight:500,children:"Fetching category details..."})]}):e.jsxs(Y,{spacing:4,sx:{mt:1},children:[e.jsxs(c,{children:[e.jsxs(d,{variant:"subtitle2",sx:{mb:2,color:"#666",fontWeight:600,display:"flex",alignItems:"center",gap:1},children:[e.jsx(c,{component:"span",sx:{width:4,height:16,bgcolor:"primary.main",borderRadius:1}}),"Basic Information"]}),e.jsxs(A,{container:!0,spacing:3,children:[e.jsxs(A,{item:!0,xs:12,children:[e.jsx(d,{variant:"body2",gutterBottom:!0,fontWeight:500,children:"Category Title *"}),e.jsx(S,{fullWidth:!0,value:p.name,onChange:t=>D("name",t.target.value),placeholder:"e.g. Premium Venues",size:"small",variant:"outlined"})]}),e.jsxs(A,{item:!0,xs:12,children:[e.jsx(d,{variant:"body2",gutterBottom:!0,fontWeight:500,children:"Description"}),e.jsx(S,{fullWidth:!0,multiline:!0,rows:3,value:p.description,onChange:t=>D("description",t.target.value),placeholder:"Provide a brief description of this category..."})]})]})]}),e.jsxs(c,{children:[e.jsxs(d,{variant:"subtitle2",sx:{mb:2,color:"#666",fontWeight:600,display:"flex",alignItems:"center",gap:1},children:[e.jsx(c,{component:"span",sx:{width:4,height:16,bgcolor:"primary.main",borderRadius:1}}),"Associations"]}),e.jsxs(A,{container:!0,spacing:3,children:[e.jsxs(A,{item:!0,xs:12,sm:6,children:[e.jsx(d,{variant:"body2",gutterBottom:!0,fontWeight:500,children:"Module *"}),e.jsx(S,{select:!0,fullWidth:!0,size:"small",value:p.module,onChange:t=>D("module",t.target.value),children:E.map(t=>e.jsx(I,{value:t._id,children:t.title||t.name},t._id))})]}),e.jsxs(A,{item:!0,xs:12,sm:6,children:[e.jsx(d,{variant:"body2",gutterBottom:!0,fontWeight:500,children:"Parent Category"}),e.jsxs(S,{select:!0,fullWidth:!0,size:"small",value:p.parentCategory,onChange:t=>D("parentCategory",t.target.value),children:[e.jsx(I,{value:"",children:e.jsx("em",{children:"None (Root Category)"})}),B.filter(t=>!t.parentCategory&&t.module?._id===p.module&&t.id!==R.categoryId).map(t=>e.jsx(I,{value:t.id,children:t.names.default},t.id))]})]})]})]}),e.jsxs(c,{children:[e.jsxs(d,{variant:"subtitle2",sx:{mb:2,color:"#666",fontWeight:600,display:"flex",alignItems:"center",gap:1},children:[e.jsx(c,{component:"span",sx:{width:4,height:16,bgcolor:"primary.main",borderRadius:1}}),"Media & Visuals"]}),e.jsxs(c,{sx:{display:"flex",gap:4,alignItems:"flex-start"},children:[e.jsx(c,{sx:{width:180,height:120,border:"1px solid #e0e0e0",borderRadius:2,overflow:"hidden",backgroundColor:"#f9f9f9",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"inset 0 2px 4px rgba(0,0,0,0.05)"},children:de?e.jsx("img",{src:de,alt:"Preview",style:{width:"100%",height:"100%",objectFit:"cover"}}):e.jsx(d,{variant:"caption",color:"textSecondary",children:"No Image Selected"})}),e.jsxs(c,{sx:{flex:1},children:[e.jsx("input",{type:"file",id:"edit-img-input",style:{display:"none"},accept:"image/*",onChange:Xe,ref:ie}),e.jsx("label",{htmlFor:"edit-img-input",children:e.jsx(C,{component:"span",variant:"soft",size:"medium",startIcon:e.jsx(Be,{}),sx:{textTransform:"none",bgcolor:"#e3f2fd",color:"#1976d2","&:hover":{bgcolor:"#bbdefb"}},children:de?"Replace Image":"Upload Image"})}),e.jsxs(d,{variant:"caption",display:"block",color:"textSecondary",sx:{mt:1.5,lineHeight:1.6},children:["Recommended: ",e.jsx("strong",{children:"600x400px"})," (3:2 ratio).",e.jsx("br",{}),"Max file size: 5MB. Supports JPG, PNG, WebP."]})]})]})]}),e.jsx(Me,{sx:{borderStyle:"dashed"}}),e.jsxs(c,{children:[e.jsxs(d,{variant:"subtitle2",sx:{mb:2,color:"#666",fontWeight:600,display:"flex",alignItems:"center",gap:1},children:[e.jsx(c,{component:"span",sx:{width:4,height:16,bgcolor:"primary.main",borderRadius:1}}),"Settings & SEO"]}),e.jsxs(A,{container:!0,spacing:3,children:[e.jsxs(A,{item:!0,xs:12,sm:4,children:[e.jsx(d,{variant:"body2",gutterBottom:!0,fontWeight:500,children:"Display Order"}),e.jsx(S,{fullWidth:!0,type:"number",size:"small",value:p.displayOrder,onChange:t=>D("displayOrder",t.target.value)})]}),e.jsxs(A,{item:!0,xs:12,sm:8,sx:{display:"flex",gap:6,alignItems:"center",height:"100%",pt:2.5},children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(d,{variant:"body2",fontWeight:500,children:"Active Status"}),e.jsx(xe,{checked:p.isActive,onChange:t=>D("isActive",t.target.checked),size:"medium"})]}),e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(d,{variant:"body2",fontWeight:500,children:"Featured"}),e.jsx(xe,{checked:p.isFeatured,onChange:t=>D("isFeatured",t.target.checked),color:"secondary",size:"medium"})]})]}),e.jsxs(A,{item:!0,xs:12,sm:6,children:[e.jsx(d,{variant:"body2",gutterBottom:!0,fontWeight:500,children:"Meta Title (SEO)"}),e.jsx(S,{fullWidth:!0,size:"small",value:p.metaTitle,onChange:t=>D("metaTitle",t.target.value),placeholder:"Title for search engines"})]}),e.jsxs(A,{item:!0,xs:12,sm:6,children:[e.jsx(d,{variant:"body2",gutterBottom:!0,fontWeight:500,children:"Meta Description (SEO)"}),e.jsx(S,{fullWidth:!0,size:"small",value:p.metaDescription,onChange:t=>D("metaDescription",t.target.value),placeholder:"Short summary for search results"})]})]})]})]})}),e.jsxs(Re,{sx:{p:3,borderTop:"1px solid #eee",bgcolor:"#fafafa"},children:[e.jsx(C,{onClick:X,variant:"outlined",sx:{textTransform:"none",px:4,borderRadius:2,borderColor:"#ddd",color:"#666"},disabled:R.loading,children:"Cancel"}),e.jsx(C,{onClick:Qe,variant:"contained",color:"primary",sx:{textTransform:"none",px:5,borderRadius:2,boxShadow:"0 4px 12px rgba(25, 118, 210, 0.2)",fontWeight:600},disabled:R.loading||!p.name.trim(),children:R.loading?e.jsx(_,{size:20,color:"inherit"}):"Save Changes"})]})]}),e.jsxs(d,{variant:"subtitle1",sx:{mb:1,fontWeight:500},children:["Image ",e.jsx("span",{style:{color:"#f44336"},children:"*"})," ",e.jsx("span",{style:{color:"#e91e63",fontSize:"0.875rem"},children:"(Ratio 3:2)"})]}),e.jsxs(c,{sx:{display:"flex",gap:3,mb:4,flexDirection:{xs:"column",sm:"row"}},children:[e.jsxs(c,{children:[e.jsx("input",{id:"image-upload-input",type:"file",accept:"image/*",onChange:Ve,ref:H,style:{display:"none"}}),e.jsx("label",{htmlFor:"image-upload-input",children:e.jsxs(C,{component:"span",variant:"outlined",sx:{width:{xs:"100%",sm:240},height:{xs:100,sm:140},border:"2px dashed #e0e0e0",borderRadius:2,display:"flex",flexDirection:"column",gap:1,color:"text.secondary",textTransform:"none","&:hover":{borderColor:"#2196f3",backgroundColor:"#e3f2fd",border:"2px dashed #2196f3"}},children:[e.jsx(Be,{sx:{fontSize:40,color:"#bdbdbd"}}),e.jsx(d,{variant:"body2",color:"text.secondary",children:G?"Change Image":"Upload Image"})]})})]}),fe&&e.jsxs(c,{sx:{position:"relative"},children:[e.jsxs(c,{sx:{width:{xs:"100%",sm:240},height:{xs:160,sm:140},border:"2px solid #e0e0e0",borderRadius:2,overflow:"hidden",position:"relative"},children:[e.jsx("img",{src:fe,alt:"Preview",style:{width:"100%",height:"100%",objectFit:"cover"}}),e.jsx(Z,{size:"small",onClick:()=>{te(null),ee(null),H.current&&(H.current.value="")},sx:{position:"absolute",top:8,right:8,backgroundColor:"rgba(0,0,0,0.5)",color:"white","&:hover":{backgroundColor:"rgba(0,0,0,0.7)"}},children:e.jsx($e,{fontSize:"small"})})]}),e.jsx(d,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:G?.name})]})]}),e.jsxs(c,{sx:{display:"flex",flexWrap:"wrap",justifyContent:{xs:"center",sm:"flex-end"},gap:2},children:[e.jsx(C,{variant:"outlined",onClick:ke,sx:{px:4,py:1.5,textTransform:"none",borderColor:"#e0e0e0",color:"#666","&:hover":{borderColor:"#bdbdbd",backgroundColor:"#f5f5f5"}},disabled:y||F,children:"Reset"}),e.jsx(C,{variant:"contained",onClick:qe,disabled:!m.name.trim()||!m.module||!/^[0-9a-fA-F]{24}$/.test(m.module)||!G||y||F||w||E.length===0,sx:{px:4,py:1.5,backgroundColor:"#00695c",textTransform:"none","&:hover":{backgroundColor:"#004d40"},"&:disabled":{backgroundColor:"#e0e0e0",color:"#999"}},children:y?e.jsx(_,{size:20,color:"inherit"}):"Add"})]})]})})}),e.jsx(c,{sx:{display:"flex",justifyContent:"center"},children:e.jsx(Te,{sx:{width:"100%",maxWidth:"1400px",boxShadow:3,borderRadius:3},children:e.jsxs(Ee,{sx:{p:{xs:2,sm:3}},children:[e.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",flexWrap:"wrap",gap:2,mb:3},children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(d,{variant:"h6",fontWeight:600,children:"Category List"}),e.jsx(ze,{label:U.length,size:"small",sx:{backgroundColor:"#e3f2fd",color:"#2196f3",fontWeight:600}}),e.jsx(ze,{label:`Language: ${v[j].label}`,size:"small",sx:{backgroundColor:"#e8f5e8",color:"#2e7d32",fontWeight:500}})]}),e.jsxs(c,{sx:{display:"flex",flexWrap:"wrap",gap:2,alignItems:"center"},children:[e.jsxs(S,{select:!0,size:"small",value:ae,onChange:t=>se(t.target.value),sx:{minWidth:{xs:"100%",sm:200}},disabled:y||F,children:[e.jsx(I,{value:"all",children:"All Modules"}),E.map(t=>e.jsx(I,{value:t._id,children:t.title||t.name||"Unnamed Module"},t._id))]}),e.jsx(S,{size:"small",placeholder:`Search categories in ${v[j].label}`,value:L,onChange:t=>Ue(t.target.value),sx:{minWidth:{xs:"100%",sm:250,md:300},"& .MuiOutlinedInput-root":{direction:v[j].key==="arabic"?"rtl":"ltr"}},InputProps:{startAdornment:e.jsx(ut,{position:"start",children:e.jsx(jt,{sx:{color:"#bdbdbd"}})})},disabled:y}),e.jsx(C,{variant:"outlined",startIcon:e.jsx(Ct,{}),endIcon:e.jsx(vt,{}),onClick:ot,sx:{textTransform:"none",borderColor:"#e0e0e0",color:"#2196f3","&:hover":{borderColor:"#2196f3",backgroundColor:"#e3f2fd"}},disabled:y||U.length===0,children:"Export"}),e.jsxs(gt,{anchorEl:be,open:Ye,onClose:he,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},sx:{"& .MuiPaper-root":{minWidth:180,boxShadow:"0 4px 20px rgba(0,0,0,0.1)",borderRadius:2,mt:1}},children:[e.jsxs(I,{onClick:it,sx:{py:1.5,px:2},children:[e.jsx(Ne,{children:e.jsx(wt,{sx:{color:"#1976d2"}})}),e.jsx(Le,{primary:"Export to Excel",primaryTypographyProps:{fontWeight:500}})]}),e.jsx(Me,{}),e.jsxs(I,{onClick:nt,sx:{py:1.5,px:2},children:[e.jsx(Ne,{children:e.jsx(kt,{sx:{color:"#2e7d32"}})}),e.jsx(Le,{primary:"Export to CSV",primaryTypographyProps:{fontWeight:500}})]})]})]})]}),y&&B.length>0&&e.jsx(c,{display:"flex",justifyContent:"center",p:2,children:e.jsx(_,{size:24})}),e.jsx(ht,{component:mt,sx:{overflowX:"auto"},children:e.jsxs(xt,{size:"small",children:[e.jsx(pt,{sx:{backgroundColor:"#fafafa"},children:e.jsxs(pe,{children:[e.jsx(k,{sx:{fontWeight:600,color:"#666"},children:"SI"}),e.jsx(k,{sx:{fontWeight:600,color:"#666"},children:"Image"}),e.jsxs(k,{sx:{fontWeight:600,color:"#666",direction:v[j].key==="arabic"?"rtl":"ltr"},children:["Name (",v[j].label,")"]}),e.jsx(k,{sx:{fontWeight:600,color:"#666"},children:"Module"}),e.jsx(k,{sx:{fontWeight:600,color:"#666"},children:"Status"}),e.jsx(k,{sx:{fontWeight:600,color:"#666"},children:"Action"})]})}),e.jsx(ft,{children:U.length>0?U.map((t,r)=>{const a=Q();return e.jsxs(pe,{sx:{"&:hover":{backgroundColor:"#f9f9f9"}},children:[e.jsx(k,{children:r+1+(x.currentPage-1)*x.itemsPerPage}),e.jsx(k,{children:t.image?e.jsx(c,{sx:{width:50,height:35,borderRadius:1,overflow:"hidden",border:"1px solid #e0e0e0"},children:e.jsx("img",{src:t.image,alt:t.names[a],style:{width:"100%",height:"100%",objectFit:"cover"},onError:s=>{console.error("Image failed to load:",t.image),s.target.style.display="none",s.target.parentElement.innerHTML='<div style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:#f5f5f5;font-size:10px;color:#999;">Error</div>'}})}):e.jsx(c,{sx:{width:50,height:35,borderRadius:1,backgroundColor:"#f5f5f5",display:"flex",alignItems:"center",justifyContent:"center",border:"1px solid #e0e0e0"},children:e.jsx(d,{variant:"caption",color:"text.secondary",children:"No Image"})})}),e.jsx(k,{sx:{fontWeight:500,maxWidth:200,direction:v[j].key==="arabic"?"rtl":"ltr"},children:e.jsx(d,{variant:"body2",sx:{wordBreak:"break-word"},children:t.names[a]})}),e.jsx(k,{children:e.jsx(d,{variant:"body2",children:t.module?t.module.title||"N/A":"None"})}),e.jsx(k,{children:e.jsx(xe,{checked:t.status,onChange:()=>rt(t.id),sx:{"& .MuiSwitch-switchBase.Mui-checked":{color:"#2196f3"},"& .MuiSwitch-switchBase.Mui-checked + .MuiSwitch-track":{backgroundColor:"#2196f3"}},disabled:y})}),e.jsx(k,{children:e.jsxs(c,{sx:{display:"flex",gap:1},children:[e.jsx(Z,{size:"small",onClick:()=>Ze(t.id),sx:{color:"#2196f3"},disabled:y,children:e.jsx(yt,{fontSize:"small"})}),e.jsx(Z,{size:"small",onClick:()=>et(t.id),sx:{color:"#f44336"},disabled:y,children:e.jsx(bt,{fontSize:"small"})})]})})]},t.id)}):e.jsx(pe,{children:e.jsx(k,{colSpan:6,sx:{textAlign:"center",py:4,color:"#999"},children:e.jsxs(Y,{spacing:2,alignItems:"center",children:[e.jsx(d,{variant:"h6",color:"textSecondary",children:y?"Loading categories...":L?`No categories found matching your search in ${v[j].label}.`:"No categories available."}),T||w?e.jsx(C,{variant:"outlined",onClick:Se,children:"Try Again"}):!y&&!L&&e.jsx(d,{variant:"body2",color:"textSecondary",children:"Create your first category using the form above"})]})})})})]})}),x.totalPages>1&&e.jsxs(Y,{direction:"row",spacing:2,justifyContent:"center",alignItems:"center",p:2,children:[e.jsx(C,{variant:"outlined",disabled:x.currentPage===1||y,onClick:()=>oe(t=>({...t,currentPage:t.currentPage-1})),children:"Previous"}),e.jsxs(d,{variant:"body2",children:["Page ",x.currentPage," of ",x.totalPages,x.totalItems?` (${x.totalItems} total)`:""]}),e.jsx(C,{variant:"outlined",disabled:x.currentPage===x.totalPages||y,onClick:()=>oe(t=>({...t,currentPage:t.currentPage+1})),children:"Next"})]})]})})}),e.jsxs(De,{open:V.open,onClose:()=>q({open:!1,categoryId:null,categoryName:""}),maxWidth:"sm",fullWidth:!0,children:[e.jsx(We,{sx:{fontWeight:600},children:"Confirm Delete"}),e.jsx(Fe,{children:e.jsxs(d,{children:['Are you sure you want to delete the category "',V.categoryName,'"? This action cannot be undone.']})}),e.jsxs(Re,{sx:{p:3,gap:1},children:[e.jsx(C,{onClick:()=>q({open:!1,categoryId:null,categoryName:""}),variant:"outlined",sx:{textTransform:"none"},disabled:y,children:"Cancel"}),e.jsx(C,{onClick:tt,variant:"contained",color:"error",sx:{textTransform:"none"},disabled:y,children:y?e.jsx(_,{size:20,color:"inherit"}):"Delete"})]})]}),e.jsx(Ie,{open:ne.open,autoHideDuration:4e3,onClose:Pe,anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(Ae,{onClose:Pe,severity:ne.severity,variant:"filled",sx:{width:"100%"},children:ne.message})})]})}export{$t as default};
