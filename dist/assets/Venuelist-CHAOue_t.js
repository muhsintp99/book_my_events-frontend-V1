import{u as re,a as ne,r as u,j as e,B as E,C as ie,T as o,K as N,A as _,d as j,ae as le,af as oe,S as g,F as w,H as C,M as p,o as d,g as ce,J as de,N as he,Q as ue,U as W,V as r,W as ge,a3 as xe,c as I,X as me,Y as pe,Z as je}from"./index-CgvkLXhQ.js";import{S as ye}from"./Search-DS6UMqv3.js";import{V as fe}from"./Visibility-nGoOtfDL.js";function Se(){re();const P=ne(),A="http://localhost:5000/api",[h,$]=u.useState([]),[H,V]=u.useState(!0),[B,R]=u.useState(null),[D,f]=u.useState(!1),[F,v]=u.useState(""),[M,S]=u.useState("success"),[y,U]=u.useState({brand:"",category:"",rentalType:"",search:"",isActive:""}),[c,b]=u.useState({brand:"",category:"",rentalType:"",search:"",isActive:""}),[n,O]=u.useState({currentPage:1,totalPages:1,totalItems:0,itemsPerPage:10}),G=()=>[...new Set(h.map(s=>s.provider?.storeName||"Unknown"))],q=()=>[...new Set(h.map(s=>s.seatingArrangement||"Unknown"))],J=()=>[...new Set(h.map(s=>s.rentalType||"Unknown"))],T=async(s=1,a=y)=>{V(!0),R(null);try{const i=new URLSearchParams({page:s.toString(),limit:n.itemsPerPage.toString()});a.search&&i.append("search",a.search),a.isActive!==""&&i.append("isActive",a.isActive),a.rentalType&&i.append("rentalType",a.rentalType),a.brand&&i.append("provider",a.brand),a.category&&i.append("seatingArrangement",a.category);const l=await(await fetch(`${A}/venues?${i.toString()}`,{method:"GET",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"}})).json();if(l.success){const t=l.data.map(m=>({...m,thumbnail:m.thumbnail?`${A}/${m.thumbnail.replace(/^\//,"")}`:null,images:m.images?m.images.map(k=>`${A}/${k.replace(/^\//,"")}`):[]}));$(t),O({currentPage:l.pagination?.currentPage||1,totalPages:Math.ceil(l.count/n.itemsPerPage)||1,totalItems:l.count||0,itemsPerPage:n.itemsPerPage})}else throw new Error(l.message||"Failed to fetch venues")}catch(i){console.error("Error fetching venues:",i),R(i.message),v("Error fetching venues: "+i.message),S("error"),f(!0)}finally{V(!1)}};u.useEffect(()=>{T(1,y)},[]);const K=()=>{U(c),T(1,c)},Q=()=>{const s={brand:"",category:"",rentalType:"",search:"",isActive:""};U(s),b(s),T(1,s)},z=s=>{T(s,y)},X=()=>{const s=["Sl,Venue Name,Address,Provider,Seating Arrangement,Rental Type,Price,Capacity,Status,Total Bookings,Tags,Facilities"],a=h.map((t,m)=>{const k=t.rentalType==="hourly"?`$${t.hourlyPrice}/hr`:t.rentalType==="daily"?`$${t.perDayPrice}/day`:t.rentalType==="distanceWise"?`$${t.distanceWisePrice}/km`:"N/A",te=[t.parkingAvailability?"Parking":"",t.foodCateringAvailability?"Catering":"",t.stageLightingAudio?"Stage/Lighting":"",t.wheelchairAccessibility?"Accessibility":"",t.securityArrangements?"Security":"",t.wifiAvailability?"Wi-Fi":""].filter(Boolean).join(", "),ae=Array.isArray(t.searchTags)?t.searchTags.join(", "):t.searchTags||"";return`${m+1},"${t.venueName}","${t.venueAddress}","${t.provider?.storeName||"N/A"}","${t.seatingArrangement||"N/A"}","${t.rentalType||"N/A"}","${k}","${t.maxGuestsSeated||"N/A"}","${t.isActive?"Active":"Inactive"}","${t.totalBookings||0}","${ae}","${te}"`}),i=s.concat(a).join(`
`),x=new Blob([i],{type:"text/csv"}),l=document.createElement("a");l.href=URL.createObjectURL(x),l.download=`venues-${new Date().toISOString().split("T")[0]}.csv`,l.click()},Y=async s=>{try{const a=h.find(l=>l._id===s);if(!a)return;const x=await(await fetch(`${A}/venues/${s}/status`,{method:"PATCH",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"},body:JSON.stringify({isActive:!a.isActive})})).json();if(x.success)$(l=>l.map(t=>t._id===s?{...t,isActive:!t.isActive}:t)),v(`Venue ${x.data.isActive?"activated":"deactivated"} successfully`),S("success"),f(!0);else throw new Error(x.message||"Failed to toggle status")}catch(a){console.error("Error toggling venue status:",a),v("Error toggling venue status: "+a.message),S("error"),f(!0)}},Z=async s=>{if(window.confirm("Are you sure you want to delete this venue?"))try{const i=await(await fetch(`${A}/venues/${s}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"}})).json();if(i.success)$(x=>x.filter(l=>l._id!==s)),v("Venue deleted successfully"),S("success"),f(!0),h.length===1&&n.currentPage>1&&z(n.currentPage-1);else throw new Error(i.message||"Failed to delete venue")}catch(a){console.error("Error deleting venue:",a),v("Error deleting venue: "+a.message),S("error"),f(!0)}},ee=s=>{P(`/venue-setup/view/${s}`)},se=s=>{P(`/venue-setup/edit/${s}`)},L=(s,a)=>{a!=="clickaway"&&f(!1)};return H?e.jsxs(E,{sx:{bgcolor:"#fafafa",minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center"},children:[e.jsx(ie,{}),e.jsx(o,{sx:{ml:2},children:"Loading venues..."})]}):B&&h.length===0?e.jsx(E,{sx:{bgcolor:"#fafafa",minHeight:"100vh",p:2},children:e.jsxs(N,{sx:{p:4,textAlign:"center",maxWidth:600,mx:"auto"},children:[e.jsx(_,{severity:"error",sx:{mb:2},children:B}),e.jsx(j,{variant:"contained",onClick:()=>T(1,y),sx:{bgcolor:"#2563eb"},children:"Retry"})]})}):e.jsxs(E,{sx:{bgcolor:"#fafafa",minHeight:"100vh",p:2},children:[e.jsx(le,{position:"static",color:"default",elevation:0,children:e.jsx(oe,{children:e.jsx(o,{variant:"h6",sx:{flexGrow:1,color:"#333"},children:"ðŸ¢ CityRide Venues"})})}),e.jsx(N,{sx:{p:2,mt:2},children:e.jsxs(g,{direction:"row",spacing:2,flexWrap:"wrap",children:[e.jsx(w,{sx:{minWidth:180},size:"small",children:e.jsxs(C,{displayEmpty:!0,value:c.brand,onChange:s=>b({...c,brand:s.target.value}),children:[e.jsx(p,{value:"",children:"All Providers"}),G().map(s=>e.jsx(p,{value:s,children:s},s))]})}),e.jsx(w,{sx:{minWidth:180},size:"small",children:e.jsxs(C,{displayEmpty:!0,value:c.category,onChange:s=>b({...c,category:s.target.value}),children:[e.jsx(p,{value:"",children:"All Arrangements"}),q().map(s=>e.jsx(p,{value:s,children:s},s))]})}),e.jsx(w,{sx:{minWidth:180},size:"small",children:e.jsxs(C,{displayEmpty:!0,value:c.rentalType,onChange:s=>b({...c,rentalType:s.target.value}),children:[e.jsx(p,{value:"",children:"All Rental Types"}),J().map(s=>e.jsx(p,{value:s,children:s.charAt(0).toUpperCase()+s.slice(1)},s))]})}),e.jsx(w,{sx:{minWidth:150},size:"small",children:e.jsxs(C,{displayEmpty:!0,value:c.isActive,onChange:s=>b({...c,isActive:s.target.value}),children:[e.jsx(p,{value:"",children:"All Status"}),e.jsx(p,{value:"true",children:"Active"}),e.jsx(p,{value:"false",children:"Inactive"})]})}),e.jsx(j,{variant:"outlined",onClick:Q,children:"Reset"}),e.jsx(j,{variant:"contained",sx:{bgcolor:"#2563eb"},onClick:K,children:"Filter"})]})}),e.jsxs(N,{sx:{p:2,mt:2},children:[e.jsxs(g,{direction:"row",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",spacing:2,mb:2,children:[e.jsxs(o,{variant:"h6",sx:{fontWeight:600},children:["Total Venues"," ",e.jsx(d,{label:n.totalItems,color:"success",size:"small",sx:{ml:1}})]}),e.jsxs(g,{direction:"row",spacing:1,flexWrap:"wrap",children:[e.jsx(ce,{size:"small",placeholder:"Search by venue name or address",value:c.search,onChange:s=>b({...c,search:s.target.value}),InputProps:{endAdornment:e.jsx(ye,{fontSize:"small"})},sx:{minWidth:200}}),e.jsx(j,{variant:"outlined",onClick:X,children:"Export CSV"}),e.jsx(j,{variant:"contained",sx:{bgcolor:"#2563eb"},onClick:()=>P("/venue-setup/create"),children:"New Venue"})]})]}),h.length>0&&e.jsxs(o,{variant:"body2",color:"text.secondary",sx:{mb:2},children:["Showing ",(n.currentPage-1)*n.itemsPerPage+1," to"," ",Math.min(n.currentPage*n.itemsPerPage,n.totalItems)," of"," ",n.totalItems," venues"]}),e.jsx(de,{sx:{maxHeight:600},children:e.jsxs(he,{stickyHeader:!0,children:[e.jsx(ue,{sx:{bgcolor:"#f9fafb"},children:e.jsxs(W,{children:[e.jsx(r,{children:"Sl"}),e.jsx(r,{children:"Venue Info"}),e.jsx(r,{children:"Address"}),e.jsx(r,{children:"Provider"}),e.jsx(r,{children:"Arrangement"}),e.jsx(r,{children:"Rental Type"}),e.jsx(r,{children:"Price"}),e.jsx(r,{children:"Capacity"}),e.jsx(r,{children:"Bookings"}),e.jsx(r,{children:"Facilities"}),e.jsx(r,{children:"Status"}),e.jsx(r,{children:"Action"})]})}),e.jsxs(ge,{children:[h.map((s,a)=>{const i=s.rentalType==="hourly"?`$${s.hourlyPrice}/hr`:s.rentalType==="daily"?`$${s.perDayPrice}/day`:s.rentalType==="distanceWise"?`$${s.distanceWisePrice}/km`:"N/A",l=(n.currentPage-1)*n.itemsPerPage+a+1;return e.jsxs(W,{hover:!0,children:[e.jsx(r,{children:l}),e.jsx(r,{children:e.jsxs(g,{spacing:.5,children:[e.jsx(o,{variant:"body2",sx:{fontWeight:600,color:"#2563eb"},children:s.venueName}),Array.isArray(s.searchTags)&&s.searchTags.length>0&&e.jsxs(g,{direction:"row",spacing:.5,flexWrap:"wrap",children:[s.searchTags.slice(0,3).map((t,m)=>e.jsx(d,{label:t.trim(),size:"small",variant:"outlined",sx:{fontSize:"0.65rem"}},m)),s.searchTags.length>3&&e.jsx(d,{label:`+${s.searchTags.length-3}`,size:"small",sx:{fontSize:"0.65rem"}})]})]})}),e.jsx(r,{sx:{maxWidth:150},children:e.jsx(o,{variant:"body2",sx:{fontSize:"0.875rem"},children:s.venueAddress.length>50?`${s.venueAddress.substring(0,50)}...`:s.venueAddress})}),e.jsx(r,{children:e.jsx(o,{variant:"body2",children:s.provider?.storeName||"N/A"})}),e.jsx(r,{children:e.jsx(d,{label:s.seatingArrangement||"N/A",size:"small",variant:"outlined",color:"primary"})}),e.jsx(r,{children:e.jsx(d,{label:s.rentalType?s.rentalType.charAt(0).toUpperCase()+s.rentalType.slice(1):"N/A",size:"small",color:"secondary",variant:"outlined"})}),e.jsx(r,{children:e.jsx(o,{variant:"body2",sx:{fontWeight:600,color:"#059669"},children:i})}),e.jsx(r,{children:e.jsxs(o,{variant:"body2",children:[s.maxGuestsSeated||"N/A"," seats"]})}),e.jsx(r,{children:e.jsx(o,{variant:"body2",color:"primary",children:s.totalBookings||0})}),e.jsx(r,{children:e.jsxs(g,{direction:"row",spacing:.5,flexWrap:"wrap",children:[s.parkingAvailability&&e.jsx(d,{label:"P",size:"small",color:"success",variant:"outlined",sx:{fontSize:"0.65rem"}}),s.foodCateringAvailability&&e.jsx(d,{label:"F",size:"small",color:"warning",variant:"outlined",sx:{fontSize:"0.65rem"}}),s.wifiAvailability&&e.jsx(d,{label:"W",size:"small",color:"info",variant:"outlined",sx:{fontSize:"0.65rem"}}),s.wheelchairAccessibility&&e.jsx(d,{label:"A",size:"small",color:"primary",variant:"outlined",sx:{fontSize:"0.65rem"}}),s.stageLightingAudio&&e.jsx(d,{label:"S",size:"small",color:"secondary",variant:"outlined",sx:{fontSize:"0.65rem"}}),s.securityArrangements&&e.jsx(d,{label:"Sec",size:"small",color:"error",variant:"outlined",sx:{fontSize:"0.65rem"}})]})}),e.jsx(r,{children:e.jsx(xe,{checked:s.isActive||!1,onChange:()=>Y(s._id),color:"primary",size:"small"})}),e.jsx(r,{children:e.jsxs(g,{direction:"row",spacing:1,children:[e.jsx(I,{size:"small",sx:{color:"#2563eb"},onClick:()=>ee(s._id),children:e.jsx(fe,{fontSize:"small"})}),e.jsx(I,{size:"small",sx:{color:"#065f46"},onClick:()=>se(s._id),children:e.jsx(me,{fontSize:"small"})}),e.jsx(I,{size:"small",sx:{color:"#dc2626"},onClick:()=>Z(s._id),children:e.jsx(pe,{fontSize:"small"})})]})})]},s._id)}),h.length===0&&e.jsx(W,{children:e.jsx(r,{colSpan:12,align:"center",sx:{py:4},children:e.jsxs(g,{spacing:2,alignItems:"center",children:[e.jsx(o,{variant:"h6",color:"text.secondary",children:"No venues found"}),e.jsxs(o,{variant:"body2",color:"text.secondary",children:[y.search&&`No venues match "${y.search}"`,!y.search&&"Create your first venue to get started"]}),e.jsx(j,{variant:"contained",sx:{bgcolor:"#2563eb"},onClick:()=>P("/venue-setup/create"),children:"Create New Venue"})]})})})]})]})}),n.totalPages>1&&e.jsxs(g,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{mt:3,pt:2,borderTop:"1px solid #e5e7eb"},children:[e.jsxs(o,{variant:"body2",color:"text.secondary",children:["Page ",n.currentPage," of ",n.totalPages]}),e.jsxs(g,{direction:"row",spacing:1,children:[e.jsx(j,{variant:"outlined",size:"small",disabled:n.currentPage===1,onClick:()=>z(n.currentPage-1),children:"Previous"}),e.jsx(j,{variant:"outlined",size:"small",disabled:n.currentPage===n.totalPages,onClick:()=>z(n.currentPage+1),children:"Next"})]})]})]}),e.jsx(je,{open:D,autoHideDuration:4e3,onClose:L,anchorOrigin:{vertical:"top",horizontal:"center"},children:e.jsx(_,{onClose:L,severity:M,sx:{width:"100%"},variant:"filled",children:F})})]})}export{Se as default};
